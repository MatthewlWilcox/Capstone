<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.313">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Matthew Wilcox">

<title>Will the Stadium be Buzzing or Silent?</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>


<script src="Blog_post_files/libs/clipboard/clipboard.min.js"></script>
<script src="Blog_post_files/libs/quarto-html/quarto.js"></script>
<script src="Blog_post_files/libs/quarto-html/popper.min.js"></script>
<script src="Blog_post_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Blog_post_files/libs/quarto-html/anchor.min.js"></script>
<link href="Blog_post_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Blog_post_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Blog_post_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Blog_post_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Blog_post_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
        <script type="text/javascript">
        window.PlotlyConfig = {MathJaxConfig: 'local'};
        if (window.MathJax && window.MathJax.Hub && window.MathJax.Hub.Config) {window.MathJax.Hub.Config({SVG: {font: "STIX-Web"}});}
        if (typeof require !== 'undefined') {
        require.undef("plotly");
        requirejs.config({
            paths: {
                'plotly': ['https://cdn.plot.ly/plotly-2.20.0.min']
            }
        });
        require(['plotly'], function(Plotly) {
            window._Plotly = Plotly;
        });
        }
        </script>
        


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#why-attendance-matters" id="toc-why-attendance-matters" class="nav-link active" data-scroll-target="#why-attendance-matters">Why Attendance Matters</a></li>
  <li><a href="#python-packages-used" id="toc-python-packages-used" class="nav-link" data-scroll-target="#python-packages-used">Python Packages Used</a></li>
  <li><a href="#data-collection" id="toc-data-collection" class="nav-link" data-scroll-target="#data-collection">Data Collection</a></li>
  <li><a href="#data-processing" id="toc-data-processing" class="nav-link" data-scroll-target="#data-processing">Data Processing</a>
  <ul class="collapse">
  <li><a href="#final-dataset" id="toc-final-dataset" class="nav-link" data-scroll-target="#final-dataset">Final Dataset</a></li>
  </ul></li>
  <li><a href="#date-time" id="toc-date-time" class="nav-link" data-scroll-target="#date-time">Date &amp; Time</a>
  <ul class="collapse">
  <li><a href="#day-of-the-week" id="toc-day-of-the-week" class="nav-link" data-scroll-target="#day-of-the-week">Day of the Week</a></li>
  <li><a href="#time-of-day" id="toc-time-of-day" class="nav-link" data-scroll-target="#time-of-day">Time of Day</a></li>
  <li><a href="#calendar-date" id="toc-calendar-date" class="nav-link" data-scroll-target="#calendar-date">Calendar Date</a>
  <ul class="collapse">
  <li><a href="#trends-in-quantity-of-matches" id="toc-trends-in-quantity-of-matches" class="nav-link" data-scroll-target="#trends-in-quantity-of-matches">Trends in Quantity of Matches</a></li>
  <li><a href="#trends-in-attendance-of-matches" id="toc-trends-in-attendance-of-matches" class="nav-link" data-scroll-target="#trends-in-attendance-of-matches">Trends in Attendance of Matches</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#away-team-impact" id="toc-away-team-impact" class="nav-link" data-scroll-target="#away-team-impact">Away Team Impact</a>
  <ul class="collapse">
  <li><a href="#top-teams-in-the-biggest-leagues" id="toc-top-teams-in-the-biggest-leagues" class="nav-link" data-scroll-target="#top-teams-in-the-biggest-leagues">Top Teams in the Biggest Leagues</a></li>
  <li><a href="#greatest-away-team-impact---english-leagues" id="toc-greatest-away-team-impact---english-leagues" class="nav-link" data-scroll-target="#greatest-away-team-impact---english-leagues">Greatest Away Team Impact - English Leagues</a></li>
  </ul></li>
  <li><a href="#betting-odds" id="toc-betting-odds" class="nav-link" data-scroll-target="#betting-odds">Betting Odds</a>
  <ul class="collapse">
  <li><a href="#comparing-betting-data-sources" id="toc-comparing-betting-data-sources" class="nav-link" data-scroll-target="#comparing-betting-data-sources">Comparing Betting Data Sources</a></li>
  <li><a href="#betting-odds-1" id="toc-betting-odds-1" class="nav-link" data-scroll-target="#betting-odds-1">Betting Odds</a></li>
  <li><a href="#odds-of-goals-2.5" id="toc-odds-of-goals-2.5" class="nav-link" data-scroll-target="#odds-of-goals-2.5">Odds of Goals &gt; 2.5</a></li>
  </ul></li>
  <li><a href="#modeling" id="toc-modeling" class="nav-link" data-scroll-target="#modeling">Modeling</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Will the Stadium be Buzzing or Silent?</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
<p class="subtitle lead">Demand of Attendance for European Football Leagues</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Matthew Wilcox </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Header%20Image/victoria-prymak-CCe_Xt5sEDA-unsplash.jpg" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Photo by <a href="https://unsplash.com/@vprmk">Victoria Prymak</a> on <a href="https://unsplash.com/">Unsplash</a></figcaption><p></p>
</figure>
</div>
<section id="why-attendance-matters" class="level1">
<h1>Why Attendance Matters</h1>
<p>Football (Soccer), with an estimated 3.5 billion fans worldwide, is the most popular sport in the world <span class="citation" data-cites="sportforbusinessWorldsMost">(<a href="#ref-sportforbusinessWorldsMost" role="doc-biblioref"><span>“<span>T</span>he <span>W</span>orld’s <span>M</span>ost <span>W</span>atched <span>S</span>ports - <span>S</span>port for <span>B</span>usiness — Sportforbusiness.com”</span></a>)</span>. In turn, a large economy and business surrounds the sport. Football teams need to be profitable to succeed. But how do these teams make money? Mainly from 5 different revenue sources: television money, prize money, player transfers, sponsorships, and matchday revenues <span class="citation" data-cites="footballstadiumsFootballClubs">(<a href="#ref-footballstadiumsFootballClubs" role="doc-biblioref"><span>“<span>H</span>ow <span>D</span>o <span>F</span>ootball <span>C</span>lubs <span>M</span>ake <span>M</span>oney? | <span>F</span>ootball-<span>S</span>tadiums.co.uk — Football-Stadiums.co.uk”</span></a>)</span>. Out of all of these, one of the most universal is match day revenues. For many teams, the match day revenue is the lifeblood of the club as it is the sales from ticket sales, concessions, club store purchases, etc.</p>
<p>The attendance of a match can significantly affect a team’s match day revenue. So understanding factors affecting attendance and predicting the attendance is important. If a club could predict the number of people attending a match, they could be better prepared for it. Such as, if the match is expected to have lower attendance than desired, the club could market it differently or have special promotions to increase the attendance for that match.</p>
<p>There are many factors that could impact the attendance of a match. However, the factors used here are the day and time of the match, betting odds for a match, and who the away team is for any given match. Later we will also produce a random forest model to predict the attendance of matches based on these factors.</p>
</section>
<section id="python-packages-used" class="level1">
<h1>Python Packages Used</h1>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestRegressor</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> LabelEncoder</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_squared_error</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> accuracy_score, confusion_matrix, classification_report</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn <span class="im">import</span> metrics</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LinearRegression</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> july</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime <span class="im">as</span> dt</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> jupyter_dash <span class="im">import</span> JupyterDash</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dash <span class="im">import</span> html, dcc, Input, Output</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.graph_objects <span class="im">as</span> go</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime, time</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> re <span class="im">import</span> sub</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.express <span class="im">as</span> px</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pickle</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="data-collection" class="level1">
<h1>Data Collection</h1>
<p>This project used data that was collected from two sources: <a href="https://www.worldfootball.net/">worldfootball.net</a> and <a href="https://www.football-data.co.uk/">Football-data.co.uk</a>. The data that was collected from worldfootball.net was information on the match, such as the team names, the time and date of the match, and most importantly, each matches attendance. This data was scraped on January 31st, 2023. The data that was downloaded from Football-data.co.uk was primarily betting information for each game. This data was already tabulated into CSV files which were divided based on the year and league. All the files were downloaded on February 3rd, 2023.</p>
<p>The data that was collected spanned from 2010 to 2023. It consisted of leagues from 11 countries: England, Scotland, Germany, Italy, Spain, France, Netherlands, Belgium, Portugal, Turkey, and Greece. In total, the data contained 21 leagues from these countries.</p>
</section>
<section id="data-processing" class="level1">
<h1>Data Processing</h1>
<div class="cell" data-execution_count="2">
<details>
<summary>Preprocessing Data</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>betting_data <span class="op">=</span> pd.read_csv(<span class="st">'../data/RAWDATA/RAW_betting_data.csv'</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>match_data <span class="op">=</span>  pd.read_csv(<span class="st">'../data/RAWDATA/RAW_match_data.csv'</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'../src/Data_Processing/key_dictionary.pkl'</span>, <span class="st">'rb'</span>) <span class="im">as</span> pick:</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    key_dict <span class="op">=</span> pickle.load(pick)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> snake_case(s):</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="st">'_'</span>.join(</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    sub(<span class="st">'([A-Z][a-z]+)'</span>, <span class="vs">r' \1'</span>,</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    sub(<span class="st">'([A-Z]+)'</span>, <span class="vs">r' \1'</span>,</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    s.replace(<span class="st">'-'</span>, <span class="st">' '</span>))).split()).lower()</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>betting_data[<span class="st">'HomeTeam'</span>] <span class="op">=</span>betting_data[<span class="st">'HomeTeam'</span>].<span class="bu">apply</span>(<span class="bu">str</span>)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>betting_data[<span class="st">'HomeTeam'</span>] <span class="op">=</span>betting_data[<span class="st">'HomeTeam'</span>].<span class="bu">apply</span>(snake_case)</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>betting_data[<span class="st">'AwayTeam'</span>] <span class="op">=</span>betting_data[<span class="st">'AwayTeam'</span>].<span class="bu">apply</span>(<span class="bu">str</span>)</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>betting_data[<span class="st">'AwayTeam'</span>] <span class="op">=</span>betting_data[<span class="st">'AwayTeam'</span>].<span class="bu">apply</span>(snake_case)</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>betting_data[<span class="st">'HomeTeam'</span>] <span class="op">=</span> betting_data[<span class="st">'HomeTeam'</span>].replace(key_dict)</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>betting_data[<span class="st">'AwayTeam'</span>] <span class="op">=</span> betting_data[<span class="st">'AwayTeam'</span>].replace(key_dict)</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>match_data[<span class="st">'home_team'</span>] <span class="op">=</span>match_data[<span class="st">'home_team'</span>].<span class="bu">apply</span>(<span class="bu">str</span>)</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>match_data[<span class="st">'home_team'</span>] <span class="op">=</span>match_data[<span class="st">'home_team'</span>].<span class="bu">apply</span>(snake_case)</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>match_data[<span class="st">'away_team'</span>] <span class="op">=</span>match_data[<span class="st">'away_team'</span>].<span class="bu">apply</span>(<span class="bu">str</span>)</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>match_data[<span class="st">'away_team'</span>] <span class="op">=</span>match_data[<span class="st">'away_team'</span>].<span class="bu">apply</span>(snake_case)</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>match_data[<span class="st">'Hohome_teammeTeam'</span>] <span class="op">=</span> match_data[<span class="st">'home_team'</span>].replace(key_dict)</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>match_data[<span class="st">'away_team'</span>] <span class="op">=</span> match_data[<span class="st">'away_team'</span>].replace(key_dict)</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>month_key <span class="op">=</span> {<span class="st">'August'</span>: <span class="st">'8'</span>, <span class="st">'September'</span>:<span class="st">'9'</span>, <span class="st">'October'</span>:<span class="st">'10'</span>, <span class="st">'November'</span>: <span class="st">'11'</span>,<span class="st">'December'</span>:<span class="st">'12'</span>, <span class="st">'January'</span>:<span class="st">'1'</span>, <span class="st">'February'</span>:<span class="st">'2'</span>, <span class="st">'March'</span>:<span class="st">'3'</span>, <span class="st">'April'</span>:<span class="st">'4'</span>, <span class="st">'May'</span>:<span class="st">'5'</span>, <span class="st">'June'</span> : <span class="st">'6'</span>, <span class="st">'July'</span>:<span class="st">'7'</span>}</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>match_data[<span class="st">'month'</span>]<span class="op">=</span> match_data[<span class="st">'month'</span>].replace(month_key)</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>match_data[<span class="st">'date'</span>] <span class="op">=</span> match_data[<span class="st">'day_of_month'</span>].astype(<span class="bu">str</span>) <span class="op">+</span> <span class="st">"-"</span> <span class="op">+</span> match_data[<span class="st">'month'</span>].astype(<span class="bu">str</span>) <span class="op">+</span> <span class="st">"-"</span> <span class="op">+</span> match_data[<span class="st">'year'</span>].astype(<span class="bu">str</span>)</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>match_data[<span class="st">'date'</span>] <span class="op">=</span> pd.to_datetime(match_data[<span class="st">'date'</span>])</span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>betting_data[<span class="st">'Date'</span>] <span class="op">=</span> pd.to_datetime(betting_data[<span class="st">'Date'</span>])</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>merged_df <span class="op">=</span> pd.merge(match_data, betting_data, left_on <span class="op">=</span> [<span class="st">'date'</span>, <span class="st">'home_team'</span>, <span class="st">'away_team'</span>], right_on <span class="op">=</span> [<span class="st">'Date'</span>, <span class="st">'HomeTeam'</span>, <span class="st">'AwayTeam'</span>], how <span class="op">=</span><span class="st">'left'</span>, indicator<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> merged_df</span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> data[data[<span class="st">'year'</span>]<span class="op">&lt;=</span> <span class="dv">2019</span>]</span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> data[[<span class="st">'home_team'</span>,<span class="st">'away_team'</span>,<span class="st">'home_score'</span>,<span class="st">'away_score'</span>,<span class="st">'date'</span>,<span class="st">'time'</span>,<span class="st">'day_of_week'</span>,<span class="st">'attendance'</span>,<span class="st">'Div'</span>,<span class="st">'FTHG'</span>,<span class="st">'FTAG'</span>,<span class="st">'FTR'</span>,<span class="st">'HTHG'</span>,<span class="st">'HTAG'</span>,<span class="st">'HTR'</span>,<span class="st">'B365H'</span>,<span class="st">'B365D'</span>,<span class="st">'B365A'</span>,<span class="st">'BWH'</span>,<span class="st">'BWD'</span>,<span class="st">'BWA'</span>,<span class="st">'WHH'</span>,<span class="st">'WHD'</span>,<span class="st">'WHA'</span>,<span class="st">'VCH'</span>,<span class="st">'VCD'</span>,<span class="st">'VCA'</span>,<span class="st">'BbMx&gt;2.5'</span>,<span class="st">'BbAv&gt;2.5'</span>,<span class="st">'BbMx&lt;2.5'</span>,<span class="st">'BbAv&lt;2.5'</span>]]</span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> data.rename(columns <span class="op">=</span> {<span class="st">'attendance'</span>:<span class="st">'raw_attendance'</span>})</span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> data[data[<span class="st">'raw_attendance'</span>].<span class="bu">str</span>.contains(<span class="st">'\d'</span>)]</span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'raw_attendance'</span>] <span class="op">=</span> data[<span class="st">'raw_attendance'</span>].astype(<span class="bu">float</span>)</span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a><span class="co"># data['Capacity'] = data['Capacity'].astype(float)</span></span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> remove_non_numberics(s):</span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> sub(<span class="st">'[^0-9]'</span>, <span class="st">''</span>, s)</span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'away_score'</span>] <span class="op">=</span> data[<span class="st">'away_score'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: re.sub(<span class="st">'[^0-9]'</span>, <span class="st">''</span>, x))</span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a><span class="co"># Alter Data types:</span></span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a>data<span class="op">=</span> data.rename(columns<span class="op">=</span>{ <span class="st">'Div'</span>:<span class="st">'division'</span>})</span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'home_score'</span>]<span class="op">=</span> data[<span class="st">'home_score'</span>].astype(<span class="bu">int</span>)</span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'away_score'</span>] <span class="op">=</span> data[<span class="st">'away_score'</span>].astype(<span class="bu">int</span>)</span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'date'</span>] <span class="op">=</span> data[<span class="st">'date'</span>].astype(<span class="bu">str</span>)</span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a><span class="co"># data['time'] = data['time'].apply(lambda x: datetime.strptime(x, '%H:%M'))</span></span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'date_time'</span>] <span class="op">=</span> data.<span class="bu">apply</span>(<span class="kw">lambda</span> row: pd.to_datetime(<span class="bu">str</span>(row[<span class="st">'date'</span>]) <span class="op">+</span> <span class="st">' '</span> <span class="op">+</span> <span class="bu">str</span>(row[<span class="st">'time'</span>])),axis <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'raw_attendance'</span>]<span class="op">=</span> data[<span class="st">'raw_attendance'</span>].astype(<span class="bu">int</span>)</span>
<span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a>season <span class="op">=</span> []</span>
<span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> index, rows <span class="kw">in</span> data.iterrows():</span>
<span id="cb2-66"><a href="#cb2-66" aria-hidden="true" tabindex="-1"></a>    match_day <span class="op">=</span> dt.strptime(rows[<span class="st">'date'</span>], <span class="st">'%Y-%m-</span><span class="sc">%d</span><span class="st">'</span>)</span>
<span id="cb2-67"><a href="#cb2-67" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(match_day)</span></span>
<span id="cb2-68"><a href="#cb2-68" aria-hidden="true" tabindex="-1"></a>    year <span class="op">=</span> <span class="bu">int</span>(dt.strftime(match_day, <span class="st">'%Y'</span>))</span>
<span id="cb2-69"><a href="#cb2-69" aria-hidden="true" tabindex="-1"></a>    month_day <span class="op">=</span> dt.strftime(match_day, <span class="st">'%m-</span><span class="sc">%d</span><span class="st">'</span>)</span>
<span id="cb2-70"><a href="#cb2-70" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(int(year))</span></span>
<span id="cb2-71"><a href="#cb2-71" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(type(year))</span></span>
<span id="cb2-72"><a href="#cb2-72" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(month_day)</span></span>
<span id="cb2-73"><a href="#cb2-73" aria-hidden="true" tabindex="-1"></a>    cutoff_date <span class="op">=</span> dt.strftime(dt(<span class="dv">2014</span>,<span class="dv">7</span>,<span class="dv">14</span>), <span class="st">'%m-</span><span class="sc">%d</span><span class="st">'</span>)</span>
<span id="cb2-74"><a href="#cb2-74" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> month_day <span class="op">&gt;</span> cutoff_date:</span>
<span id="cb2-75"><a href="#cb2-75" aria-hidden="true" tabindex="-1"></a>        year <span class="op">=</span> year <span class="op">+</span><span class="dv">1</span></span>
<span id="cb2-76"><a href="#cb2-76" aria-hidden="true" tabindex="-1"></a>        season <span class="op">=</span> season <span class="op">+</span> [year]</span>
<span id="cb2-77"><a href="#cb2-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-78"><a href="#cb2-78" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb2-79"><a href="#cb2-79" aria-hidden="true" tabindex="-1"></a>        season <span class="op">=</span> season <span class="op">+</span> [year]</span>
<span id="cb2-80"><a href="#cb2-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-81"><a href="#cb2-81" aria-hidden="true" tabindex="-1"></a><span class="co"># def stand_dev(x): return np.std(x)</span></span>
<span id="cb2-82"><a href="#cb2-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-83"><a href="#cb2-83" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'season'</span>] <span class="op">=</span> season</span>
<span id="cb2-84"><a href="#cb2-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-85"><a href="#cb2-85" aria-hidden="true" tabindex="-1"></a>data_std <span class="op">=</span> data.groupby([<span class="st">'home_team'</span>, <span class="st">'season'</span>])[<span class="st">'raw_attendance'</span>].std().reset_index()</span>
<span id="cb2-86"><a href="#cb2-86" aria-hidden="true" tabindex="-1"></a>data_std <span class="op">=</span> data_std.rename(columns <span class="op">=</span> {<span class="st">'raw_attendance'</span>:<span class="st">'std_attend'</span>})</span>
<span id="cb2-87"><a href="#cb2-87" aria-hidden="true" tabindex="-1"></a>data_mean <span class="op">=</span> data.groupby([<span class="st">'home_team'</span>, <span class="st">'season'</span>]).mean().reset_index()</span>
<span id="cb2-88"><a href="#cb2-88" aria-hidden="true" tabindex="-1"></a>data_mean <span class="op">=</span> data_mean[[<span class="st">'home_team'</span>, <span class="st">'season'</span>, <span class="st">'raw_attendance'</span>]].rename(columns <span class="op">=</span> {<span class="st">'raw_attendance'</span>: <span class="st">'mean_attend'</span>})</span>
<span id="cb2-89"><a href="#cb2-89" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> pd.merge(data, data_mean, on <span class="op">=</span> [<span class="st">'home_team'</span>, <span class="st">'season'</span>])</span>
<span id="cb2-90"><a href="#cb2-90" aria-hidden="true" tabindex="-1"></a>total_data <span class="op">=</span> pd.merge(data, data_std, on<span class="op">=</span> [<span class="st">'home_team'</span>, <span class="st">'season'</span>])</span>
<span id="cb2-91"><a href="#cb2-91" aria-hidden="true" tabindex="-1"></a>total_data[<span class="st">'standard_attend'</span>] <span class="op">=</span> (total_data[<span class="st">'raw_attendance'</span>]<span class="op">-</span>total_data[<span class="st">'mean_attend'</span>])<span class="op">/</span> total_data[<span class="st">'std_attend'</span>]</span>
<span id="cb2-92"><a href="#cb2-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-93"><a href="#cb2-93" aria-hidden="true" tabindex="-1"></a>total_data <span class="op">=</span> total_data[total_data[<span class="st">'division'</span>] <span class="op">!=</span> <span class="st">'SC2'</span>]</span>
<span id="cb2-94"><a href="#cb2-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-95"><a href="#cb2-95" aria-hidden="true" tabindex="-1"></a>div_dict <span class="op">=</span> {<span class="st">'D1'</span>:<span class="st">'Bundesliga'</span>, <span class="st">'D2'</span>: <span class="st">'2. Bundesliga'</span>, <span class="st">'E0'</span>:<span class="st">'Premier League'</span>, <span class="st">'E1'</span>:<span class="st">'Championship'</span>, </span>
<span id="cb2-96"><a href="#cb2-96" aria-hidden="true" tabindex="-1"></a>            <span class="st">'E2'</span>:<span class="st">'League 1'</span>, <span class="st">'E3'</span>:<span class="st">'League 2'</span>,<span class="st">'SP1'</span>:<span class="st">'La Liga Primera'</span>, <span class="st">'SP2'</span>:<span class="st">'La Liga Segunda'</span>,</span>
<span id="cb2-97"><a href="#cb2-97" aria-hidden="true" tabindex="-1"></a>              <span class="st">'B1'</span>:<span class="st">'Jupiler League'</span>, <span class="st">'F1'</span>:<span class="st">'Ligue 1'</span>,<span class="st">'F2'</span>:<span class="st">'Ligue 2'</span>,<span class="st">'I1'</span>:<span class="st">'Serie A'</span>,<span class="st">'I2'</span>:<span class="st">'Serie B'</span>, </span>
<span id="cb2-98"><a href="#cb2-98" aria-hidden="true" tabindex="-1"></a>              <span class="st">'SC0'</span>:<span class="st">'Scottish Premier League'</span>, <span class="st">'SC1'</span>:<span class="st">'Scottish Division 1'</span>, <span class="st">'T1'</span>:<span class="st">'Fubol Ligi 1'</span>, <span class="st">'P1'</span>: <span class="st">'Liga 1'</span>}</span>
<span id="cb2-99"><a href="#cb2-99" aria-hidden="true" tabindex="-1"></a>divisions_list <span class="op">=</span>[<span class="st">'D1'</span>, <span class="st">'D2'</span>, <span class="st">'E0'</span>, <span class="st">'E1'</span>, <span class="st">'E2'</span>, <span class="st">'E3'</span>, <span class="st">'SP1'</span> ,<span class="st">'SP2'</span>, <span class="st">'B1'</span>, <span class="st">'F1'</span>, <span class="st">'F2'</span>, <span class="st">'I1'</span>, <span class="st">'I2'</span>, <span class="st">'SC0'</span>, <span class="st">'SC1'</span>, <span class="st">'T1'</span>, <span class="st">'P1'</span>]</span>
<span id="cb2-100"><a href="#cb2-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-101"><a href="#cb2-101" aria-hidden="true" tabindex="-1"></a>total_data[<span class="st">'home_team'</span>] <span class="op">=</span> total_data[<span class="st">'home_team'</span>].<span class="bu">str</span>.replace(<span class="st">'_'</span>, <span class="st">' '</span>).<span class="bu">apply</span>(<span class="kw">lambda</span> x: x.title())</span>
<span id="cb2-102"><a href="#cb2-102" aria-hidden="true" tabindex="-1"></a>total_data[<span class="st">'away_team'</span>] <span class="op">=</span> total_data[<span class="st">'away_team'</span>].<span class="bu">str</span>.replace(<span class="st">'_'</span>, <span class="st">' '</span>).<span class="bu">apply</span>(<span class="kw">lambda</span> x: x.title())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>All of the CSV files from Football-data.co.uk were combined together, resulting in two datasets, one with all of the betting data and the other with the attendance. The two datasets were to be combined on the home team name, away team name, and the date and time of the game to create one final dataset. However, issues arose as they had different naming structures for team names. For example, the team Manchester City in one dataset would be identified as “man_city” and in the other as “manchester_city”. With these different naming structures and spellings, a list of team names was created from both datasets. These lists were put through a python script that took a team from one list and compared the characters to team names in the other list. I stated with one entire team name and slowly decreasing its size, searching the other list for matches. The table below demonstrates how team names would be split up into a list of smaller strings. This would be repeated until the team list was broken up into single characters.</p>
<table class="table">
<thead>
<tr class="header">
<th>Itteration</th>
<th>Results</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>man_city</td>
</tr>
<tr class="even">
<td>2</td>
<td>man_cit, an_city</td>
</tr>
<tr class="odd">
<td>3</td>
<td>man_ci, an_cit, n_city</td>
</tr>
<tr class="even">
<td>4</td>
<td>man_c, an_ci, n_cit, _city</td>
</tr>
<tr class="odd">
<td>…</td>
<td>…</td>
</tr>
<tr class="even">
<td>8</td>
<td>m,a,n,_,c,i,t,y</td>
</tr>
</tbody>
</table>
<p>The gif below demonstrates the python script used to assist in matching team names from one list to another. Starting from the largest length of a team name, the program would look through the other list for any matching character combinations.</p>
<p><img src="Header%20Image/name_compare.gif" class="img-fluid"></p>
<p>What resulted is a list of potential matching teams, with the most similar name at the top. Then I would determine from the suggestion what was the correct matching team name was. From this a key was created to make the two data sets have a matching naming structure for home and away teams. The data sets were now able to be combined. The resulting data set had 79673 rows and 172 columns, where each row represented individual match.</p>
<p>However, more processing was needed. Although the initial dataset collected data all the way to 2023, the data was filtered to only include 2010 to 2019. This filtering was due to the COVID-19 pandemic. During the pandemic, attendance basically ceased to occur for matches. Additionally, some leagues canceled the remaining matches for the season.</p>
<p>Certain leagues were removed from the dataset. The Scottish Division 2 and Division 3 leagues, as well as the Ethniki Katigoria, which is the Greek top league, were removed. This is due to them having several missing values for many variables. Some matches from a variety of leagues had missing values only for the betting variables. These matches were used during the analysis of day &amp; time and the impact of the away team. However, they were dropped from the dataset for analysis of betting data and in the modeling.</p>
<p>Lastly, a few new variables were added. The first variable added was the season during which the match occurred. Although leagues end on different dates in different years, the date selected for the seasons to change was July 14th. Most leagues conclude at the beginning of June and resume at the beginning of August. July is predominantly used for international games. Although there were a couple of matches that occurred in July from 2010-2019, July 14th was the only date with zero matches played. So it was used as the cutoff point.</p>
<p>The other variables created were the mean and standard deviation of the home team for that season and the z-score of that individual match. The mean and standard deviation were based upon the home team’s attendance for that season. The z-score is the standardization of the match’s attendance (number of standard deviations above or below the mean) in relation to the home team’s average attendance for that particular season.</p>
<section id="final-dataset" class="level2">
<h2 class="anchored" data-anchor-id="final-dataset">Final Dataset</h2>
<p>The resulting dataset consisted of 53,224 rows and 29 columns. The descriptions of variables can be viewed in the <a href="https://matthewlwilcox.github.io/Capstone/doc/data_dictionary.html">data dictionary</a>.</p>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>total_data <span class="op">=</span> total_data[[<span class="st">'home_team'</span>, <span class="st">'away_team'</span>,  <span class="st">'date'</span>, <span class="st">'time'</span>,</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>       <span class="st">'day_of_week'</span>, <span class="st">'raw_attendance'</span>, <span class="st">'division'</span>,  <span class="st">'FTR'</span>,</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>       <span class="st">'B365H'</span>, <span class="st">'B365D'</span>, <span class="st">'B365A'</span>, <span class="st">'BWH'</span>, <span class="st">'BWD'</span>, <span class="st">'BWA'</span>,</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>       <span class="st">'WHH'</span>, <span class="st">'WHD'</span>, <span class="st">'WHA'</span>, <span class="st">'VCH'</span>, <span class="st">'VCD'</span>, <span class="st">'VCA'</span>, <span class="st">'BbMx&gt;2.5'</span>, <span class="st">'BbAv&gt;2.5'</span>,</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>       <span class="st">'BbMx&lt;2.5'</span>, <span class="st">'BbAv&lt;2.5'</span>, <span class="st">'date_time'</span>, <span class="st">'season'</span>, <span class="st">'mean_attend'</span>,</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>       <span class="st">'std_attend'</span>, <span class="st">'standard_attend'</span>]]</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>total_data.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>home_team</th>
      <th>away_team</th>
      <th>date</th>
      <th>time</th>
      <th>day_of_week</th>
      <th>raw_attendance</th>
      <th>division</th>
      <th>FTR</th>
      <th>B365H</th>
      <th>B365D</th>
      <th>...</th>
      <th>VCA</th>
      <th>BbMx&gt;2.5</th>
      <th>BbAv&gt;2.5</th>
      <th>BbMx&lt;2.5</th>
      <th>BbAv&lt;2.5</th>
      <th>date_time</th>
      <th>season</th>
      <th>mean_attend</th>
      <th>std_attend</th>
      <th>standard_attend</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Tottenham Hotspur</td>
      <td>Manchester City</td>
      <td>2010-08-14</td>
      <td>12:45</td>
      <td>Saturday</td>
      <td>35928</td>
      <td>E0</td>
      <td>D</td>
      <td>2.40</td>
      <td>3.30</td>
      <td>...</td>
      <td>3.1</td>
      <td>2.03</td>
      <td>1.91</td>
      <td>1.95</td>
      <td>1.84</td>
      <td>2010-08-14 12:45:00</td>
      <td>2011</td>
      <td>35892.894737</td>
      <td>269.766338</td>
      <td>0.130132</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Tottenham Hotspur</td>
      <td>Wigan Athletic</td>
      <td>2010-08-28</td>
      <td>15:00</td>
      <td>Saturday</td>
      <td>35101</td>
      <td>E0</td>
      <td>A</td>
      <td>1.25</td>
      <td>5.75</td>
      <td>...</td>
      <td>13.0</td>
      <td>1.55</td>
      <td>1.50</td>
      <td>2.63</td>
      <td>2.48</td>
      <td>2010-08-28 15:00:00</td>
      <td>2011</td>
      <td>35892.894737</td>
      <td>269.766338</td>
      <td>-2.935484</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Tottenham Hotspur</td>
      <td>Wolverhampton Wanderers</td>
      <td>2010-09-18</td>
      <td>15:00</td>
      <td>Saturday</td>
      <td>35940</td>
      <td>E0</td>
      <td>H</td>
      <td>1.40</td>
      <td>4.50</td>
      <td>...</td>
      <td>8.0</td>
      <td>1.85</td>
      <td>1.75</td>
      <td>2.11</td>
      <td>2.02</td>
      <td>2010-09-18 15:00:00</td>
      <td>2011</td>
      <td>35892.894737</td>
      <td>269.766338</td>
      <td>0.174615</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Tottenham Hotspur</td>
      <td>Everton Fc</td>
      <td>2010-10-23</td>
      <td>12:45</td>
      <td>Saturday</td>
      <td>35967</td>
      <td>E0</td>
      <td>D</td>
      <td>2.10</td>
      <td>3.25</td>
      <td>...</td>
      <td>4.0</td>
      <td>2.07</td>
      <td>1.99</td>
      <td>1.87</td>
      <td>1.79</td>
      <td>2010-10-23 12:45:00</td>
      <td>2011</td>
      <td>35892.894737</td>
      <td>269.766338</td>
      <td>0.274702</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Tottenham Hotspur</td>
      <td>Sunderland Afc</td>
      <td>2010-09-11</td>
      <td>20:00</td>
      <td>Tuesday</td>
      <td>35843</td>
      <td>E0</td>
      <td>D</td>
      <td>1.53</td>
      <td>4.00</td>
      <td>...</td>
      <td>7.0</td>
      <td>1.90</td>
      <td>1.80</td>
      <td>2.06</td>
      <td>1.97</td>
      <td>2010-09-11 20:00:00</td>
      <td>2011</td>
      <td>35892.894737</td>
      <td>269.766338</td>
      <td>-0.184955</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 29 columns</p>
</div>
</div>
</div>
</section>
</section>
<section id="date-time" class="level1">
<h1>Date &amp; Time</h1>
<p>Now that the data has been processed, we can begin to look at how a variety of factors impact attendance for football matches. The first factor that will be evaluated is the date and time of individual matches. We will examine the impact of the day of the week, time of the match, and the calendar date.</p>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>time_df <span class="op">=</span> total_data[[</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">'date'</span>, <span class="st">'time'</span>, <span class="st">'day_of_week'</span>, <span class="st">'date_time'</span>, <span class="st">'raw_attendance'</span>, <span class="st">'standard_attend'</span>, <span class="st">'division'</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="day-of-the-week" class="level2">
<h2 class="anchored" data-anchor-id="day-of-the-week">Day of the Week</h2>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Grouping of the data</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>df_grouped_median <span class="op">=</span> time_df.groupby(<span class="st">'day_of_week'</span>)[<span class="st">'raw_attendance'</span>,  <span class="st">'standard_attend'</span>].median().reset_index()</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Making Day of the week categorical type to maintain order on graphs</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>day_categories <span class="op">=</span> [<span class="st">'Monday'</span>, <span class="st">'Tuesday'</span>, <span class="st">'Wednesday'</span>, <span class="st">'Thursday'</span>, <span class="st">'Friday'</span>, <span class="st">'Saturday'</span>, <span class="st">'Sunday'</span>]</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>df_grouped_median[<span class="st">'day_of_week'</span>] <span class="op">=</span> pd.Categorical(df_grouped_median[<span class="st">'day_of_week'</span>], categories<span class="op">=</span> day_categories)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>df_grouped_median.sort_values(by <span class="op">=</span> <span class="st">'day_of_week'</span>, inplace <span class="op">=</span> <span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Before we can make graphs and plots to analyze the attendance by day of the week, we need to group the data. For this we grouped the data by the day of the week (ex: Sunday, Monday, etc) and took the median attendance for each group.</p>
<div class="cell" data-execution_count="6">
<details>
<summary>Day of the Week Median Plot</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>sns.barplot(</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    data<span class="op">=</span>df_grouped_median, </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="st">'day_of_week'</span>, </span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> <span class="st">'raw_attendance'</span>,</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    color <span class="op">=</span> <span class="st">'#0047AB'</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    ).<span class="bu">set</span>(title <span class="op">=</span><span class="st">'Median Attendance by Day of the Week'</span>)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">90</span>)</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Day of the Week'</span>)</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Median Attendance'</span>)</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-day_median_attend" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="Blog_post_files/figure-html/fig-day_median_attend-output-1.png" width="610" height="506" class="figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;1: Median Attendance by Day of the Week</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>First, in <a href="#fig-day_median_attend">Figure&nbsp;1</a>, the average attendance for matches is viewed by the day of the week. Wednesday and Sunday have the highest average attendance while Tuesday has the lowest. It is striking that Wednesday has the highest average attendance. Most would expect weekday matches to have lower attendance while games on weekends, especially Saturday, would have higher attendance.</p>
<div class="cell" data-execution_count="7">
<details>
<summary>Day of the Week Total Count</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>grouped_week_count <span class="op">=</span> time_df.groupby(<span class="st">'day_of_week'</span>).count().reset_index()</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>grouped_week_count[<span class="st">'day_of_week'</span>] <span class="op">=</span> pd.Categorical(grouped_week_count[<span class="st">'day_of_week'</span>], categories<span class="op">=</span> day_categories)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>grouped_week_count.sort_values(by <span class="op">=</span> <span class="st">'day_of_week'</span>, inplace <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>sns.barplot(data <span class="op">=</span> grouped_week_count, x <span class="op">=</span> <span class="st">'day_of_week'</span>, y <span class="op">=</span> <span class="st">'date'</span>,</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    color <span class="op">=</span> <span class="st">'#0047AB'</span>)</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Day of the Week'</span>)</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Count'</span>)</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Number of Games per Day of the Week'</span>)</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-count_day" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="Blog_post_files/figure-html/fig-count_day-output-1.png" width="610" height="442" class="figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;2: Number of games per day of the week</figcaption><p></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-execution_count="8">
<details>
<summary>Number of games per day of week divided by league</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>grouped_week_count_division <span class="op">=</span>  time_df.groupby([<span class="st">'day_of_week'</span>, <span class="st">'division'</span>]).count().reset_index()</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>grouped_week_count_division[<span class="st">'day_of_week'</span>] <span class="op">=</span> pd.Categorical(grouped_week_count_division[<span class="st">'day_of_week'</span>], categories<span class="op">=</span> day_categories)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>grouped_week_count_division.sort_values(by <span class="op">=</span> <span class="st">'day_of_week'</span>, inplace <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>grouped_week_count_division <span class="op">=</span> grouped_week_count_division[[<span class="st">'day_of_week'</span>, <span class="st">'division'</span>, <span class="st">'date'</span>]]</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>total_div_number <span class="op">=</span> grouped_week_count_division.groupby(<span class="st">'day_of_week'</span>).<span class="bu">sum</span>().reset_index()</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="co"># print(total_div_number)</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>rose_df <span class="op">=</span> pd.merge(grouped_week_count_division, total_div_number, on<span class="op">=</span> <span class="st">'day_of_week'</span>)</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>rose_df[<span class="st">'pct'</span>] <span class="op">=</span> rose_df[<span class="st">'date_x'</span>]<span class="op">/</span>rose_df[<span class="st">'date_y'</span>]</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="co"># print(rose_df)</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>rose_df[<span class="st">'League'</span>] <span class="op">=</span> rose_df[<span class="st">'division'</span>]</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>div_dict2 <span class="op">=</span> {<span class="st">'D1'</span>:<span class="st">'Bundesliga (1st Div)'</span>, <span class="st">'D2'</span>: <span class="st">'2. Bundesliga (2nd Div)'</span>, <span class="st">'E0'</span>:<span class="st">'Premier League (1st Div)'</span>, <span class="st">'E1'</span>:<span class="st">'Championship (2nd Div)'</span>, </span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>            <span class="st">'E2'</span>:<span class="st">'League 1 (3rd Div)'</span>, <span class="st">'E3'</span>:<span class="st">'League 2 (4th Div)'</span>,<span class="st">'SP1'</span>:<span class="st">'La Liga Primera (1st Div)'</span>, <span class="st">'SP2'</span>:<span class="st">'La Liga Segunda (2nd Div)'</span>,</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>              <span class="st">'B1'</span>:<span class="st">'Jupiler League (1st Div)'</span>, <span class="st">'F1'</span>:<span class="st">'Ligue 1 (1st Div)'</span>,<span class="st">'F2'</span>:<span class="st">'Ligue 2 (2nd Div)'</span>,<span class="st">'I1'</span>:<span class="st">'Serie A (1st Div)'</span>,<span class="st">'I2'</span>:<span class="st">'Serie B (2nd Div)'</span>, </span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>              <span class="st">'SC0'</span>:<span class="st">'Scottish Premier League (1st Div)'</span>, <span class="st">'SC1'</span>:<span class="st">'Scottish Division 1 (2nd Div)'</span>, <span class="st">'T1'</span>:<span class="st">'Fubol Ligi 1 (1st Div)'</span>, <span class="st">'P1'</span>: <span class="st">'Liga 1 (1st Div)'</span>}</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>rose_df <span class="op">=</span> rose_df.replace({<span class="st">'League'</span>:div_dict2})</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>rose_df</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>colors <span class="op">=</span> px.colors.qualitative.Light24 <span class="op">+</span> px.colors.qualitative.Alphabet </span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> px.bar_polar(rose_df, theta <span class="op">=</span> <span class="st">'day_of_week'</span>, r <span class="op">=</span> <span class="st">'pct'</span>, color <span class="op">=</span> <span class="st">'League'</span>, color_discrete_sequence<span class="op">=</span> colors)</span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>fig.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="fig-day_median_attend_div" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">

<div>                            <div id="6d7132d5-c893-4e42-86a0-906e2d84c513" class="plotly-graph-div" style="height:525px; width:100%;"></div>            <script type="text/javascript">                require(["plotly"], function(Plotly) {                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById("6d7132d5-c893-4e42-86a0-906e2d84c513")) {                    Plotly.newPlot(                        "6d7132d5-c893-4e42-86a0-906e2d84c513",                        [{"hovertemplate":"League=Fubol Ligi 1 (1st Div)<br>pct=%{r}<br>day_of_week=%{theta}<extra></extra>","legendgroup":"Fubol Ligi 1 (1st Div)","marker":{"color":"#FD3216","pattern":{"shape":""}},"name":"Fubol Ligi 1 (1st Div)","r":[0.03264758497316637,0.00046425255338904364,0.00387382401770891,0.01511879049676026,0.013588516746411483,0.008769218882793788,0.020751078872463503],"showlegend":true,"subplot":"polar","theta":["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],"type":"barpolar"},{"hovertemplate":"League=La Liga Segunda (2nd Div)<br>pct=%{r}<br>day_of_week=%{theta}<extra></extra>","legendgroup":"La Liga Segunda (2nd Div)","marker":{"color":"#00FE35","pattern":{"shape":""}},"name":"La Liga Segunda (2nd Div)","r":[0.03622540250447227,0.009052924791086351,0.04261206419479801,0.0755939524838013,0.042870813397129184,0.07776404233948853,0.1751905242861078],"showlegend":true,"subplot":"polar","theta":["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],"type":"barpolar"},{"hovertemplate":"League=La Liga Primera (1st Div)<br>pct=%{r}<br>day_of_week=%{theta}<extra></extra>","legendgroup":"La Liga Primera (1st Div)","marker":{"color":"#6A76FC","pattern":{"shape":""}},"name":"La Liga Primera (1st Div)","r":[0.09794275491949911,0.015784586815227482,0.07913669064748201,0.15334773218142547,0.03617224880382775,0.045854902263771924,0.12312918923882105],"showlegend":true,"subplot":"polar","theta":["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],"type":"barpolar"},{"hovertemplate":"League=Scottish Division 1 (2nd Div)<br>pct=%{r}<br>day_of_week=%{theta}<extra></extra>","legendgroup":"Scottish Division 1 (2nd Div)","marker":{"color":"#FED4C4","pattern":{"shape":""}},"name":"Scottish Division 1 (2nd Div)","r":[0.0022361359570661895,0.024837511606313836,0.008301051466519093,0.0021598272138228943,0.008995215311004785,0.03063431970949548,0.0023872922596639428],"showlegend":true,"subplot":"polar","theta":["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],"type":"barpolar"},{"hovertemplate":"League=Scottish Premier League (1st Div)<br>pct=%{r}<br>day_of_week=%{theta}<extra></extra>","legendgroup":"Scottish Premier League (1st Div)","marker":{"color":"#FE00CE","pattern":{"shape":""}},"name":"Scottish Premier League (1st Div)","r":[0.0031305903398926656,0.012070566388115135,0.0752628666297731,0.023758099352051837,0.010526315789473684,0.027698369775168045,0.0124873748967037],"showlegend":true,"subplot":"polar","theta":["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],"type":"barpolar"},{"hovertemplate":"League=Liga 1 (1st Div)<br>pct=%{r}<br>day_of_week=%{theta}<extra></extra>","legendgroup":"Liga 1 (1st Div)","marker":{"color":"#0DF9FF","pattern":{"shape":""}},"name":"Liga 1 (1st Div)","r":[0.08050089445438283,0.00255338904363974,0.01992252351964582,0.04535637149028078,0.038086124401913876,0.021324267944062426,0.0668441832705904],"showlegend":true,"subplot":"polar","theta":["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],"type":"barpolar"},{"hovertemplate":"League=Serie B (2nd Div)<br>pct=%{r}<br>day_of_week=%{theta}<extra></extra>","legendgroup":"Serie B (2nd Div)","marker":{"color":"#F6F926","pattern":{"shape":""}},"name":"Serie B (2nd Div)","r":[0.09302325581395349,0.0786908077994429,0.05257332595462092,0.1857451403887689,0.05722488038277512,0.08054546859306189,0.04949040492149481],"showlegend":true,"subplot":"polar","theta":["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],"type":"barpolar"},{"hovertemplate":"League=Serie A (1st Div)<br>pct=%{r}<br>day_of_week=%{theta}<extra></extra>","legendgroup":"Serie A (1st Div)","marker":{"color":"#FF9616","pattern":{"shape":""}},"name":"Serie A (1st Div)","r":[0.06976744186046512,0.012999071494893221,0.1588267847260653,0.08855291576673865,0.012057416267942584,0.028161940817430273,0.18051602240381967],"showlegend":true,"subplot":"polar","theta":["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],"type":"barpolar"},{"hovertemplate":"League=Ligue 2 (2nd Div)<br>pct=%{r}<br>day_of_week=%{theta}<extra></extra>","legendgroup":"Ligue 2 (2nd Div)","marker":{"color":"#479B55","pattern":{"shape":""}},"name":"Ligue 2 (2nd Div)","r":[0.12254025044722719,0.05153203342618384,0.006640841173215274,0.004319654427645789,0.4200956937799043,0.013134512864096422,0.000918189330639978],"showlegend":true,"subplot":"polar","theta":["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],"type":"barpolar"},{"hovertemplate":"League=Ligue 1 (1st Div)<br>pct=%{r}<br>day_of_week=%{theta}<extra></extra>","legendgroup":"Ligue 1 (1st Div)","marker":{"color":"#EEA6FB","pattern":{"shape":""}},"name":"Ligue 1 (1st Div)","r":[0.004919499105545617,0.016713091922005572,0.1223021582733813,0.019438444924406047,0.053014354066985646,0.07081047670555513,0.09879717197686162],"showlegend":true,"subplot":"polar","theta":["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],"type":"barpolar"},{"hovertemplate":"League=League 2 (4th Div)<br>pct=%{r}<br>day_of_week=%{theta}<extra></extra>","legendgroup":"League 2 (4th Div)","marker":{"color":"#DC587D","pattern":{"shape":""}},"name":"League 2 (4th Div)","r":[0.08810375670840787,0.2200557103064067,0.027116768123962368,0.058315334773218146,0.037894736842105266,0.14571583095109325,0.005325498117711872],"showlegend":true,"subplot":"polar","theta":["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],"type":"barpolar"},{"hovertemplate":"League=League 1 (3rd Div)<br>pct=%{r}<br>day_of_week=%{theta}<extra></extra>","legendgroup":"League 1 (3rd Div)","marker":{"color":"#D626FF","pattern":{"shape":""}},"name":"League 1 (3rd Div)","r":[0.08899821109123435,0.24071494893221912,0.040398450470392915,0.06695464362850972,0.030047846889952153,0.13860774163640577,0.012395555963639702],"showlegend":true,"subplot":"polar","theta":["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],"type":"barpolar"},{"hovertemplate":"League=Championship (2nd Div)<br>pct=%{r}<br>day_of_week=%{theta}<extra></extra>","legendgroup":"Championship (2nd Div)","marker":{"color":"#6E899C","pattern":{"shape":""}},"name":"Championship (2nd Div)","r":[0.09033989266547406,0.23885793871866295,0.12340896513558385,0.08423326133909287,0.05110047846889952,0.12705709650003863,0.01992470847488752],"showlegend":true,"subplot":"polar","theta":["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],"type":"barpolar"},{"hovertemplate":"League=Premier League (1st Div)<br>pct=%{r}<br>day_of_week=%{theta}<extra></extra>","legendgroup":"Premier League (1st Div)","marker":{"color":"#00B5F7","pattern":{"shape":""}},"name":"Premier League (1st Div)","r":[0.08989266547406083,0.04247910863509749,0.14333148865522966,0.09287257019438445,0.008038277511961723,0.07930927914702929,0.07694426590763015],"showlegend":true,"subplot":"polar","theta":["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],"type":"barpolar"},{"hovertemplate":"League=2. Bundesliga (2nd Div)<br>pct=%{r}<br>day_of_week=%{theta}<extra></extra>","legendgroup":"2. Bundesliga (2nd Div)","marker":{"color":"#B68E00","pattern":{"shape":""}},"name":"2. Bundesliga (2nd Div)","r":[0.09391771019677997,0.0127669452181987,0.03154399557277255,0.04319654427645788,0.11655502392344498,0.02263771923047207,0.07960701496648609],"showlegend":true,"subplot":"polar","theta":["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],"type":"barpolar"},{"hovertemplate":"League=Bundesliga (1st Div)<br>pct=%{r}<br>day_of_week=%{theta}<extra></extra>","legendgroup":"Bundesliga (1st Div)","marker":{"color":"#C9FBE5","pattern":{"shape":""}},"name":"Bundesliga (1st Div)","r":[0.005366726296958855,0.016248839368616527,0.05201992252351965,0.004319654427645789,0.05014354066985646,0.07096500038630921,0.05398953264163071],"showlegend":true,"subplot":"polar","theta":["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],"type":"barpolar"},{"hovertemplate":"League=Jupiler League (1st Div)<br>pct=%{r}<br>day_of_week=%{theta}<extra></extra>","legendgroup":"Jupiler League (1st Div)","marker":{"color":"#FF0092","pattern":{"shape":""}},"name":"Jupiler League (1st Div)","r":[0.0004472271914132379,0.004178272980501393,0.012728278915329275,0.0367170626349892,0.013588516746411483,0.011009812253727883,0.021301992470847488],"showlegend":true,"subplot":"polar","theta":["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],"type":"barpolar"}],                        {"template":{"data":{"histogram2dcontour":[{"type":"histogram2dcontour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"choropleth":[{"type":"choropleth","colorbar":{"outlinewidth":0,"ticks":""}}],"histogram2d":[{"type":"histogram2d","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmap":[{"type":"heatmap","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmapgl":[{"type":"heatmapgl","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"contourcarpet":[{"type":"contourcarpet","colorbar":{"outlinewidth":0,"ticks":""}}],"contour":[{"type":"contour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"surface":[{"type":"surface","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"mesh3d":[{"type":"mesh3d","colorbar":{"outlinewidth":0,"ticks":""}}],"scatter":[{"fillpattern":{"fillmode":"overlay","size":10,"solidity":0.2},"type":"scatter"}],"parcoords":[{"type":"parcoords","line":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolargl":[{"type":"scatterpolargl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"scattergeo":[{"type":"scattergeo","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolar":[{"type":"scatterpolar","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"scattergl":[{"type":"scattergl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatter3d":[{"type":"scatter3d","line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattermapbox":[{"type":"scattermapbox","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterternary":[{"type":"scatterternary","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattercarpet":[{"type":"scattercarpet","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"type":"carpet"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}],"barpolar":[{"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"pie":[{"automargin":true,"type":"pie"}]},"layout":{"autotypenumbers":"strict","colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"hovermode":"closest","hoverlabel":{"align":"left"},"paper_bgcolor":"white","plot_bgcolor":"#E5ECF6","polar":{"bgcolor":"#E5ECF6","angularaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"radialaxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"ternary":{"bgcolor":"#E5ECF6","aaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"baxis":{"gridcolor":"white","linecolor":"white","ticks":""},"caxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]]},"xaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"yaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"scene":{"xaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"yaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"zaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"geo":{"bgcolor":"white","landcolor":"#E5ECF6","subunitcolor":"white","showland":true,"showlakes":true,"lakecolor":"white"},"title":{"x":0.05},"mapbox":{"style":"light"}}},"polar":{"domain":{"x":[0.0,1.0],"y":[0.0,1.0]},"angularaxis":{"direction":"clockwise","rotation":90}},"legend":{"title":{"text":"League"},"tracegroupgap":0},"margin":{"t":60},"barmode":"relative"},                        {"responsive": true}                    ).then(function(){
                            
var gd = document.getElementById('6d7132d5-c893-4e42-86a0-906e2d84c513');
var x = new MutationObserver(function (mutations, observer) {{
        var display = window.getComputedStyle(gd).display;
        if (!display || display === 'none') {{
            console.log([gd, 'removed!']);
            Plotly.purge(gd);
            observer.disconnect();
        }}
}});

// Listen for the removal of the full notebook cells
var notebookContainer = gd.closest('#notebook-container');
if (notebookContainer) {{
    x.observe(notebookContainer, {childList: true});
}}

// Listen for the clearing of the current output cell
var outputEl = gd.closest('.output');
if (outputEl) {{
    x.observe(outputEl, {childList: true});
}}

                        })                };                });            </script>        </div>
<p></p><figcaption class="figure-caption">Figure&nbsp;3: Number of games per day of week divided by league</figcaption><p></p>
</figure>
</div>
</div>
<p><a href="#fig-count_day">Figure&nbsp;2</a> explains the suprising results that Wednesday had the highest average attendance instead of Saturday. Saturday had by far the highest number of games in comparison to any day of the week while Wednesday had significantly fewer games. This results in Saturday having more games from lower leagues, which tend to have lower attendance, decreasing the average attendance, while Wedneday had more games played by top leagues increasing its average attendance. This is confirmed in <a href="#fig-day_median_attend_div">Figure&nbsp;3</a>. Looking at the proportion of games on Saturday, lower leagues had a much higher proportion of games. Wednesday’s games on the other hand were predominantly composed of the top leagues in England, France, and Italy. The top leagues tend to have more highly attended games; hence Wednesday has the highest average attendance.</p>
</section>
<section id="time-of-day" class="level2">
<h2 class="anchored" data-anchor-id="time-of-day">Time of Day</h2>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>df_grouped_median_tod<span class="op">=</span> time_df.groupby(time_df[<span class="st">'date_time'</span>].dt.hour).median()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="10">
<details>
<summary>Plot Number of games by time of day</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>df_grouped_count <span class="op">=</span> time_df.groupby(time_df[<span class="st">'date_time'</span>].dt.hour).count()</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="co"># print(df_grouped_count)</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>df_grouped_count <span class="op">=</span> df_grouped_count[<span class="st">'raw_attendance'</span>].reset_index()</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>df_grouped_count[<span class="st">'count'</span>] <span class="op">=</span> df_grouped_count[<span class="st">'raw_attendance'</span>]</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>df_grouped_count <span class="op">=</span> df_grouped_count[[<span class="st">'date_time'</span>, <span class="st">'count'</span>]]</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="co"># df_grouped_count= df_grouped_count.rename(columns = {'date':'count'})</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="co"># print(df_grouped_count)</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>df_count_atted <span class="op">=</span> pd.merge(</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    df_grouped_count,df_grouped_median_tod, on <span class="op">=</span> <span class="st">'date_time'</span>)</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="co"># df_count_atted = df_count_atted.drop(columns= ['capacity_filled'])</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>df_count_atted.rename(</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>    columns <span class="op">=</span> {<span class="st">'raw_attendance'</span>: <span class="st">'Attendance'</span>, <span class="st">'count'</span>: <span class="st">"Number of Games"</span>}, </span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>    inplace<span class="op">=</span> <span class="va">True</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a><span class="co"># print(df_count_atted)</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>melted_count_attend <span class="op">=</span> pd.melt(</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>    df_count_atted, value_vars<span class="op">=</span>[<span class="st">'Number of Games'</span>, <span class="st">'Attendance'</span>],</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>     id_vars<span class="op">=</span> <span class="st">'date_time'</span>)</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a><span class="co"># print(melted_count_attend)</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>sns.lineplot(</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> melted_count_attend, x <span class="op">=</span> <span class="st">'date_time'</span>, y <span class="op">=</span> <span class="st">'value'</span>, hue <span class="op">=</span> <span class="st">'variable'</span>)</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Average Attendance and Total Game Count by Time of Day'</span>)</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Hour of the Day'</span>)</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Average Attendance/Number of Games'</span>)</span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>plt.legend().set_title(<span class="st">''</span>)</span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-attendance_time" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="Blog_post_files/figure-html/fig-attendance_time-output-1.png" width="610" height="442" class="figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;4: Attendance and Match Count by Time of Day</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>The time and day of a match resulted in a similar situation as the day of the week. In <a href="#fig-attendance_time">Figure&nbsp;4</a>, there were dips in attendance at 3 pm and 9 pm; however, these were also the most attended times for matches. 12 pm and 11 pm matches had the highest attendance on average however had a lower amount of games. So similarly with day of the week, the more matches that occured, the average attendance is skewed lower, while when less matches occur, the average attendance is skewed higher.</p>
</section>
<section id="calendar-date" class="level2">
<h2 class="anchored" data-anchor-id="calendar-date">Calendar Date</h2>
<div class="cell" data-execution_count="11">
<details>
<summary>Set up Data for Calendar Plots</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>calendar_plot_data <span class="op">=</span> total_data</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>calendar_plot_data[<span class="st">'month_day'</span>] <span class="op">=</span> calendar_plot_data[<span class="st">'date_time'</span>].dt.strftime(<span class="st">'%m-</span><span class="sc">%d</span><span class="st">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The last aspect of the day &amp; time factor is the calendar date of a match. This is evaluated using the calendar plots below.</p>
<section id="trends-in-quantity-of-matches" class="level3">
<h3 class="anchored" data-anchor-id="trends-in-quantity-of-matches">Trends in Quantity of Matches</h3>
<div class="cell" data-execution_count="12">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>date_of_year <span class="op">=</span> calendar_plot_data.groupby(<span class="st">'month_day'</span>).count()</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>date_of_year[<span class="st">'count'</span>] <span class="op">=</span> date_of_year[<span class="st">'standard_attend'</span>]</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>date_of_year <span class="op">=</span> date_of_year[<span class="st">'count'</span>].sort_values().reset_index()</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co"># print(date_of_year)</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>date_of_year[<span class="st">'total_date'</span>] <span class="op">=</span> <span class="st">'2024-'</span> <span class="op">+</span> date_of_year[<span class="st">'month_day'</span>]</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>date_of_year[<span class="st">'total_date'</span>]<span class="op">=</span> pd.to_datetime(date_of_year[<span class="st">'total_date'</span>], <span class="bu">format</span> <span class="op">=</span> <span class="st">"%Y-%m-</span><span class="sc">%d</span><span class="st">"</span>)</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>events <span class="op">=</span> pd.Series(date_of_year[<span class="st">'count'</span>].values.tolist(), index <span class="op">=</span> date_of_year[<span class="st">'total_date'</span>].values.tolist())</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>july.heatmap(</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    dates <span class="op">=</span> date_of_year[<span class="st">'total_date'</span>],</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> date_of_year[<span class="st">'count'</span>], </span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    date_label <span class="op">=</span> <span class="va">True</span>, cmap <span class="op">=</span> <span class="st">'RdYlBu_r'</span>, </span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    fontsize <span class="op">=</span><span class="dv">10</span>, </span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    weekday_label<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    year_label<span class="op">=</span> <span class="va">False</span>,</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>     title <span class="op">=</span> <span class="st">'Number of Games per day 2010-2019'</span>,</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>             month_grid<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    colorbar<span class="op">=</span> <span class="va">True</span>, dpi <span class="op">=</span><span class="dv">1200</span>)</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-cal_count" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="Blog_post_files/figure-html/fig-cal_count-output-1.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;5: Calendar Plot of total Number of Matches</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Before looking at the attendance, it’s important to view trends in when matches actually occur. In <a href="#fig-cal_count">Figure&nbsp;5</a>, there are very few games played from mid-June to the end of July. This is most likely attributed to European leagues predominantly being on break during these months due to FIFA international breaks. During this break, players typically return to their national teams to play in international competitions and, every four years, the World Cup. Another significant period of time is the Christmas holiday. Christmas has one of the lowest total number of games occurring. However, December 26th, or Boxing Day, had the highest number of games played out of any date.</p>
</section>
<section id="trends-in-attendance-of-matches" class="level3">
<h3 class="anchored" data-anchor-id="trends-in-attendance-of-matches">Trends in Attendance of Matches</h3>
<div class="cell" data-execution_count="13">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>attend_date <span class="op">=</span> calendar_plot_data.groupby(<span class="st">'month_day'</span>).mean()</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>attend_date[<span class="st">'count'</span>] <span class="op">=</span> attend_date[<span class="st">'standard_attend'</span>]</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>attend_date <span class="op">=</span> attend_date[<span class="st">'count'</span>].sort_values().reset_index()</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>attend_date[<span class="st">'total_date'</span>] <span class="op">=</span> <span class="st">'2024-'</span> <span class="op">+</span> attend_date[<span class="st">'month_day'</span>]</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>attend_date[<span class="st">'total_date'</span>] <span class="op">=</span> pd.to_datetime(</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    attend_date[<span class="st">'total_date'</span>], <span class="bu">format</span> <span class="op">=</span> <span class="st">"%Y-%m-</span><span class="sc">%d</span><span class="st">"</span>)</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>events <span class="op">=</span> pd.Series(</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    attend_date[<span class="st">'count'</span>].values.tolist(),</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>     index <span class="op">=</span> attend_date[<span class="st">'total_date'</span>].values.tolist())</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>july.heatmap(</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    dates <span class="op">=</span> attend_date[<span class="st">'total_date'</span>],</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>     data <span class="op">=</span> attend_date[<span class="st">'count'</span>],</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>    cmap<span class="op">=</span><span class="st">'RdYlBu_r'</span>, date_label <span class="op">=</span> <span class="va">True</span>,</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>    fontsize <span class="op">=</span><span class="dv">10</span>, weekday_label<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>    year_label<span class="op">=</span> <span class="va">False</span>,</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>    title <span class="op">=</span> <span class="st">'Average Attendance per Day Standardized 2010-2019'</span>,</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>             month_grid<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>    colorbar<span class="op">=</span> <span class="va">True</span>, dpi <span class="op">=</span><span class="dv">1200</span>)</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-cal_attend" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="Blog_post_files/figure-html/fig-cal_attend-output-1.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;6: Calendar Plot of Attendance</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Now looking at the attendance for these matches based on their calendar date, some trends appear. First, there is a grouping of higher-than-average attended matches in May. This can most likely be attributed to European seasons ending. In turn, these matches have a higher weight to fans due to teams vying for promotion (moving up a league), attempting to prevent relegation (moving down a league), and earning placement into European competitions such as UEFA Champions league and the Europa League. Additionally, with holidays there is an effect on attendance. First, November 6th, which is All Saint’s Day, saw a decrease in attendance. Christmas had lower attendance, while Boxing Day to New Year’s Eve had greater attendance than what is seen in the rest of December and January.</p>
</section>
</section>
</section>
<section id="away-team-impact" class="level1">
<h1>Away Team Impact</h1>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>away_team_impact <span class="op">=</span> total_data.groupby([<span class="st">'away_team'</span>, <span class="st">'division'</span>])[<span class="st">'standard_attend'</span>].mean().reset_index()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The next factor viewed is the impact of the away team on attendance. We are looking at how who the away team is impacts the attendance for the home team. For this, the standardized attendance was grouped by the away teams and then averaged. The results can be seen below. You can select what leagues you would like to view and the top number of teams from that league.</p>
<div class="cell" data-execution_count="15">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># away_team_impact = away_team_impact[away_team_impact['division'].isin(['E3', 'E1', 'E2'])]</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>div_dict <span class="op">=</span> {<span class="st">'D1'</span>:<span class="st">'Bundesliga'</span>, <span class="st">'D2'</span>: <span class="st">'2. Bundesliga'</span>, <span class="st">'E0'</span>:<span class="st">'Premier League'</span>, <span class="st">'E1'</span>:<span class="st">'Championship'</span>, </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>            <span class="st">'E2'</span>:<span class="st">'League 1'</span>, <span class="st">'E3'</span>:<span class="st">'League 2'</span>,<span class="st">'SP1'</span>:<span class="st">'La Liga Primera'</span>, <span class="st">'SP2'</span>:<span class="st">'La Liga Segunda'</span>,</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>              <span class="st">'B1'</span>:<span class="st">'Jupiler League'</span>, <span class="st">'F1'</span>:<span class="st">'Ligue 1'</span>,<span class="st">'F2'</span>:<span class="st">'Ligue 2'</span>,<span class="st">'I1'</span>:<span class="st">'Serie A'</span>,<span class="st">'I2'</span>:<span class="st">'Serie B'</span>, </span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>              <span class="st">'SC0'</span>:<span class="st">'Scottish Premier League'</span>, <span class="st">'SC1'</span>:<span class="st">'Scottish Division 1'</span>, <span class="st">'T1'</span>:<span class="st">'Fubol Ligi 1'</span>, <span class="st">'P1'</span>: <span class="st">'Liga 1'</span>}</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>divisions_list <span class="op">=</span>[</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'D1'</span>, <span class="st">'D2'</span>, <span class="st">'E0'</span>, <span class="st">'E1'</span>, <span class="st">'E2'</span>, <span class="st">'E3'</span>, <span class="st">'SP1'</span> ,<span class="st">'SP2'</span>, <span class="st">'B1'</span>, <span class="st">'F1'</span>, <span class="st">'F2'</span>, <span class="st">'I1'</span>,</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>     <span class="st">'I2'</span>, <span class="st">'SC0'</span>, <span class="st">'SC1'</span>, <span class="st">'T1'</span>, <span class="st">'P1'</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>     ]</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>away_team_impact <span class="op">=</span> away_team_impact[[<span class="st">'away_team'</span>, <span class="st">'division'</span>, <span class="st">'standard_attend'</span>]]</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="co"># print(away_team_impact)</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>initial_graph_df <span class="op">=</span> pd.DataFrame(</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>    columns <span class="op">=</span> [<span class="st">'away_team'</span>, <span class="st">'division'</span>, <span class="st">'standard_attend'</span>])</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> divisions_list:</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>    temp_impact_df <span class="op">=</span> away_team_impact[away_team_impact[<span class="st">'division'</span>] <span class="op">==</span> i].sort_values(<span class="st">'standard_attend'</span>,ascending <span class="op">=</span> <span class="va">False</span>).head(<span class="dv">3</span>)</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>    initial_graph_df <span class="op">=</span> pd.concat([initial_graph_df, temp_impact_df], axis <span class="op">=</span> <span class="dv">0</span>)</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a><span class="co"># fig = go.Figure(px.bar(away_team_impact, y= 'away_team', x = 'standard_attend', color = 'division'))</span></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>app <span class="op">=</span> JupyterDash(<span class="va">__name__</span>)</span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>app.layout <span class="op">=</span> html.Div(<span class="bu">id</span> <span class="op">=</span> <span class="st">'parent'</span>, children <span class="op">=</span> [</span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>    html.H1(<span class="bu">id</span> <span class="op">=</span> <span class="st">'H1'</span>, children <span class="op">=</span> <span class="st">'Away Team Impact'</span>),</span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>    dcc.Slider(<span class="dv">0</span>,<span class="dv">20</span>,<span class="dv">1</span>, value <span class="op">=</span><span class="dv">3</span>,<span class="bu">id</span> <span class="op">=</span> <span class="st">'slider'</span>),</span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>    dcc.Dropdown(<span class="bu">id</span> <span class="op">=</span> <span class="st">'dropdown'</span>, </span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>                 options <span class="op">=</span> [</span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>                {<span class="st">'label'</span>: <span class="st">'Bundesliga'</span>, <span class="st">'value'</span>:<span class="st">'D1'</span>},</span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a>                {<span class="st">'label'</span>: <span class="st">'2. Bundesliga'</span>, <span class="st">'value'</span>:<span class="st">'D2'</span>},</span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a>                {<span class="st">'label'</span>: <span class="st">'Premier League'</span>, <span class="st">'value'</span>:<span class="st">'E0'</span>},</span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a>                {<span class="st">'label'</span>: <span class="st">'Championship'</span>, <span class="st">'value'</span>:<span class="st">'E1'</span>},</span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a>                {<span class="st">'label'</span>: <span class="st">'League 1'</span>, <span class="st">'value'</span>:<span class="st">'E2'</span>},</span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a>                {<span class="st">'label'</span>: <span class="st">'League 2'</span>, <span class="st">'value'</span>:<span class="st">'E3'</span>},</span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a>                {<span class="st">'label'</span>: <span class="st">'La Liga Primera'</span>, <span class="st">'value'</span>:<span class="st">'SP1'</span>},</span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a>                {<span class="st">'label'</span>: <span class="st">'La Liga Segunda'</span>, <span class="st">'value'</span>:<span class="st">'SP2'</span>},</span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a>                {<span class="st">'label'</span>: <span class="st">'Jupiler League'</span>, <span class="st">'value'</span>:<span class="st">'B1'</span>},</span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true" tabindex="-1"></a>                {<span class="st">'label'</span>: <span class="st">'Ligue 1'</span>, <span class="st">'value'</span>:<span class="st">'F1'</span>},</span>
<span id="cb15-39"><a href="#cb15-39" aria-hidden="true" tabindex="-1"></a>                {<span class="st">'label'</span>: <span class="st">'Ligue 2'</span>, <span class="st">'value'</span>:<span class="st">'F2'</span>},</span>
<span id="cb15-40"><a href="#cb15-40" aria-hidden="true" tabindex="-1"></a>                {<span class="st">'label'</span>: <span class="st">'Serie A'</span>, <span class="st">'value'</span>:<span class="st">'I1'</span>},</span>
<span id="cb15-41"><a href="#cb15-41" aria-hidden="true" tabindex="-1"></a>                {<span class="st">'label'</span>: <span class="st">'Serie B'</span>, <span class="st">'value'</span>:<span class="st">'I2'</span>},</span>
<span id="cb15-42"><a href="#cb15-42" aria-hidden="true" tabindex="-1"></a>                {<span class="st">'label'</span>: <span class="st">'Scotish Premier League'</span>, <span class="st">'value'</span>:<span class="st">'SC0'</span>},</span>
<span id="cb15-43"><a href="#cb15-43" aria-hidden="true" tabindex="-1"></a>                {<span class="st">'label'</span>: <span class="st">'Scotish Division 1'</span>, <span class="st">'value'</span>:<span class="st">'SC1'</span>},</span>
<span id="cb15-44"><a href="#cb15-44" aria-hidden="true" tabindex="-1"></a>                {<span class="st">'label'</span>: <span class="st">'Fubol Ligi 1'</span>, <span class="st">'value'</span>:<span class="st">'T1'</span>},</span>
<span id="cb15-45"><a href="#cb15-45" aria-hidden="true" tabindex="-1"></a>                {<span class="st">'label'</span>: <span class="st">'Liga 1'</span>, <span class="st">'value'</span>:<span class="st">'P1'</span>}</span>
<span id="cb15-46"><a href="#cb15-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-47"><a href="#cb15-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-48"><a href="#cb15-48" aria-hidden="true" tabindex="-1"></a>                 ], value <span class="op">=</span> [<span class="st">'D1'</span>, <span class="st">'D2'</span>, <span class="st">'E0'</span>, <span class="st">'E1'</span>, <span class="st">'E2'</span>, <span class="st">'E3'</span>, <span class="st">'SP1'</span> ,<span class="st">'SP2'</span>, <span class="st">'B1'</span>, <span class="st">'F1'</span>, <span class="st">'F2'</span>, <span class="st">'I1'</span>, <span class="st">'I2'</span>, <span class="st">'SC0'</span>, <span class="st">'SC1'</span>, <span class="st">'T1'</span>, <span class="st">'P1'</span>],</span>
<span id="cb15-49"><a href="#cb15-49" aria-hidden="true" tabindex="-1"></a>                 multi <span class="op">=</span> <span class="va">True</span>),</span>
<span id="cb15-50"><a href="#cb15-50" aria-hidden="true" tabindex="-1"></a>    dcc.Graph(<span class="bu">id</span> <span class="op">=</span> <span class="st">'bar_plot'</span>, figure<span class="op">=</span>px.bar(</span>
<span id="cb15-51"><a href="#cb15-51" aria-hidden="true" tabindex="-1"></a>        initial_graph_df.replace({<span class="st">'division'</span>:div_dict}),</span>
<span id="cb15-52"><a href="#cb15-52" aria-hidden="true" tabindex="-1"></a>         x<span class="op">=</span><span class="st">'away_team'</span>, y<span class="op">=</span><span class="st">'standard_attend'</span>, color<span class="op">=</span><span class="st">'division'</span>))</span>
<span id="cb15-53"><a href="#cb15-53" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb15-54"><a href="#cb15-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-55"><a href="#cb15-55" aria-hidden="true" tabindex="-1"></a><span class="at">@app.callback</span>(</span>
<span id="cb15-56"><a href="#cb15-56" aria-hidden="true" tabindex="-1"></a>    Output(<span class="st">"bar_plot"</span>, <span class="st">"figure"</span>), </span>
<span id="cb15-57"><a href="#cb15-57" aria-hidden="true" tabindex="-1"></a>    [Input(<span class="st">"dropdown"</span>, <span class="st">"value"</span>),</span>
<span id="cb15-58"><a href="#cb15-58" aria-hidden="true" tabindex="-1"></a>     Input(<span class="st">'slider'</span>, <span class="st">'value'</span>)]</span>
<span id="cb15-59"><a href="#cb15-59" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb15-60"><a href="#cb15-60" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> update_graph(drop_value, slider_value):</span>
<span id="cb15-61"><a href="#cb15-61" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(value)</span></span>
<span id="cb15-62"><a href="#cb15-62" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> away_team_impact</span>
<span id="cb15-63"><a href="#cb15-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-64"><a href="#cb15-64" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-65"><a href="#cb15-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-66"><a href="#cb15-66" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df[df[<span class="st">'division'</span>].isin(<span class="bu">list</span>(drop_value))]</span>
<span id="cb15-67"><a href="#cb15-67" aria-hidden="true" tabindex="-1"></a>    graph_df <span class="op">=</span> pd.DataFrame(columns <span class="op">=</span> [<span class="st">'away_team'</span>, <span class="st">'division'</span>, <span class="st">'standard_attend'</span>])</span>
<span id="cb15-68"><a href="#cb15-68" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> drop_value:</span>
<span id="cb15-69"><a href="#cb15-69" aria-hidden="true" tabindex="-1"></a>        temp_impact_df <span class="op">=</span> df[df[<span class="st">'division'</span>] <span class="op">==</span> i].sort_values(<span class="st">'standard_attend'</span>,ascending <span class="op">=</span> <span class="va">False</span>).head(slider_value)</span>
<span id="cb15-70"><a href="#cb15-70" aria-hidden="true" tabindex="-1"></a>        graph_df <span class="op">=</span> pd.concat([graph_df, temp_impact_df], axis <span class="op">=</span> <span class="dv">0</span>)</span>
<span id="cb15-71"><a href="#cb15-71" aria-hidden="true" tabindex="-1"></a>    graph_df <span class="op">=</span> graph_df.reset_index().drop(columns <span class="op">=</span> [<span class="st">'index'</span>]).replace({<span class="st">'division'</span>:div_dict})</span>
<span id="cb15-72"><a href="#cb15-72" aria-hidden="true" tabindex="-1"></a>    fig <span class="op">=</span> px.bar(graph_df, x<span class="op">=</span> <span class="st">'away_team'</span>, y<span class="op">=</span> <span class="st">'standard_attend'</span>, color <span class="op">=</span> <span class="st">'division'</span>)</span>
<span id="cb15-73"><a href="#cb15-73" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> fig</span>
<span id="cb15-74"><a href="#cb15-74" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">'__main__'</span>:</span>
<span id="cb15-75"><a href="#cb15-75" aria-hidden="true" tabindex="-1"></a>    app.run_server(mode<span class="op">=</span><span class="st">'inline'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<iframe width="650" height="500" src="http://127.0.0.1:8050"></iframe>

<section id="top-teams-in-the-biggest-leagues" class="level2">
<h2 class="anchored" data-anchor-id="top-teams-in-the-biggest-leagues">Top Teams in the Biggest Leagues</h2>
<div class="cell" data-execution_count="16">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>away_team_top_3 <span class="op">=</span> pd.DataFrame(columns <span class="op">=</span> [<span class="st">'away_team'</span>, <span class="st">'division'</span>, <span class="st">'standard_attend'</span>])</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> divisions_list:</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>        temp_impact_df <span class="op">=</span> away_team_impact[away_team_impact[<span class="st">'division'</span>] <span class="op">==</span> i].sort_values(<span class="st">'standard_attend'</span>,ascending <span class="op">=</span> <span class="va">False</span>).head(<span class="dv">3</span>)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>        away_team_top_3 <span class="op">=</span> pd.concat([away_team_top_3, temp_impact_df], axis <span class="op">=</span> <span class="dv">0</span>)</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>top_league_away <span class="op">=</span> away_team_top_3[away_team_top_3[<span class="st">'division'</span>].isin([<span class="st">'E0'</span>, <span class="st">'I1'</span>, <span class="st">'F1'</span>, <span class="st">'SP1'</span>, <span class="st">'D1'</span>])].replace({<span class="st">'division'</span>:div_dict})</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>sns.barplot(data <span class="op">=</span> top_league_away, x <span class="op">=</span> <span class="st">'standard_attend'</span>, y <span class="op">=</span> <span class="st">'away_team'</span>, hue <span class="op">=</span> <span class="st">'division'</span>, dodge <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Away Team's Impact on Attendance: Top 3 teams per Top League"</span>)</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Mean Attendance Increase'</span>)</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Away Team'</span>)</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>plt.legend(bbox_to_anchor<span class="op">=</span>(<span class="fl">1.05</span>, <span class="dv">1</span>), loc<span class="op">=</span><span class="st">'upper left'</span>, borderaxespad<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-top_away_league" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="Blog_post_files/figure-html/fig-top_away_league-output-1.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;7: Greatest Away teams Impact on Attendance: First Divisions</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>In <a href="#fig-top_away_league">Figure&nbsp;7</a>, we see the top 3 teams with the greatest impact on attendance in the top league in Germany, England, Spain, France, and Italy. The teams with the greatest impact on the home team’s attendance are all big-name teams that are globally marketed. They have historical and current success within their league. For instance, in La Liga Primera, the three teams, Real Madrid, FC Barcelona, and Atletico Madrid, are the only teams that have won the league since 2004 <span class="citation" data-cites="sportskeeda">(<a href="#ref-sportskeeda" role="doc-biblioref"><span>“Sportskeeda”</span> 2023</a>)</span>, and in turn have the greatest increase in attendance for their league.</p>
</section>
<section id="greatest-away-team-impact---english-leagues" class="level2">
<h2 class="anchored" data-anchor-id="greatest-away-team-impact---english-leagues">Greatest Away Team Impact - English Leagues</h2>
<div class="cell" data-execution_count="17">
<details>
<summary>Top 3 away teams English League’s plot</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>top_england_away <span class="op">=</span> away_team_top_3[away_team_top_3[<span class="st">'division'</span>].isin([<span class="st">'E0'</span>, <span class="st">'E1'</span>, <span class="st">'E2'</span>, <span class="st">'E3'</span>])].replace({<span class="st">'division'</span>:div_dict})</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>sns.barplot(data <span class="op">=</span> top_england_away, x <span class="op">=</span> <span class="st">'standard_attend'</span>, y <span class="op">=</span> <span class="st">'away_team'</span>, hue <span class="op">=</span> <span class="st">'division'</span>, dodge <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Away Teams Impact on Attendance: Top 3 teams per English League'</span>)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Mean Attendance Increase'</span>)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Away Team'</span>)</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>plt.legend(bbox_to_anchor<span class="op">=</span>(<span class="fl">1.05</span>, <span class="dv">1</span>), loc<span class="op">=</span><span class="st">'upper left'</span>, borderaxespad<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-england_away" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="Blog_post_files/figure-html/fig-england_away-output-1.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;8: Top 3 Away Teams per English League</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Looking at teams in lower leagues, similar trends appear. <a href="#fig-england_away">Figure&nbsp;8</a> shows the lower leagues in England. All of the teams shown here have had historical success. For some of the teams, such as Leeds United and Coventry City, the success was in the past. Coventry City was in the top division of English Football from 1967 to 2001, winning the FA Cup in 1968. Leeds United is an even better example of historic success, winning the first division in the 1968-69, 1973-74, and 1991-92 seasons. Both of these teams have had historical success in their past, however their performances have declined in the modern era, forcing them to drop leagues. Other teams here, such as Newcastle, West Ham United, and Sunderland, were at the top level of football during this time period, however, were relegated by one or two leagues during that time. With that, they still have an impact, increasing attendance for the home teams. So, teams that have had historical success or recently were relegated from higher leagues are seen to have an impact on the home team’s attendance.</p>
</section>
</section>
<section id="betting-odds" class="level1">
<h1>Betting Odds</h1>
<p>The final factor used in evaluating attendance was the betting odds for an individual match. Betting odds were used as a method to show favorability and public perception of a match. It shows the current perceived strength of each team.</p>
<section id="comparing-betting-data-sources" class="level2">
<h2 class="anchored" data-anchor-id="comparing-betting-data-sources">Comparing Betting Data Sources</h2>
<div class="cell" data-execution_count="18">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>bet_dataset <span class="op">=</span> total_data[[<span class="st">'raw_attendance'</span>, <span class="st">'division'</span>, <span class="st">'FTR'</span>,</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>        <span class="st">'B365H'</span>, <span class="st">'B365D'</span>, <span class="st">'B365A'</span>, <span class="st">'BWH'</span>, <span class="st">'BWD'</span>, <span class="st">'BWA'</span>, <span class="st">'WHH'</span>, <span class="st">'WHD'</span>,</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>       <span class="st">'WHA'</span>, <span class="st">'VCH'</span>, <span class="st">'VCD'</span>, <span class="st">'VCA'</span>, <span class="st">'BbMx&gt;2.5'</span>, <span class="st">'BbAv&gt;2.5'</span>, <span class="st">'BbMx&lt;2.5'</span>,</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>       <span class="st">'BbAv&lt;2.5'</span>]]</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>b365_conditions <span class="op">=</span> [(bet_dataset[<span class="st">'B365H'</span>] <span class="op">&lt;</span> bet_dataset[<span class="st">'B365A'</span>]) <span class="op">&amp;</span> (bet_dataset[<span class="st">'B365H'</span>] <span class="op">&lt;</span> bet_dataset[<span class="st">'B365D'</span>]),</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>                   (bet_dataset[<span class="st">'B365A'</span>] <span class="op">&lt;</span> bet_dataset[<span class="st">'B365H'</span>]) <span class="op">&amp;</span> (bet_dataset[<span class="st">'B365A'</span>] <span class="op">&lt;</span> bet_dataset[<span class="st">'B365D'</span>]),</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>                   (bet_dataset[<span class="st">'B365D'</span>] <span class="op">&lt;</span> bet_dataset[<span class="st">'B365A'</span>]) <span class="op">&amp;</span> (bet_dataset[<span class="st">'B365D'</span>] <span class="op">&lt;</span> bet_dataset[<span class="st">'B365H'</span>])]</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>b365_vals <span class="op">=</span> [<span class="st">'H'</span>, <span class="st">'A'</span>, <span class="st">'D'</span>]</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>bet_dataset[<span class="st">'B365_Result'</span>] <span class="op">=</span> np.select(b365_conditions,b365_vals)</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>bw_conditions <span class="op">=</span> [(bet_dataset[<span class="st">'BWH'</span>] <span class="op">&lt;</span> bet_dataset[<span class="st">'BWA'</span>]) <span class="op">&amp;</span> (bet_dataset[<span class="st">'BWH'</span>] <span class="op">&lt;</span> bet_dataset[<span class="st">'BWD'</span>]),</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>                   (bet_dataset[<span class="st">'BWA'</span>] <span class="op">&lt;</span> bet_dataset[<span class="st">'BWH'</span>]) <span class="op">&amp;</span> (bet_dataset[<span class="st">'BWA'</span>] <span class="op">&lt;</span> bet_dataset[<span class="st">'BWD'</span>]),</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>                   (bet_dataset[<span class="st">'BWD'</span>] <span class="op">&lt;</span> bet_dataset[<span class="st">'BWA'</span>]) <span class="op">&amp;</span> (bet_dataset[<span class="st">'BWD'</span>] <span class="op">&lt;</span> bet_dataset[<span class="st">'BWH'</span>])]</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>bw_vals <span class="op">=</span> [<span class="st">'H'</span>, <span class="st">'A'</span>, <span class="st">'D'</span>]</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>bet_dataset[<span class="st">'BW_Result'</span>] <span class="op">=</span> np.select(bw_conditions,bw_vals)</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>wh_conditions <span class="op">=</span> [(bet_dataset[<span class="st">'WHH'</span>] <span class="op">&lt;</span> bet_dataset[<span class="st">'WHA'</span>]) <span class="op">&amp;</span> (bet_dataset[<span class="st">'WHH'</span>] <span class="op">&lt;</span> bet_dataset[<span class="st">'WHD'</span>]),</span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>                   (bet_dataset[<span class="st">'WHA'</span>] <span class="op">&lt;</span> bet_dataset[<span class="st">'WHH'</span>]) <span class="op">&amp;</span> (bet_dataset[<span class="st">'WHA'</span>] <span class="op">&lt;</span> bet_dataset[<span class="st">'WHD'</span>]),</span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>                   (bet_dataset[<span class="st">'WHD'</span>] <span class="op">&lt;</span> bet_dataset[<span class="st">'WHA'</span>]) <span class="op">&amp;</span> (bet_dataset[<span class="st">'WHD'</span>] <span class="op">&lt;</span> bet_dataset[<span class="st">'WHH'</span>])]</span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>wh_vals <span class="op">=</span> [<span class="st">'H'</span>, <span class="st">'A'</span>, <span class="st">'D'</span>]</span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>bet_dataset[<span class="st">'WH_Result'</span>] <span class="op">=</span> np.select(wh_conditions,wh_vals)</span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a>vc_conditions <span class="op">=</span> [(bet_dataset[<span class="st">'VCH'</span>] <span class="op">&lt;</span> bet_dataset[<span class="st">'VCA'</span>]) <span class="op">&amp;</span> (bet_dataset[<span class="st">'VCH'</span>] <span class="op">&lt;</span> bet_dataset[<span class="st">'VCD'</span>]),</span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a>                   (bet_dataset[<span class="st">'VCA'</span>] <span class="op">&lt;</span> bet_dataset[<span class="st">'VCH'</span>]) <span class="op">&amp;</span> (bet_dataset[<span class="st">'VCA'</span>] <span class="op">&lt;</span> bet_dataset[<span class="st">'VCD'</span>]),</span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a>                   (bet_dataset[<span class="st">'VCD'</span>] <span class="op">&lt;</span> bet_dataset[<span class="st">'VCA'</span>]) <span class="op">&amp;</span> (bet_dataset[<span class="st">'VCD'</span>] <span class="op">&lt;</span> bet_dataset[<span class="st">'VCH'</span>])]</span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a>vc_vals <span class="op">=</span> [<span class="st">'H'</span>, <span class="st">'A'</span>, <span class="st">'D'</span>]</span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a>bet_dataset[<span class="st">'VC_Result'</span>] <span class="op">=</span> np.select(vc_conditions,vc_vals)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The dataset gathered had different sources of betting odds. Some were removed before the final dataset due to too many missing values, but the betting companies that remained were Bet365, Bet&amp;Win, William Hill, and VC Bet. `</p>
<div class="cell" data-execution_count="19">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> betting_accuracy_vis(name, axis):</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>    b365_data <span class="op">=</span> bet_dataset[[name, <span class="st">'FTR'</span>]].dropna()</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(b365_data[name].value_counts())</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    b365_data <span class="op">=</span> b365_data[b365_data[name]<span class="op">!=</span> <span class="st">'0'</span>]</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    b365_data <span class="op">=</span> b365_data.groupby([<span class="st">'FTR'</span>,name]).size()</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    b365_data <span class="op">=</span> b365_data.reset_index(name <span class="op">=</span> <span class="st">'count'</span>)</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>    FTR_result <span class="op">=</span> b365_data[[name,<span class="st">'count'</span>]].rename(columns <span class="op">=</span> {<span class="st">'count'</span>:<span class="st">'total'</span>})</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>    FTR_result <span class="op">=</span> FTR_result.groupby([name]).<span class="bu">sum</span>().reset_index()</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(FTR_result)</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>    b365_data <span class="op">=</span> pd.merge(b365_data, FTR_result, on <span class="op">=</span>name)</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>    total_count <span class="op">=</span> b365_data[<span class="st">'count'</span>].<span class="bu">sum</span>()</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(total_count)</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>    b365_data[<span class="st">'pct'</span>] <span class="op">=</span> b365_data[<span class="st">'count'</span>]<span class="op">/</span>b365_data[<span class="st">'total'</span>] <span class="op">*</span><span class="dv">100</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(b365_data)</span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>    b365_data <span class="op">=</span> b365_data.pivot(index <span class="op">=</span> <span class="st">'FTR'</span>, columns <span class="op">=</span> name, values <span class="op">=</span> <span class="st">'pct'</span>)</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(b365_data)</span></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>    fig <span class="op">=</span> sns.heatmap(data <span class="op">=</span> b365_data, annot<span class="op">=</span> <span class="va">True</span>, ax <span class="op">=</span> axis)</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">'Match Result'</span>)</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># plt.xticks(['Win', 'Draw', 'Loss'])</span></span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># plt.yticks(['Win', 'Draw', 'Loss'])</span></span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># plt.title(name + ' Accuracy in predicting Actual Result')</span></span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> fig</span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a>result_name_list <span class="op">=</span> [<span class="st">'B365_Result'</span>, <span class="st">'BW_Result'</span>, <span class="st">'WH_Result'</span>, <span class="st">'VC_Result'</span>]</span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a><span class="co"># for i in result_name_list:</span></span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a><span class="co">#     betting_accuracy_vis(i)</span></span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a>figure, ax <span class="op">=</span> plt.subplots(<span class="dv">2</span>,<span class="dv">2</span>)</span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a>betting_accuracy_vis(<span class="st">'B365_Result'</span>, ax[<span class="dv">0</span>,<span class="dv">0</span>])</span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true" tabindex="-1"></a>betting_accuracy_vis(<span class="st">'BW_Result'</span>, ax[<span class="dv">0</span>,<span class="dv">1</span>])</span>
<span id="cb19-34"><a href="#cb19-34" aria-hidden="true" tabindex="-1"></a>betting_accuracy_vis(<span class="st">'WH_Result'</span>, ax[<span class="dv">1</span>,<span class="dv">0</span>])</span>
<span id="cb19-35"><a href="#cb19-35" aria-hidden="true" tabindex="-1"></a>betting_accuracy_vis(<span class="st">'VC_Result'</span>, ax[<span class="dv">1</span>,<span class="dv">1</span>])</span>
<span id="cb19-36"><a href="#cb19-36" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-betting_comp" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="Blog_post_files/figure-html/fig-betting_comp-output-1.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;9: Betting Data Compared to Actual Match Result</figcaption><p></p>
</figure>
</div>
</div>
</div>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>For the Results H = Home team Wins, A = Away team Wins, D = Draw.</p>
</div>
</div>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body" title="Explanation of How to read the graphs percentages">
<p>The number within each cell is the percentage of predicted results occuring. For instance, when B365 predicted the away team to win, 27% of the time the home team won, 27% of the time the teams drew, and 47% of the time the away team won.</p>
</div>
</div>
<p>The heatmaps seen in <a href="#fig-betting_comp">Figure&nbsp;9</a>, show the distribution of what the betting company favored as the result and what the actual result of a match was. The difference in the individual betting companies was slim to non-existant. Due to this, we assume that all the betting data is comparable. For the remainder of the project, Bet 365 is used because it had one of the fewest numbers of missing values.</p>
</section>
<section id="betting-odds-1" class="level2">
<h2 class="anchored" data-anchor-id="betting-odds-1">Betting Odds</h2>
<div class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>bet_data <span class="op">=</span> total_data</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>bet_data <span class="op">=</span> bet_data.dropna(subset <span class="op">=</span> [<span class="st">'B365H'</span>, <span class="st">'B365A'</span>])</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>h_fav <span class="op">=</span> []</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>attend_increase <span class="op">=</span> []</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> index, rows <span class="kw">in</span> bet_data.iterrows():</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> rows[<span class="st">'B365H'</span>] <span class="op">&lt;</span> rows[<span class="st">'B365A'</span>]:</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>        h_fav <span class="op">=</span> h_fav <span class="op">+</span> [<span class="va">True</span>]</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>        h_fav <span class="op">=</span> h_fav <span class="op">+</span> [<span class="va">False</span>]</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> rows[<span class="st">'standard_attend'</span>] <span class="op">&gt;=</span> <span class="dv">0</span>:</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>        attend_increase <span class="op">=</span> attend_increase <span class="op">+</span> [<span class="va">True</span>]</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>        attend_increase <span class="op">=</span> attend_increase <span class="op">+</span> [<span class="va">False</span>]</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>bet_increase_bool <span class="op">=</span> bet_data</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>bet_increase_bool[<span class="st">'home_fav'</span>] <span class="op">=</span> h_fav</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>bet_increase_bool[<span class="st">'attend_increase'</span>] <span class="op">=</span> attend_increase</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>bet_bool <span class="op">=</span> bet_increase_bool[[<span class="st">'home_fav'</span>, <span class="st">'attend_increase'</span>,<span class="st">'raw_attendance'</span>]]</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>bet_bool <span class="op">=</span> bet_bool.groupby([<span class="st">'home_fav'</span>, <span class="st">'attend_increase'</span>]).count().reset_index().rename(columns <span class="op">=</span> {<span class="st">'home_fav'</span>:<span class="st">'Home Team Favorited'</span>, <span class="st">'attend_increase'</span>:<span class="st">'Increase In Attendance'</span>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For analyzing the effect of betting odds in the data set, two boolean variables were created. The first variable reflected whether or not there was an increase in attendance. If the z-score for the match was positive or 0, it was determined to have an increased attendance and if it was negative, it decreased attendance. The second was to determine if the home team was favored. If the betting odds of the home team winning was a smaller number than the betting odds for the away team winning, it was determined that the home team was favored. And if the home team betting odds were greater than the away team betting odds, then it was deterimined as not favored.</p>
<div class="cell" data-execution_count="21">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>count_pct <span class="op">=</span> []</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> index, rows <span class="kw">in</span> bet_bool.iterrows():</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print('----------')</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>    goals <span class="op">=</span> rows[<span class="st">'Home Team Favorited'</span>]</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(goals)</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>    total_count_goals <span class="op">=</span> bet_bool[bet_bool[<span class="st">'Home Team Favorited'</span>] <span class="op">==</span> goals][<span class="st">'raw_attendance'</span>].values</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>    total_count_goals <span class="op">=</span> <span class="bu">sum</span>(total_count_goals)</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(total_count_goals)</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>    percent_total <span class="op">=</span> rows[<span class="st">'raw_attendance'</span>]<span class="op">*</span><span class="dv">100</span><span class="op">/</span>total_count_goals</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(percent_total)</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>    count_pct <span class="op">=</span> count_pct <span class="op">+</span> [percent_total]</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>bet_bool[<span class="st">'pcnt_values'</span>]  <span class="op">=</span> count_pct</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a><span class="co"># bet_bool = bet_bool.pivot_table(values = 'pcnt_values', index = 'Home Team Favorited', columns = 'Increase In Attendance')</span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a><span class="co"># print(bet_bool)</span></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a><span class="co"># sns.heatmap(bet_bool,annot= True)</span></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>sns.barplot(data <span class="op">=</span>bet_bool, x <span class="op">=</span> <span class="st">'Home Team Favorited'</span>, y <span class="op">=</span> <span class="st">'pcnt_values'</span>, hue <span class="op">=</span> <span class="st">'Increase In Attendance'</span>)</span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>plt.gca().invert_xaxis()</span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.gca().invert_yaxis()</span></span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Attendance Impact Depending if Home Team is Favored'</span>)</span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Percent'</span>)</span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-home_fav" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="Blog_post_files/figure-html/fig-home_fav-output-1.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;10: Impact of Home team Favorability to win on Attendance</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p><a href="#fig-home_fav">Figure&nbsp;10</a> shows what occurs to attendance when the home team is favored to win. When the home team is favored, the games will typically have less-than-average attendance for that match. However, if the Home team is not favored, the matches are more likely to have a greater-than-average attendance. This could demonstrate that fans like to see underdog performances, and if their team is favored, they do not view the match as important.</p>
</section>
<section id="odds-of-goals-2.5" class="level2">
<h2 class="anchored" data-anchor-id="odds-of-goals-2.5">Odds of Goals &gt; 2.5</h2>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>goal_data <span class="op">=</span> total_data.dropna(subset <span class="op">=</span> [<span class="st">'standard_attend'</span>, <span class="st">'BbAv&gt;2.5'</span>,<span class="st">'BbAv&lt;2.5'</span>])</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>increase_attend <span class="op">=</span> []</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>higher_goals <span class="op">=</span> []</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> index, rows <span class="kw">in</span> goal_data.iterrows():</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> rows[<span class="st">'standard_attend'</span>] <span class="op">&gt;=</span><span class="dv">0</span>:</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>        increase_attend <span class="op">=</span> increase_attend <span class="op">+</span> [<span class="va">True</span>]</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>        increase_attend <span class="op">=</span> increase_attend <span class="op">+</span> [<span class="va">False</span>]</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> rows[<span class="st">'BbAv&gt;2.5'</span>] <span class="op">&lt;=</span> rows[<span class="st">'BbAv&lt;2.5'</span>]:</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>        higher_goals <span class="op">=</span> higher_goals <span class="op">+</span> [<span class="va">True</span>]</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>        higher_goals <span class="op">=</span> higher_goals <span class="op">+</span>[<span class="va">False</span>]</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>goal_data[<span class="st">'increase_attend'</span>] <span class="op">=</span> increase_attend</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>goal_data[<span class="st">'higher_goals'</span>] <span class="op">=</span> higher_goals</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> goal_data[[<span class="st">'higher_goals'</span>, <span class="st">'increase_attend'</span>]]</span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.value_counts().reset_index(name<span class="op">=</span> <span class="st">'count'</span>)</span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>count_pct <span class="op">=</span> []</span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>df_grouped_higher_goal_sum <span class="op">=</span> df.groupby(<span class="st">'higher_goals'</span>)[<span class="st">'count'</span>].<span class="bu">sum</span>().reset_index()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>One of the betting variables that is looked at is the betting odds on the total number of goals scored in a game. The betting odds are if the game will have more than 2.5 or less than 2.5 goals. With this vairable, another boolean variable was created. If the betting odds for goals being greater than 2.5 was a smaller number than goals being less than 2.5, it was determined that there was expected to have more than 2.5 goals scored. If the betting odds stated that goals being less than 2.5 had a smaller number than goals being greater than 2.5, it was stated that their was expected to be less than 2.5 goals scored.</p>
<div class="cell" data-execution_count="23">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> index, rows <span class="kw">in</span> df.iterrows():</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print('----------')</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>    goals <span class="op">=</span> rows[<span class="st">'higher_goals'</span>]</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(goals)</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>    total_count_goals <span class="op">=</span> df_grouped_higher_goal_sum[df_grouped_higher_goal_sum[<span class="st">'higher_goals'</span>] <span class="op">==</span> goals][<span class="st">'count'</span>].values</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>    total_count_goals <span class="op">=</span> <span class="bu">sum</span>(total_count_goals)</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(total_count_goals)</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>    percent_total <span class="op">=</span> rows[<span class="st">'count'</span>]<span class="op">*</span><span class="dv">100</span><span class="op">/</span>total_count_goals</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(percent_total)</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>    count_pct <span class="op">=</span> count_pct <span class="op">+</span> [percent_total]</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'count_pct'</span>] <span class="op">=</span> count_pct</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a><span class="co"># total_count = df['count'].sum()</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a><span class="co"># df['pct'] = df['count']*100/total_count</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.rename(columns <span class="op">=</span> {<span class="st">'higher_goals'</span>:<span class="st">'Odds of Goals over 2.5 is favored'</span>, <span class="st">'increase_attend'</span>: <span class="st">'Increased Attendance'</span>})</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>df2 <span class="op">=</span> df.pivot(index <span class="op">=</span> <span class="st">'Odds of Goals over 2.5 is favored'</span>, columns <span class="op">=</span> <span class="st">'Increased Attendance'</span>, values <span class="op">=</span> <span class="st">'count_pct'</span>)</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a><span class="co"># print(df)</span></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a><span class="co"># sns.heatmap(goal_data = df2, annot= True)</span></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.gca().invert_xaxis()</span></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.gca().invert_yaxis()</span></span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.title('Predicted Goals in Relation to Attendance')</span></span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.show()</span></span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>sns.barplot(data <span class="op">=</span>df, x <span class="op">=</span> <span class="st">'Odds of Goals over 2.5 is favored'</span>, y <span class="op">=</span> <span class="st">'count_pct'</span>, hue <span class="op">=</span> <span class="st">'Increased Attendance'</span>)</span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>plt.gca().invert_xaxis()</span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Percent'</span>)</span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a>plt.xticks([<span class="dv">0</span>,<span class="dv">1</span>], [<span class="st">'Less than 2.5 Goals'</span>,<span class="st">'More than 2.5 Goals'</span>])</span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Predicted amount of goals scored'</span>)</span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Predicted Goals in Relation to Attendance'</span>)</span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-goals" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="Blog_post_files/figure-html/fig-goals-output-1.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;11: Predicted Goals in relation to attendance</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p><a href="#fig-goals">Figure&nbsp;11</a> shows how attendance changes with different predicted number of goals. When the match is expected to be a higher scoring match, the attendance is almost equally likely to increase or decrease. However, when the match is not predicted to have over 2.5 goals scored, the attendance is more likely to be negatively impacted in relation to the season average.</p>
</section>
</section>
<section id="modeling" class="level1">
<h1>Modeling</h1>
<p>All of this analysis and looking at different factors that would impact attendance have led to predicting the attendance of a game. Given the complexity of the data, a random forest regression model was implemented. Random Forest Regression is a supervised machine learning model. It uses multiple decision trees to make the best model for the data. All of the factors stated before, except the amount of goals predicted to be scored, were used within the model to predict the attendance of a given match.</p>
<div class="cell" data-execution_count="24">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>model_dataset <span class="op">=</span> total_data</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>model_dataset <span class="op">=</span> model_dataset.dropna(subset <span class="op">=</span> [<span class="st">'B365A'</span>, <span class="st">'BWH'</span>, <span class="st">'WHH'</span>, <span class="st">'VCD'</span>,<span class="st">'BbMx&gt;2.5'</span>,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>                             <span class="st">'BbAv&gt;2.5'</span>, <span class="st">'BbMx&lt;2.5'</span>, <span class="st">'BbAv&lt;2.5'</span>, <span class="st">'std_attend'</span>, <span class="st">'standard_attend'</span>])</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>model_dataset <span class="op">=</span> model_dataset.drop([<span class="st">'date_time'</span>], axis <span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>obj_data <span class="op">=</span> model_dataset.select_dtypes(include<span class="op">=</span>[<span class="st">'object'</span>]).copy()</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>column_obj_name <span class="op">=</span> obj_data.columns.values.tolist()</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>before_encode <span class="op">=</span> model_dataset[[<span class="st">'division'</span>, <span class="st">'home_team'</span>, <span class="st">'away_team'</span>]]</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>label_encoder <span class="op">=</span> LabelEncoder()</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>post_encode <span class="op">=</span> model_dataset[[<span class="st">'division'</span>, <span class="st">'home_team'</span>, <span class="st">'away_team'</span>]]</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>encode_compare <span class="op">=</span> pd.concat([before_encode, post_encode], axis <span class="op">=</span> <span class="dv">1</span>, ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>encode_compare.columns <span class="op">=</span> [<span class="st">'division'</span>, <span class="st">'home_team'</span>, <span class="st">'away_team'</span>, <span class="st">'division_encode'</span>, <span class="st">'home_encode'</span>, <span class="st">'away_encode'</span>]</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a><span class="co"># print(encode_compare)</span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>div_key <span class="op">=</span> pd.Series(encode_compare.division.values, index <span class="op">=</span> encode_compare.division_encode).to_dict()</span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>home_key <span class="op">=</span> pd.Series(encode_compare.home_team.values, index <span class="op">=</span> encode_compare.home_encode).to_dict()</span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>away_key <span class="op">=</span> pd.Series(encode_compare.away_team.values, index <span class="op">=</span> encode_compare.away_encode).to_dict()</span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> obj <span class="kw">in</span> column_obj_name:</span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>    model_dataset[obj] <span class="op">=</span> label_encoder.fit_transform(model_dataset[obj])</span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>model_dataset <span class="op">=</span> model_dataset.astype(<span class="bu">float</span>)</span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a>model_dataset <span class="op">=</span> model_dataset.dropna()</span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> model_dataset.drop([<span class="st">'raw_attendance'</span>, <span class="st">'standard_attend'</span>], axis <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> x[[<span class="st">'home_team'</span>, <span class="st">'away_team'</span>, <span class="st">'division'</span>, <span class="st">'date'</span>, <span class="st">'time'</span>, <span class="st">'day_of_week'</span>,<span class="st">'B365H'</span>, <span class="st">'B365D'</span>,</span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a>       <span class="st">'B365A'</span>]]</span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> model_dataset[<span class="st">'raw_attendance'</span>]</span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-32"><a href="#cb24-32" aria-hidden="true" tabindex="-1"></a>x_train, x_test, y_train, y_test <span class="op">=</span> train_test_split(x,y, test_size <span class="op">=</span> <span class="fl">.2</span>, random_state <span class="op">=</span> <span class="dv">11</span>)</span>
<span id="cb24-33"><a href="#cb24-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-34"><a href="#cb24-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-35"><a href="#cb24-35" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------------------------------------------------------------------------------------------</span></span>
<span id="cb24-36"><a href="#cb24-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Random Forest</span></span>
<span id="cb24-37"><a href="#cb24-37" aria-hidden="true" tabindex="-1"></a><span class="co"># The Random Forest Model was Performed outside the file and will be imported into the document. </span></span>
<span id="cb24-38"><a href="#cb24-38" aria-hidden="true" tabindex="-1"></a><span class="co">#  ------------------------------------------------------------------------------------------------------------------------------------------------</span></span>
<span id="cb24-39"><a href="#cb24-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-40"><a href="#cb24-40" aria-hidden="true" tabindex="-1"></a>random_forest_model <span class="op">=</span> RandomForestRegressor(n_estimators <span class="op">=</span> <span class="dv">1000</span>, random_state<span class="op">=</span> <span class="dv">11</span>)</span>
<span id="cb24-41"><a href="#cb24-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-42"><a href="#cb24-42" aria-hidden="true" tabindex="-1"></a>random_forest_model.fit(x_train, y_train)</span>
<span id="cb24-43"><a href="#cb24-43" aria-hidden="true" tabindex="-1"></a><span class="co">#  ------------------------------------------------------------------------------------------------------------------------------------------------</span></span>
<span id="cb24-44"><a href="#cb24-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-45"><a href="#cb24-45" aria-hidden="true" tabindex="-1"></a><span class="co"># random_forest_model = pickle.load(open('../src/Modeling/Random_forest_model.sav', 'rb'))</span></span>
<span id="cb24-46"><a href="#cb24-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-47"><a href="#cb24-47" aria-hidden="true" tabindex="-1"></a>y_predict <span class="op">=</span> random_forest_model.predict(x_test)</span>
<span id="cb24-48"><a href="#cb24-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-49"><a href="#cb24-49" aria-hidden="true" tabindex="-1"></a>mae <span class="op">=</span> metrics.mean_absolute_error(y_test, y_predict)</span>
<span id="cb24-50"><a href="#cb24-50" aria-hidden="true" tabindex="-1"></a>mse <span class="op">=</span> metrics.mean_squared_error(y_test, y_predict)</span>
<span id="cb24-51"><a href="#cb24-51" aria-hidden="true" tabindex="-1"></a>mape <span class="op">=</span> metrics.mean_absolute_percentage_error(y_test, y_predict)</span>
<span id="cb24-52"><a href="#cb24-52" aria-hidden="true" tabindex="-1"></a>r2 <span class="op">=</span> metrics.r2_score(y_test, y_predict)</span>
<span id="cb24-53"><a href="#cb24-53" aria-hidden="true" tabindex="-1"></a>result_df <span class="op">=</span> pd.DataFrame(np.array([[<span class="st">'Mean Absolute Error'</span>, mae], [<span class="st">'Mean Squared Error'</span>, mse],</span>
<span id="cb24-54"><a href="#cb24-54" aria-hidden="true" tabindex="-1"></a>    [<span class="st">'Mean Absolute Percentage Error'</span>, mape], [<span class="st">'r</span><span class="ch">\u00b2</span><span class="st">'</span>, r2]]), columns <span class="op">=</span> [<span class="st">'Metric'</span>, <span class="st">'Score'</span>])</span>
<span id="cb24-55"><a href="#cb24-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-56"><a href="#cb24-56" aria-hidden="true" tabindex="-1"></a>result_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The Random Forest model used 1000 decision trees to build the model. The results of the model can be seen in the table above. It resulted in a fairly high r<sup>2</sup> score of over 0.93. Which means approximately 93% of the variability in attendance is accounted for by our variables. Additionally, the mean absolute error score of approximately 2300 showing that the model’s prediction is on average off by 2300 people. The table below shows examples from the test set of matches with their predicted and actual attendance.</p>

<iframe width="700" height="500" src="http://127.0.0.1:4200"></iframe>

<p>Below is another way to visualize the accuracy of the model. You can select the deviation from the actual attendance to see the percentage of the predictions that were accurate within that range.</p>
<div class="cell" data-execution_count="25">
<details>
<summary>Percentage perdicted data within a range</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>model_result <span class="op">=</span> x_test</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>model_result[<span class="st">'raw_attendance'</span>] <span class="op">=</span> y_test</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>model_result[<span class="st">'predicted_attend'</span>] <span class="op">=</span> y_predict</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>model_result[<span class="st">'division'</span>] <span class="op">=</span> model_result[<span class="st">'division'</span>].astype(<span class="bu">int</span>)</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>model_result[<span class="st">'home_team'</span>] <span class="op">=</span> model_result[<span class="st">'home_team'</span>].astype(<span class="bu">int</span>)</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>model_result[<span class="st">'away_team'</span>] <span class="op">=</span> model_result[<span class="st">'away_team'</span>].astype(<span class="bu">int</span>)</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>model_result <span class="op">=</span> model_result.replace({<span class="st">'division'</span>:div_key, <span class="st">'home_team'</span>: home_key, <span class="st">'away_team'</span>:away_key})</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>in_50 <span class="op">=</span> []</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>in_500 <span class="op">=</span>[]</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>in_750 <span class="op">=</span>[]</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>in_1000 <span class="op">=</span>[]</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>in_1500 <span class="op">=</span>[]</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> index, rows <span class="kw">in</span> model_result.iterrows():</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> rows[<span class="st">'predicted_attend'</span>] <span class="op">&lt;</span> rows[<span class="st">'raw_attendance'</span>]<span class="op">+</span><span class="dv">50</span> <span class="kw">and</span> rows[<span class="st">'predicted_attend'</span>] <span class="op">&gt;</span> rows[<span class="st">'raw_attendance'</span>]<span class="op">-</span><span class="dv">50</span>:</span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>        in_50 <span class="op">+=</span> [<span class="va">True</span>]</span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>        in_50 <span class="op">+=</span> [<span class="va">False</span>]</span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> rows[<span class="st">'predicted_attend'</span>] <span class="op">&lt;</span> rows[<span class="st">'raw_attendance'</span>]<span class="op">+</span><span class="dv">500</span> <span class="kw">and</span> rows[<span class="st">'predicted_attend'</span>] <span class="op">&gt;</span> rows[<span class="st">'raw_attendance'</span>]<span class="op">-</span><span class="dv">500</span>:</span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>        in_500 <span class="op">+=</span> [<span class="va">True</span>]</span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>        in_500 <span class="op">+=</span> [<span class="va">False</span>]</span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> rows[<span class="st">'predicted_attend'</span>] <span class="op">&lt;</span> rows[<span class="st">'raw_attendance'</span>]<span class="op">+</span><span class="dv">750</span> <span class="kw">and</span> rows[<span class="st">'predicted_attend'</span>] <span class="op">&gt;</span> rows[<span class="st">'raw_attendance'</span>]<span class="op">-</span><span class="dv">750</span>:</span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a>        in_750 <span class="op">+=</span> [<span class="va">True</span>]</span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a>        in_750 <span class="op">+=</span> [<span class="va">False</span>] </span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> rows[<span class="st">'predicted_attend'</span>] <span class="op">&lt;</span> rows[<span class="st">'raw_attendance'</span>]<span class="op">+</span><span class="dv">1000</span> <span class="kw">and</span> rows[<span class="st">'predicted_attend'</span>] <span class="op">&gt;</span> rows[<span class="st">'raw_attendance'</span>]<span class="op">-</span><span class="dv">1000</span>:</span>
<span id="cb25-31"><a href="#cb25-31" aria-hidden="true" tabindex="-1"></a>        in_1000 <span class="op">+=</span> [<span class="va">True</span>]</span>
<span id="cb25-32"><a href="#cb25-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb25-33"><a href="#cb25-33" aria-hidden="true" tabindex="-1"></a>        in_1000 <span class="op">+=</span> [<span class="va">False</span>] </span>
<span id="cb25-34"><a href="#cb25-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> rows[<span class="st">'predicted_attend'</span>] <span class="op">&lt;</span> rows[<span class="st">'raw_attendance'</span>]<span class="op">+</span><span class="dv">1500</span> <span class="kw">and</span> rows[<span class="st">'predicted_attend'</span>] <span class="op">&gt;</span> rows[<span class="st">'raw_attendance'</span>]<span class="op">-</span><span class="dv">15000</span>:</span>
<span id="cb25-35"><a href="#cb25-35" aria-hidden="true" tabindex="-1"></a>        in_1500 <span class="op">+=</span> [<span class="va">True</span>]</span>
<span id="cb25-36"><a href="#cb25-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb25-37"><a href="#cb25-37" aria-hidden="true" tabindex="-1"></a>        in_1500 <span class="op">+=</span> [<span class="va">False</span>] </span>
<span id="cb25-38"><a href="#cb25-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-39"><a href="#cb25-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-40"><a href="#cb25-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-41"><a href="#cb25-41" aria-hidden="true" tabindex="-1"></a>model_result[<span class="st">'in_50'</span>] <span class="op">=</span> in_50</span>
<span id="cb25-42"><a href="#cb25-42" aria-hidden="true" tabindex="-1"></a>in_50_grouped <span class="op">=</span> model_result.groupby(<span class="st">'in_50'</span>).count()[<span class="st">'date'</span>].reset_index()</span>
<span id="cb25-43"><a href="#cb25-43" aria-hidden="true" tabindex="-1"></a>in_50_grouped[<span class="st">'pct'</span>] <span class="op">=</span> in_50_grouped[<span class="st">'date'</span>]<span class="op">/</span><span class="bu">sum</span>(in_50_grouped[<span class="st">'date'</span>])</span>
<span id="cb25-44"><a href="#cb25-44" aria-hidden="true" tabindex="-1"></a>in_50_grouped_div <span class="op">=</span> model_result.groupby([<span class="st">'in_50'</span>, <span class="st">'division'</span>]).count()[<span class="st">'date'</span>].reset_index()</span>
<span id="cb25-45"><a href="#cb25-45" aria-hidden="true" tabindex="-1"></a>in_50_grouped_div[<span class="st">'pct'</span>] <span class="op">=</span> in_50_grouped_div[<span class="st">'date'</span>]<span class="op">/</span><span class="bu">sum</span>(in_50_grouped_div[<span class="st">'date'</span>])</span>
<span id="cb25-46"><a href="#cb25-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-47"><a href="#cb25-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-48"><a href="#cb25-48" aria-hidden="true" tabindex="-1"></a>model_result[<span class="st">'in_500'</span>] <span class="op">=</span> in_500</span>
<span id="cb25-49"><a href="#cb25-49" aria-hidden="true" tabindex="-1"></a>in_500_grouped <span class="op">=</span> model_result.groupby(<span class="st">'in_500'</span>).count()[<span class="st">'date'</span>].reset_index()</span>
<span id="cb25-50"><a href="#cb25-50" aria-hidden="true" tabindex="-1"></a>in_500_grouped[<span class="st">'pct'</span>] <span class="op">=</span> in_500_grouped[<span class="st">'date'</span>]<span class="op">/</span><span class="bu">sum</span>(in_500_grouped[<span class="st">'date'</span>])</span>
<span id="cb25-51"><a href="#cb25-51" aria-hidden="true" tabindex="-1"></a>in_500_grouped_div <span class="op">=</span> model_result.groupby([<span class="st">'in_500'</span>, <span class="st">'division'</span>]).count()[<span class="st">'date'</span>].reset_index()</span>
<span id="cb25-52"><a href="#cb25-52" aria-hidden="true" tabindex="-1"></a>in_500_grouped_div[<span class="st">'pct'</span>] <span class="op">=</span> in_500_grouped_div[<span class="st">'date'</span>]<span class="op">/</span><span class="bu">sum</span>(in_500_grouped_div[<span class="st">'date'</span>])</span>
<span id="cb25-53"><a href="#cb25-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-54"><a href="#cb25-54" aria-hidden="true" tabindex="-1"></a>model_result[<span class="st">'in_750'</span>] <span class="op">=</span> in_750</span>
<span id="cb25-55"><a href="#cb25-55" aria-hidden="true" tabindex="-1"></a>in_750_grouped <span class="op">=</span> model_result.groupby(<span class="st">'in_750'</span>).count()[<span class="st">'date'</span>].reset_index()</span>
<span id="cb25-56"><a href="#cb25-56" aria-hidden="true" tabindex="-1"></a>in_750_grouped[<span class="st">'pct'</span>] <span class="op">=</span> in_750_grouped[<span class="st">'date'</span>]<span class="op">/</span><span class="bu">sum</span>(in_750_grouped[<span class="st">'date'</span>])</span>
<span id="cb25-57"><a href="#cb25-57" aria-hidden="true" tabindex="-1"></a>in_750_grouped_div <span class="op">=</span> model_result.groupby([<span class="st">'in_750'</span>, <span class="st">'division'</span>]).count()[<span class="st">'date'</span>].reset_index()</span>
<span id="cb25-58"><a href="#cb25-58" aria-hidden="true" tabindex="-1"></a>in_750_grouped_div[<span class="st">'pct'</span>] <span class="op">=</span> in_750_grouped_div[<span class="st">'date'</span>]<span class="op">/</span><span class="bu">sum</span>(in_750_grouped_div[<span class="st">'date'</span>])</span>
<span id="cb25-59"><a href="#cb25-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-60"><a href="#cb25-60" aria-hidden="true" tabindex="-1"></a>model_result[<span class="st">'in_1000'</span>] <span class="op">=</span> in_1000</span>
<span id="cb25-61"><a href="#cb25-61" aria-hidden="true" tabindex="-1"></a>in_1000_grouped <span class="op">=</span> model_result.groupby(<span class="st">'in_1000'</span>).count()[<span class="st">'date'</span>].reset_index()</span>
<span id="cb25-62"><a href="#cb25-62" aria-hidden="true" tabindex="-1"></a>in_1000_grouped[<span class="st">'pct'</span>] <span class="op">=</span> in_1000_grouped[<span class="st">'date'</span>]<span class="op">/</span><span class="bu">sum</span>(in_1000_grouped[<span class="st">'date'</span>])</span>
<span id="cb25-63"><a href="#cb25-63" aria-hidden="true" tabindex="-1"></a>in_1000_grouped_div <span class="op">=</span> model_result.groupby([<span class="st">'in_1000'</span>, <span class="st">'division'</span>]).count()[<span class="st">'date'</span>].reset_index()</span>
<span id="cb25-64"><a href="#cb25-64" aria-hidden="true" tabindex="-1"></a>in_1000_grouped_div[<span class="st">'pct'</span>] <span class="op">=</span> in_1000_grouped_div[<span class="st">'date'</span>]<span class="op">/</span><span class="bu">sum</span>(in_1000_grouped_div[<span class="st">'date'</span>])</span>
<span id="cb25-65"><a href="#cb25-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-66"><a href="#cb25-66" aria-hidden="true" tabindex="-1"></a>model_result[<span class="st">'in_1500'</span>] <span class="op">=</span> in_1500</span>
<span id="cb25-67"><a href="#cb25-67" aria-hidden="true" tabindex="-1"></a>in_1500_grouped <span class="op">=</span> model_result.groupby(<span class="st">'in_1500'</span>).count()[<span class="st">'date'</span>].reset_index()</span>
<span id="cb25-68"><a href="#cb25-68" aria-hidden="true" tabindex="-1"></a>in_1500_grouped[<span class="st">'pct'</span>] <span class="op">=</span> in_1500_grouped[<span class="st">'date'</span>]<span class="op">/</span><span class="bu">sum</span>(in_1500_grouped[<span class="st">'date'</span>])</span>
<span id="cb25-69"><a href="#cb25-69" aria-hidden="true" tabindex="-1"></a>in_1500_grouped_div <span class="op">=</span> model_result.groupby([<span class="st">'in_1500'</span>, <span class="st">'division'</span>]).count()[<span class="st">'date'</span>].reset_index()</span>
<span id="cb25-70"><a href="#cb25-70" aria-hidden="true" tabindex="-1"></a>in_1500_grouped_div[<span class="st">'pct'</span>] <span class="op">=</span> in_1500_grouped_div[<span class="st">'date'</span>]<span class="op">/</span><span class="bu">sum</span>(in_1500_grouped_div[<span class="st">'date'</span>])</span>
<span id="cb25-71"><a href="#cb25-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-72"><a href="#cb25-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-73"><a href="#cb25-73" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> go.Figure()</span>
<span id="cb25-74"><a href="#cb25-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-75"><a href="#cb25-75" aria-hidden="true" tabindex="-1"></a>fig.add_trace(</span>
<span id="cb25-76"><a href="#cb25-76" aria-hidden="true" tabindex="-1"></a>    go.Pie(labels <span class="op">=</span> in_50_grouped[<span class="st">'in_50'</span>], values<span class="op">=</span> in_50_grouped[<span class="st">'pct'</span>], name <span class="op">=</span> <span class="st">'50'</span>, sort <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb25-77"><a href="#cb25-77" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb25-78"><a href="#cb25-78" aria-hidden="true" tabindex="-1"></a>fig.add_trace(</span>
<span id="cb25-79"><a href="#cb25-79" aria-hidden="true" tabindex="-1"></a>    go.Pie(labels <span class="op">=</span> in_500_grouped[<span class="st">'in_500'</span>], values <span class="op">=</span> in_500_grouped[<span class="st">'pct'</span>], name <span class="op">=</span> <span class="st">"500"</span>, sort <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb25-80"><a href="#cb25-80" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb25-81"><a href="#cb25-81" aria-hidden="true" tabindex="-1"></a>fig.add_trace(</span>
<span id="cb25-82"><a href="#cb25-82" aria-hidden="true" tabindex="-1"></a>    go.Pie(labels<span class="op">=</span> in_750_grouped[<span class="st">'in_750'</span>], values<span class="op">=</span> in_750_grouped[<span class="st">'pct'</span>], name <span class="op">=</span> <span class="st">'750'</span>, sort <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb25-83"><a href="#cb25-83" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb25-84"><a href="#cb25-84" aria-hidden="true" tabindex="-1"></a>fig.add_trace(</span>
<span id="cb25-85"><a href="#cb25-85" aria-hidden="true" tabindex="-1"></a>    go.Pie(labels <span class="op">=</span> in_1000_grouped[<span class="st">'in_1000'</span>], values <span class="op">=</span> in_1000_grouped[<span class="st">'pct'</span>], name <span class="op">=</span> <span class="st">'1000'</span>, sort <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb25-86"><a href="#cb25-86" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb25-87"><a href="#cb25-87" aria-hidden="true" tabindex="-1"></a>fig.add_trace(</span>
<span id="cb25-88"><a href="#cb25-88" aria-hidden="true" tabindex="-1"></a>    go.Pie(labels <span class="op">=</span> in_1500_grouped[<span class="st">'in_1500'</span>], values <span class="op">=</span> in_1500_grouped[<span class="st">'pct'</span>], name<span class="op">=</span> <span class="st">'1500'</span>, sort <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb25-89"><a href="#cb25-89" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb25-90"><a href="#cb25-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-91"><a href="#cb25-91" aria-hidden="true" tabindex="-1"></a>fig.update_layout(</span>
<span id="cb25-92"><a href="#cb25-92" aria-hidden="true" tabindex="-1"></a>    updatemenus<span class="op">=</span>[</span>
<span id="cb25-93"><a href="#cb25-93" aria-hidden="true" tabindex="-1"></a>        <span class="bu">dict</span>(</span>
<span id="cb25-94"><a href="#cb25-94" aria-hidden="true" tabindex="-1"></a>            active<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb25-95"><a href="#cb25-95" aria-hidden="true" tabindex="-1"></a>            buttons<span class="op">=</span><span class="bu">list</span>([</span>
<span id="cb25-96"><a href="#cb25-96" aria-hidden="true" tabindex="-1"></a>                <span class="bu">dict</span>(label<span class="op">=</span><span class="st">"50"</span>,</span>
<span id="cb25-97"><a href="#cb25-97" aria-hidden="true" tabindex="-1"></a>                     method<span class="op">=</span><span class="st">"update"</span>,</span>
<span id="cb25-98"><a href="#cb25-98" aria-hidden="true" tabindex="-1"></a>                     args<span class="op">=</span>[{<span class="st">"visible"</span>: [<span class="va">True</span>, <span class="va">False</span>, <span class="va">False</span>, <span class="va">False</span>, <span class="va">False</span>]},</span>
<span id="cb25-99"><a href="#cb25-99" aria-hidden="true" tabindex="-1"></a>                           {<span class="st">"title"</span>: <span class="st">"Prediction within 50 of Actual Attendance"</span>}]),</span>
<span id="cb25-100"><a href="#cb25-100" aria-hidden="true" tabindex="-1"></a>                <span class="bu">dict</span>(label<span class="op">=</span><span class="st">"500"</span>,</span>
<span id="cb25-101"><a href="#cb25-101" aria-hidden="true" tabindex="-1"></a>                     method<span class="op">=</span><span class="st">"update"</span>,</span>
<span id="cb25-102"><a href="#cb25-102" aria-hidden="true" tabindex="-1"></a>                     args<span class="op">=</span>[{<span class="st">"visible"</span>: [<span class="va">True</span>, <span class="va">True</span>, <span class="va">False</span>, <span class="va">False</span>, <span class="va">False</span>]},</span>
<span id="cb25-103"><a href="#cb25-103" aria-hidden="true" tabindex="-1"></a>                           {<span class="st">"title"</span>: <span class="st">"Prediction within 500 Actual Attendance"</span>}</span>
<span id="cb25-104"><a href="#cb25-104" aria-hidden="true" tabindex="-1"></a>                            ]),</span>
<span id="cb25-105"><a href="#cb25-105" aria-hidden="true" tabindex="-1"></a>                <span class="bu">dict</span>(label<span class="op">=</span><span class="st">"750"</span>,</span>
<span id="cb25-106"><a href="#cb25-106" aria-hidden="true" tabindex="-1"></a>                     method<span class="op">=</span><span class="st">"update"</span>,</span>
<span id="cb25-107"><a href="#cb25-107" aria-hidden="true" tabindex="-1"></a>                     args<span class="op">=</span>[{<span class="st">"visible"</span>: [<span class="va">False</span>, <span class="va">False</span>, <span class="va">True</span>, <span class="va">False</span>]},</span>
<span id="cb25-108"><a href="#cb25-108" aria-hidden="true" tabindex="-1"></a>                           {<span class="st">"title"</span>: <span class="st">"Prediction within 750 Actual Attendance"</span>}]),</span>
<span id="cb25-109"><a href="#cb25-109" aria-hidden="true" tabindex="-1"></a>                <span class="bu">dict</span>(label<span class="op">=</span><span class="st">"1000"</span>,</span>
<span id="cb25-110"><a href="#cb25-110" aria-hidden="true" tabindex="-1"></a>                     method<span class="op">=</span><span class="st">"update"</span>,</span>
<span id="cb25-111"><a href="#cb25-111" aria-hidden="true" tabindex="-1"></a>                     args<span class="op">=</span>[{<span class="st">"visible"</span>: [<span class="va">False</span>, <span class="va">False</span>, <span class="va">False</span>, <span class="va">True</span>,<span class="va">False</span>]},</span>
<span id="cb25-112"><a href="#cb25-112" aria-hidden="true" tabindex="-1"></a>                           {<span class="st">"title"</span>: <span class="st">"Prediction within 1000 Actual Attendance"</span>}]),</span>
<span id="cb25-113"><a href="#cb25-113" aria-hidden="true" tabindex="-1"></a>                <span class="bu">dict</span>(label<span class="op">=</span><span class="st">"1500"</span>,</span>
<span id="cb25-114"><a href="#cb25-114" aria-hidden="true" tabindex="-1"></a>                     method<span class="op">=</span><span class="st">"update"</span>,</span>
<span id="cb25-115"><a href="#cb25-115" aria-hidden="true" tabindex="-1"></a>                     args<span class="op">=</span>[{<span class="st">"visible"</span>: [<span class="va">False</span>, <span class="va">False</span>, <span class="va">False</span>, <span class="va">False</span>,<span class="va">True</span>]},</span>
<span id="cb25-116"><a href="#cb25-116" aria-hidden="true" tabindex="-1"></a>                           {<span class="st">"title"</span>: <span class="st">"Prediction within 1500 Actual Attendance"</span>}]), </span>
<span id="cb25-117"><a href="#cb25-117" aria-hidden="true" tabindex="-1"></a>            ]),</span>
<span id="cb25-118"><a href="#cb25-118" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb25-119"><a href="#cb25-119" aria-hidden="true" tabindex="-1"></a>    ])</span>
<span id="cb25-120"><a href="#cb25-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-121"><a href="#cb25-121" aria-hidden="true" tabindex="-1"></a>fig.update_layout(title_text<span class="op">=</span><span class="st">"Prediction within 50"</span>)</span>
<span id="cb25-122"><a href="#cb25-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-123"><a href="#cb25-123" aria-hidden="true" tabindex="-1"></a>fig.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<!-- -->


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" role="doc-bibliography">
<div id="ref-footballstadiumsFootballClubs" class="csl-entry" role="doc-biblioentry">
<span>“<span>H</span>ow <span>D</span>o <span>F</span>ootball <span>C</span>lubs <span>M</span>ake <span>M</span>oney? | <span>F</span>ootball-<span>S</span>tadiums.co.uk — Football-Stadiums.co.uk.”</span> <a href="https://www.football-stadiums.co.uk/articles/how-do-football-clubs-make-money/" class="uri">https://www.football-stadiums.co.uk/articles/how-do-football-clubs-make-money/</a>.
</div>
<div id="ref-sportskeeda" class="csl-entry" role="doc-biblioentry">
<span>“Sportskeeda.”</span> 2023. 2023. <a href="https://www.sportskeeda.com/football/la-liga-winners">https://www.sportskeeda.com/football/la-liga-winners</a>.
</div>
<div id="ref-sportforbusinessWorldsMost" class="csl-entry" role="doc-biblioentry">
<span>“<span>T</span>he <span>W</span>orld’s <span>M</span>ost <span>W</span>atched <span>S</span>ports - <span>S</span>port for <span>B</span>usiness — Sportforbusiness.com.”</span> <a href="https://sportforbusiness.com/the-worlds-most-watched-sports/" class="uri">https://sportforbusiness.com/the-worlds-most-watched-sports/</a>.
</div>
</div></section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb26" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Will the Stadium be Buzzing or Silent?"</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="an">subtitle:</span><span class="co"> "Demand of Attendance for European Football Leagues"</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "Matthew Wilcox"</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="an">bibliography:</span><span class="co"> 'references.bib'</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="an">number-sections:</span><span class="co"> false</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a><span class="co">    theme: default</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a><span class="co">    rendering: default</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true</span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a><span class="co">    warning: false</span></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a><span class="co">  pdf: default</span></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a><span class="an">jupyter:</span><span class="co"> python3</span></span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>!<span class="co">[</span><span class="ot">Photo by [Victoria Prymak](https://unsplash.com/@vprmk) on [Unsplash](https://unsplash.com/)</span><span class="co">](Header Image/victoria-prymak-CCe_Xt5sEDA-unsplash.jpg)</span></span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a><span class="fu"># Why Attendance Matters </span></span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a>Football (Soccer), with an estimated 3.5 billion fans worldwide, is the most popular sport in the world <span class="co">[</span><span class="ot">@sportforbusinessWorldsMost</span><span class="co">]</span>. In turn, a large economy and business surrounds the sport. Football teams need to be profitable to succeed. But how do these teams make money? Mainly from 5 different revenue sources: television money, prize money, player transfers, sponsorships, and matchday revenues <span class="co">[</span><span class="ot">@footballstadiumsFootballClubs</span><span class="co">]</span>. Out of all of these, one of the most universal is match day revenues. For many teams, the match day revenue is the lifeblood of the club as it is the sales from ticket sales, concessions, club store purchases, etc. </span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true" tabindex="-1"></a>The attendance of a match can significantly affect a team's match day revenue. So understanding factors affecting attendance and predicting the attendance is important. If a club could predict the number of people attending a match, they could be better prepared for it. Such as, if the match is expected to have lower attendance than desired, the club could market it differently or have special promotions to increase the attendance for that match. </span>
<span id="cb26-28"><a href="#cb26-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-29"><a href="#cb26-29" aria-hidden="true" tabindex="-1"></a>There are many factors that could impact the attendance of a match. However, the factors used here are the day and time of the match, betting odds for a match, and who the away team is for any given match. Later we will also produce a random forest model to predict the attendance of matches based on these factors. </span>
<span id="cb26-30"><a href="#cb26-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-31"><a href="#cb26-31" aria-hidden="true" tabindex="-1"></a><span class="fu"># Python Packages Used</span></span>
<span id="cb26-32"><a href="#cb26-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-35"><a href="#cb26-35" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb26-36"><a href="#cb26-36" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb26-37"><a href="#cb26-37" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Library Packages"</span></span>
<span id="cb26-38"><a href="#cb26-38" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb26-39"><a href="#cb26-39" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb26-40"><a href="#cb26-40" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestRegressor</span>
<span id="cb26-41"><a href="#cb26-41" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb26-42"><a href="#cb26-42" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb26-43"><a href="#cb26-43" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb26-44"><a href="#cb26-44" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> LabelEncoder</span>
<span id="cb26-45"><a href="#cb26-45" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb26-46"><a href="#cb26-46" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_squared_error</span>
<span id="cb26-47"><a href="#cb26-47" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> accuracy_score, confusion_matrix, classification_report</span>
<span id="cb26-48"><a href="#cb26-48" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn <span class="im">import</span> metrics</span>
<span id="cb26-49"><a href="#cb26-49" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LinearRegression</span>
<span id="cb26-50"><a href="#cb26-50" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> july</span>
<span id="cb26-51"><a href="#cb26-51" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime <span class="im">as</span> dt</span>
<span id="cb26-52"><a href="#cb26-52" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> jupyter_dash <span class="im">import</span> JupyterDash</span>
<span id="cb26-53"><a href="#cb26-53" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dash <span class="im">import</span> html, dcc, Input, Output</span>
<span id="cb26-54"><a href="#cb26-54" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.graph_objects <span class="im">as</span> go</span>
<span id="cb26-55"><a href="#cb26-55" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime, time</span>
<span id="cb26-56"><a href="#cb26-56" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> re <span class="im">import</span> sub</span>
<span id="cb26-57"><a href="#cb26-57" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb26-58"><a href="#cb26-58" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.express <span class="im">as</span> px</span>
<span id="cb26-59"><a href="#cb26-59" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pickle</span>
<span id="cb26-60"><a href="#cb26-60" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-61"><a href="#cb26-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-62"><a href="#cb26-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-63"><a href="#cb26-63" aria-hidden="true" tabindex="-1"></a><span class="fu"># Data Collection</span></span>
<span id="cb26-64"><a href="#cb26-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-65"><a href="#cb26-65" aria-hidden="true" tabindex="-1"></a>This project used data that was collected from two sources: <span class="co">[</span><span class="ot">worldfootball.net</span><span class="co">](https://www.worldfootball.net/)</span> and <span class="co">[</span><span class="ot">Football-data.co.uk</span><span class="co">](https://www.football-data.co.uk/)</span>. The data that was collected from worldfootball.net was information on the match, such as the team names, the time and date of the match, and most importantly, each matches attendance. This data was scraped on January 31st, 2023. The data that was downloaded from Football-data.co.uk was primarily betting information for each game. This data was already tabulated into CSV files which were divided based on the year and league. All the files were downloaded on February 3rd, 2023.</span>
<span id="cb26-66"><a href="#cb26-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-67"><a href="#cb26-67" aria-hidden="true" tabindex="-1"></a>The data that was collected spanned from 2010 to 2023. It consisted of leagues from 11 countries: England, Scotland, Germany, Italy, Spain, France, Netherlands, Belgium, Portugal, Turkey, and Greece. In total, the data contained 21 leagues from these countries.</span>
<span id="cb26-68"><a href="#cb26-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-69"><a href="#cb26-69" aria-hidden="true" tabindex="-1"></a><span class="fu"># Data Processing</span></span>
<span id="cb26-70"><a href="#cb26-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-73"><a href="#cb26-73" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb26-74"><a href="#cb26-74" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb26-75"><a href="#cb26-75" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: Preprocessing Data</span></span>
<span id="cb26-76"><a href="#cb26-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-77"><a href="#cb26-77" aria-hidden="true" tabindex="-1"></a>betting_data <span class="op">=</span> pd.read_csv(<span class="st">'../data/RAWDATA/RAW_betting_data.csv'</span>)</span>
<span id="cb26-78"><a href="#cb26-78" aria-hidden="true" tabindex="-1"></a>match_data <span class="op">=</span>  pd.read_csv(<span class="st">'../data/RAWDATA/RAW_match_data.csv'</span>)</span>
<span id="cb26-79"><a href="#cb26-79" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'../src/Data_Processing/key_dictionary.pkl'</span>, <span class="st">'rb'</span>) <span class="im">as</span> pick:</span>
<span id="cb26-80"><a href="#cb26-80" aria-hidden="true" tabindex="-1"></a>    key_dict <span class="op">=</span> pickle.load(pick)</span>
<span id="cb26-81"><a href="#cb26-81" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> snake_case(s):</span>
<span id="cb26-82"><a href="#cb26-82" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="st">'_'</span>.join(</span>
<span id="cb26-83"><a href="#cb26-83" aria-hidden="true" tabindex="-1"></a>    sub(<span class="st">'([A-Z][a-z]+)'</span>, <span class="vs">r' \1'</span>,</span>
<span id="cb26-84"><a href="#cb26-84" aria-hidden="true" tabindex="-1"></a>    sub(<span class="st">'([A-Z]+)'</span>, <span class="vs">r' \1'</span>,</span>
<span id="cb26-85"><a href="#cb26-85" aria-hidden="true" tabindex="-1"></a>    s.replace(<span class="st">'-'</span>, <span class="st">' '</span>))).split()).lower()</span>
<span id="cb26-86"><a href="#cb26-86" aria-hidden="true" tabindex="-1"></a>betting_data[<span class="st">'HomeTeam'</span>] <span class="op">=</span>betting_data[<span class="st">'HomeTeam'</span>].<span class="bu">apply</span>(<span class="bu">str</span>)</span>
<span id="cb26-87"><a href="#cb26-87" aria-hidden="true" tabindex="-1"></a>betting_data[<span class="st">'HomeTeam'</span>] <span class="op">=</span>betting_data[<span class="st">'HomeTeam'</span>].<span class="bu">apply</span>(snake_case)</span>
<span id="cb26-88"><a href="#cb26-88" aria-hidden="true" tabindex="-1"></a>betting_data[<span class="st">'AwayTeam'</span>] <span class="op">=</span>betting_data[<span class="st">'AwayTeam'</span>].<span class="bu">apply</span>(<span class="bu">str</span>)</span>
<span id="cb26-89"><a href="#cb26-89" aria-hidden="true" tabindex="-1"></a>betting_data[<span class="st">'AwayTeam'</span>] <span class="op">=</span>betting_data[<span class="st">'AwayTeam'</span>].<span class="bu">apply</span>(snake_case)</span>
<span id="cb26-90"><a href="#cb26-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-91"><a href="#cb26-91" aria-hidden="true" tabindex="-1"></a>betting_data[<span class="st">'HomeTeam'</span>] <span class="op">=</span> betting_data[<span class="st">'HomeTeam'</span>].replace(key_dict)</span>
<span id="cb26-92"><a href="#cb26-92" aria-hidden="true" tabindex="-1"></a>betting_data[<span class="st">'AwayTeam'</span>] <span class="op">=</span> betting_data[<span class="st">'AwayTeam'</span>].replace(key_dict)</span>
<span id="cb26-93"><a href="#cb26-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-94"><a href="#cb26-94" aria-hidden="true" tabindex="-1"></a>match_data[<span class="st">'home_team'</span>] <span class="op">=</span>match_data[<span class="st">'home_team'</span>].<span class="bu">apply</span>(<span class="bu">str</span>)</span>
<span id="cb26-95"><a href="#cb26-95" aria-hidden="true" tabindex="-1"></a>match_data[<span class="st">'home_team'</span>] <span class="op">=</span>match_data[<span class="st">'home_team'</span>].<span class="bu">apply</span>(snake_case)</span>
<span id="cb26-96"><a href="#cb26-96" aria-hidden="true" tabindex="-1"></a>match_data[<span class="st">'away_team'</span>] <span class="op">=</span>match_data[<span class="st">'away_team'</span>].<span class="bu">apply</span>(<span class="bu">str</span>)</span>
<span id="cb26-97"><a href="#cb26-97" aria-hidden="true" tabindex="-1"></a>match_data[<span class="st">'away_team'</span>] <span class="op">=</span>match_data[<span class="st">'away_team'</span>].<span class="bu">apply</span>(snake_case)</span>
<span id="cb26-98"><a href="#cb26-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-99"><a href="#cb26-99" aria-hidden="true" tabindex="-1"></a>match_data[<span class="st">'Hohome_teammeTeam'</span>] <span class="op">=</span> match_data[<span class="st">'home_team'</span>].replace(key_dict)</span>
<span id="cb26-100"><a href="#cb26-100" aria-hidden="true" tabindex="-1"></a>match_data[<span class="st">'away_team'</span>] <span class="op">=</span> match_data[<span class="st">'away_team'</span>].replace(key_dict)</span>
<span id="cb26-101"><a href="#cb26-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-102"><a href="#cb26-102" aria-hidden="true" tabindex="-1"></a>month_key <span class="op">=</span> {<span class="st">'August'</span>: <span class="st">'8'</span>, <span class="st">'September'</span>:<span class="st">'9'</span>, <span class="st">'October'</span>:<span class="st">'10'</span>, <span class="st">'November'</span>: <span class="st">'11'</span>,<span class="st">'December'</span>:<span class="st">'12'</span>, <span class="st">'January'</span>:<span class="st">'1'</span>, <span class="st">'February'</span>:<span class="st">'2'</span>, <span class="st">'March'</span>:<span class="st">'3'</span>, <span class="st">'April'</span>:<span class="st">'4'</span>, <span class="st">'May'</span>:<span class="st">'5'</span>, <span class="st">'June'</span> : <span class="st">'6'</span>, <span class="st">'July'</span>:<span class="st">'7'</span>}</span>
<span id="cb26-103"><a href="#cb26-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-104"><a href="#cb26-104" aria-hidden="true" tabindex="-1"></a>match_data[<span class="st">'month'</span>]<span class="op">=</span> match_data[<span class="st">'month'</span>].replace(month_key)</span>
<span id="cb26-105"><a href="#cb26-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-106"><a href="#cb26-106" aria-hidden="true" tabindex="-1"></a>match_data[<span class="st">'date'</span>] <span class="op">=</span> match_data[<span class="st">'day_of_month'</span>].astype(<span class="bu">str</span>) <span class="op">+</span> <span class="st">"-"</span> <span class="op">+</span> match_data[<span class="st">'month'</span>].astype(<span class="bu">str</span>) <span class="op">+</span> <span class="st">"-"</span> <span class="op">+</span> match_data[<span class="st">'year'</span>].astype(<span class="bu">str</span>)</span>
<span id="cb26-107"><a href="#cb26-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-108"><a href="#cb26-108" aria-hidden="true" tabindex="-1"></a>match_data[<span class="st">'date'</span>] <span class="op">=</span> pd.to_datetime(match_data[<span class="st">'date'</span>])</span>
<span id="cb26-109"><a href="#cb26-109" aria-hidden="true" tabindex="-1"></a>betting_data[<span class="st">'Date'</span>] <span class="op">=</span> pd.to_datetime(betting_data[<span class="st">'Date'</span>])</span>
<span id="cb26-110"><a href="#cb26-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-111"><a href="#cb26-111" aria-hidden="true" tabindex="-1"></a>merged_df <span class="op">=</span> pd.merge(match_data, betting_data, left_on <span class="op">=</span> [<span class="st">'date'</span>, <span class="st">'home_team'</span>, <span class="st">'away_team'</span>], right_on <span class="op">=</span> [<span class="st">'Date'</span>, <span class="st">'HomeTeam'</span>, <span class="st">'AwayTeam'</span>], how <span class="op">=</span><span class="st">'left'</span>, indicator<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb26-112"><a href="#cb26-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-113"><a href="#cb26-113" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> merged_df</span>
<span id="cb26-114"><a href="#cb26-114" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> data[data[<span class="st">'year'</span>]<span class="op">&lt;=</span> <span class="dv">2019</span>]</span>
<span id="cb26-115"><a href="#cb26-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-116"><a href="#cb26-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-117"><a href="#cb26-117" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> data[[<span class="st">'home_team'</span>,<span class="st">'away_team'</span>,<span class="st">'home_score'</span>,<span class="st">'away_score'</span>,<span class="st">'date'</span>,<span class="st">'time'</span>,<span class="st">'day_of_week'</span>,<span class="st">'attendance'</span>,<span class="st">'Div'</span>,<span class="st">'FTHG'</span>,<span class="st">'FTAG'</span>,<span class="st">'FTR'</span>,<span class="st">'HTHG'</span>,<span class="st">'HTAG'</span>,<span class="st">'HTR'</span>,<span class="st">'B365H'</span>,<span class="st">'B365D'</span>,<span class="st">'B365A'</span>,<span class="st">'BWH'</span>,<span class="st">'BWD'</span>,<span class="st">'BWA'</span>,<span class="st">'WHH'</span>,<span class="st">'WHD'</span>,<span class="st">'WHA'</span>,<span class="st">'VCH'</span>,<span class="st">'VCD'</span>,<span class="st">'VCA'</span>,<span class="st">'BbMx&gt;2.5'</span>,<span class="st">'BbAv&gt;2.5'</span>,<span class="st">'BbMx&lt;2.5'</span>,<span class="st">'BbAv&lt;2.5'</span>]]</span>
<span id="cb26-118"><a href="#cb26-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-119"><a href="#cb26-119" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> data.rename(columns <span class="op">=</span> {<span class="st">'attendance'</span>:<span class="st">'raw_attendance'</span>})</span>
<span id="cb26-120"><a href="#cb26-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-121"><a href="#cb26-121" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> data[data[<span class="st">'raw_attendance'</span>].<span class="bu">str</span>.contains(<span class="st">'\d'</span>)]</span>
<span id="cb26-122"><a href="#cb26-122" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'raw_attendance'</span>] <span class="op">=</span> data[<span class="st">'raw_attendance'</span>].astype(<span class="bu">float</span>)</span>
<span id="cb26-123"><a href="#cb26-123" aria-hidden="true" tabindex="-1"></a><span class="co"># data['Capacity'] = data['Capacity'].astype(float)</span></span>
<span id="cb26-124"><a href="#cb26-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-125"><a href="#cb26-125" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> remove_non_numberics(s):</span>
<span id="cb26-126"><a href="#cb26-126" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> sub(<span class="st">'[^0-9]'</span>, <span class="st">''</span>, s)</span>
<span id="cb26-127"><a href="#cb26-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-128"><a href="#cb26-128" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'away_score'</span>] <span class="op">=</span> data[<span class="st">'away_score'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: re.sub(<span class="st">'[^0-9]'</span>, <span class="st">''</span>, x))</span>
<span id="cb26-129"><a href="#cb26-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-130"><a href="#cb26-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-131"><a href="#cb26-131" aria-hidden="true" tabindex="-1"></a><span class="co"># Alter Data types:</span></span>
<span id="cb26-132"><a href="#cb26-132" aria-hidden="true" tabindex="-1"></a>data<span class="op">=</span> data.rename(columns<span class="op">=</span>{ <span class="st">'Div'</span>:<span class="st">'division'</span>})</span>
<span id="cb26-133"><a href="#cb26-133" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'home_score'</span>]<span class="op">=</span> data[<span class="st">'home_score'</span>].astype(<span class="bu">int</span>)</span>
<span id="cb26-134"><a href="#cb26-134" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'away_score'</span>] <span class="op">=</span> data[<span class="st">'away_score'</span>].astype(<span class="bu">int</span>)</span>
<span id="cb26-135"><a href="#cb26-135" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'date'</span>] <span class="op">=</span> data[<span class="st">'date'</span>].astype(<span class="bu">str</span>)</span>
<span id="cb26-136"><a href="#cb26-136" aria-hidden="true" tabindex="-1"></a><span class="co"># data['time'] = data['time'].apply(lambda x: datetime.strptime(x, '%H:%M'))</span></span>
<span id="cb26-137"><a href="#cb26-137" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'date_time'</span>] <span class="op">=</span> data.<span class="bu">apply</span>(<span class="kw">lambda</span> row: pd.to_datetime(<span class="bu">str</span>(row[<span class="st">'date'</span>]) <span class="op">+</span> <span class="st">' '</span> <span class="op">+</span> <span class="bu">str</span>(row[<span class="st">'time'</span>])),axis <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb26-138"><a href="#cb26-138" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'raw_attendance'</span>]<span class="op">=</span> data[<span class="st">'raw_attendance'</span>].astype(<span class="bu">int</span>)</span>
<span id="cb26-139"><a href="#cb26-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-140"><a href="#cb26-140" aria-hidden="true" tabindex="-1"></a>season <span class="op">=</span> []</span>
<span id="cb26-141"><a href="#cb26-141" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> index, rows <span class="kw">in</span> data.iterrows():</span>
<span id="cb26-142"><a href="#cb26-142" aria-hidden="true" tabindex="-1"></a>    match_day <span class="op">=</span> dt.strptime(rows[<span class="st">'date'</span>], <span class="st">'%Y-%m-</span><span class="sc">%d</span><span class="st">'</span>)</span>
<span id="cb26-143"><a href="#cb26-143" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(match_day)</span></span>
<span id="cb26-144"><a href="#cb26-144" aria-hidden="true" tabindex="-1"></a>    year <span class="op">=</span> <span class="bu">int</span>(dt.strftime(match_day, <span class="st">'%Y'</span>))</span>
<span id="cb26-145"><a href="#cb26-145" aria-hidden="true" tabindex="-1"></a>    month_day <span class="op">=</span> dt.strftime(match_day, <span class="st">'%m-</span><span class="sc">%d</span><span class="st">'</span>)</span>
<span id="cb26-146"><a href="#cb26-146" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(int(year))</span></span>
<span id="cb26-147"><a href="#cb26-147" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(type(year))</span></span>
<span id="cb26-148"><a href="#cb26-148" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(month_day)</span></span>
<span id="cb26-149"><a href="#cb26-149" aria-hidden="true" tabindex="-1"></a>    cutoff_date <span class="op">=</span> dt.strftime(dt(<span class="dv">2014</span>,<span class="dv">7</span>,<span class="dv">14</span>), <span class="st">'%m-</span><span class="sc">%d</span><span class="st">'</span>)</span>
<span id="cb26-150"><a href="#cb26-150" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> month_day <span class="op">&gt;</span> cutoff_date:</span>
<span id="cb26-151"><a href="#cb26-151" aria-hidden="true" tabindex="-1"></a>        year <span class="op">=</span> year <span class="op">+</span><span class="dv">1</span></span>
<span id="cb26-152"><a href="#cb26-152" aria-hidden="true" tabindex="-1"></a>        season <span class="op">=</span> season <span class="op">+</span> [year]</span>
<span id="cb26-153"><a href="#cb26-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-154"><a href="#cb26-154" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb26-155"><a href="#cb26-155" aria-hidden="true" tabindex="-1"></a>        season <span class="op">=</span> season <span class="op">+</span> [year]</span>
<span id="cb26-156"><a href="#cb26-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-157"><a href="#cb26-157" aria-hidden="true" tabindex="-1"></a><span class="co"># def stand_dev(x): return np.std(x)</span></span>
<span id="cb26-158"><a href="#cb26-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-159"><a href="#cb26-159" aria-hidden="true" tabindex="-1"></a>data[<span class="st">'season'</span>] <span class="op">=</span> season</span>
<span id="cb26-160"><a href="#cb26-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-161"><a href="#cb26-161" aria-hidden="true" tabindex="-1"></a>data_std <span class="op">=</span> data.groupby([<span class="st">'home_team'</span>, <span class="st">'season'</span>])[<span class="st">'raw_attendance'</span>].std().reset_index()</span>
<span id="cb26-162"><a href="#cb26-162" aria-hidden="true" tabindex="-1"></a>data_std <span class="op">=</span> data_std.rename(columns <span class="op">=</span> {<span class="st">'raw_attendance'</span>:<span class="st">'std_attend'</span>})</span>
<span id="cb26-163"><a href="#cb26-163" aria-hidden="true" tabindex="-1"></a>data_mean <span class="op">=</span> data.groupby([<span class="st">'home_team'</span>, <span class="st">'season'</span>]).mean().reset_index()</span>
<span id="cb26-164"><a href="#cb26-164" aria-hidden="true" tabindex="-1"></a>data_mean <span class="op">=</span> data_mean[[<span class="st">'home_team'</span>, <span class="st">'season'</span>, <span class="st">'raw_attendance'</span>]].rename(columns <span class="op">=</span> {<span class="st">'raw_attendance'</span>: <span class="st">'mean_attend'</span>})</span>
<span id="cb26-165"><a href="#cb26-165" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> pd.merge(data, data_mean, on <span class="op">=</span> [<span class="st">'home_team'</span>, <span class="st">'season'</span>])</span>
<span id="cb26-166"><a href="#cb26-166" aria-hidden="true" tabindex="-1"></a>total_data <span class="op">=</span> pd.merge(data, data_std, on<span class="op">=</span> [<span class="st">'home_team'</span>, <span class="st">'season'</span>])</span>
<span id="cb26-167"><a href="#cb26-167" aria-hidden="true" tabindex="-1"></a>total_data[<span class="st">'standard_attend'</span>] <span class="op">=</span> (total_data[<span class="st">'raw_attendance'</span>]<span class="op">-</span>total_data[<span class="st">'mean_attend'</span>])<span class="op">/</span> total_data[<span class="st">'std_attend'</span>]</span>
<span id="cb26-168"><a href="#cb26-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-169"><a href="#cb26-169" aria-hidden="true" tabindex="-1"></a>total_data <span class="op">=</span> total_data[total_data[<span class="st">'division'</span>] <span class="op">!=</span> <span class="st">'SC2'</span>]</span>
<span id="cb26-170"><a href="#cb26-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-171"><a href="#cb26-171" aria-hidden="true" tabindex="-1"></a>div_dict <span class="op">=</span> {<span class="st">'D1'</span>:<span class="st">'Bundesliga'</span>, <span class="st">'D2'</span>: <span class="st">'2. Bundesliga'</span>, <span class="st">'E0'</span>:<span class="st">'Premier League'</span>, <span class="st">'E1'</span>:<span class="st">'Championship'</span>, </span>
<span id="cb26-172"><a href="#cb26-172" aria-hidden="true" tabindex="-1"></a>            <span class="st">'E2'</span>:<span class="st">'League 1'</span>, <span class="st">'E3'</span>:<span class="st">'League 2'</span>,<span class="st">'SP1'</span>:<span class="st">'La Liga Primera'</span>, <span class="st">'SP2'</span>:<span class="st">'La Liga Segunda'</span>,</span>
<span id="cb26-173"><a href="#cb26-173" aria-hidden="true" tabindex="-1"></a>              <span class="st">'B1'</span>:<span class="st">'Jupiler League'</span>, <span class="st">'F1'</span>:<span class="st">'Ligue 1'</span>,<span class="st">'F2'</span>:<span class="st">'Ligue 2'</span>,<span class="st">'I1'</span>:<span class="st">'Serie A'</span>,<span class="st">'I2'</span>:<span class="st">'Serie B'</span>, </span>
<span id="cb26-174"><a href="#cb26-174" aria-hidden="true" tabindex="-1"></a>              <span class="st">'SC0'</span>:<span class="st">'Scottish Premier League'</span>, <span class="st">'SC1'</span>:<span class="st">'Scottish Division 1'</span>, <span class="st">'T1'</span>:<span class="st">'Fubol Ligi 1'</span>, <span class="st">'P1'</span>: <span class="st">'Liga 1'</span>}</span>
<span id="cb26-175"><a href="#cb26-175" aria-hidden="true" tabindex="-1"></a>divisions_list <span class="op">=</span>[<span class="st">'D1'</span>, <span class="st">'D2'</span>, <span class="st">'E0'</span>, <span class="st">'E1'</span>, <span class="st">'E2'</span>, <span class="st">'E3'</span>, <span class="st">'SP1'</span> ,<span class="st">'SP2'</span>, <span class="st">'B1'</span>, <span class="st">'F1'</span>, <span class="st">'F2'</span>, <span class="st">'I1'</span>, <span class="st">'I2'</span>, <span class="st">'SC0'</span>, <span class="st">'SC1'</span>, <span class="st">'T1'</span>, <span class="st">'P1'</span>]</span>
<span id="cb26-176"><a href="#cb26-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-177"><a href="#cb26-177" aria-hidden="true" tabindex="-1"></a>total_data[<span class="st">'home_team'</span>] <span class="op">=</span> total_data[<span class="st">'home_team'</span>].<span class="bu">str</span>.replace(<span class="st">'_'</span>, <span class="st">' '</span>).<span class="bu">apply</span>(<span class="kw">lambda</span> x: x.title())</span>
<span id="cb26-178"><a href="#cb26-178" aria-hidden="true" tabindex="-1"></a>total_data[<span class="st">'away_team'</span>] <span class="op">=</span> total_data[<span class="st">'away_team'</span>].<span class="bu">str</span>.replace(<span class="st">'_'</span>, <span class="st">' '</span>).<span class="bu">apply</span>(<span class="kw">lambda</span> x: x.title())</span>
<span id="cb26-179"><a href="#cb26-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-180"><a href="#cb26-180" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-181"><a href="#cb26-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-182"><a href="#cb26-182" aria-hidden="true" tabindex="-1"></a>All of the CSV files from Football-data.co.uk were combined together, resulting in two datasets, one with all of the betting data and the other with the attendance. The two datasets were to be combined on the home team name, away team name, and the date and time of the game to create one final dataset. However, issues arose as they had different naming structures for team names. For example, the team Manchester City in one dataset would be identified as "man_city" and in the other as "manchester_city". With these different naming structures and spellings, a list of team names was created from both datasets. These lists were put through a python script that took a team from one list and compared the characters to team names in the other list. I stated with one entire team name and slowly decreasing its size, searching the other list for matches. The table below demonstrates how team names would be split up into a list of smaller strings. This would be repeated until the team list was broken up into single characters.</span>
<span id="cb26-183"><a href="#cb26-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-184"><a href="#cb26-184" aria-hidden="true" tabindex="-1"></a>|Itteration| Results|</span>
<span id="cb26-185"><a href="#cb26-185" aria-hidden="true" tabindex="-1"></a>|----|-----|</span>
<span id="cb26-186"><a href="#cb26-186" aria-hidden="true" tabindex="-1"></a>|1| man_city|</span>
<span id="cb26-187"><a href="#cb26-187" aria-hidden="true" tabindex="-1"></a>|2| man_cit, an_city|</span>
<span id="cb26-188"><a href="#cb26-188" aria-hidden="true" tabindex="-1"></a>|3| man_ci, an_cit, n_city|</span>
<span id="cb26-189"><a href="#cb26-189" aria-hidden="true" tabindex="-1"></a>|4| man_c, an_ci, n_cit, _city|</span>
<span id="cb26-190"><a href="#cb26-190" aria-hidden="true" tabindex="-1"></a>|...|...|</span>
<span id="cb26-191"><a href="#cb26-191" aria-hidden="true" tabindex="-1"></a>|8|m,a,n,_,c,i,t,y|</span>
<span id="cb26-192"><a href="#cb26-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-193"><a href="#cb26-193" aria-hidden="true" tabindex="-1"></a>The gif below demonstrates the python script used to assist in matching team names from one list to another. Starting from the largest length of a team name, the program would look through the other list for any matching character combinations. </span>
<span id="cb26-194"><a href="#cb26-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-195"><a href="#cb26-195" aria-hidden="true" tabindex="-1"></a><span class="al">![](Header Image/name_compare.gif)</span></span>
<span id="cb26-196"><a href="#cb26-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-197"><a href="#cb26-197" aria-hidden="true" tabindex="-1"></a>What resulted is a list of potential matching teams, with the most similar name at the top. Then I would determine from the suggestion what was the correct matching team name was. From this a key was created to make the two data sets have a matching naming structure for home and away teams. The data sets were now able to be combined. The resulting data set had 79673 rows and 172 columns, where each row represented individual match. </span>
<span id="cb26-198"><a href="#cb26-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-199"><a href="#cb26-199" aria-hidden="true" tabindex="-1"></a>However, more processing was needed. Although the initial dataset collected data all the way to 2023, the data was filtered to only include 2010 to 2019. This filtering was due to the COVID-19 pandemic. During the pandemic, attendance basically ceased to occur for matches. Additionally, some leagues canceled the remaining matches for the season. </span>
<span id="cb26-200"><a href="#cb26-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-201"><a href="#cb26-201" aria-hidden="true" tabindex="-1"></a>Certain leagues were removed from the dataset. The Scottish Division 2 and Division 3 leagues, as well as the Ethniki Katigoria, which is the Greek top league, were removed. This is due to them having several missing values for many variables. Some matches from a variety of leagues had missing values only for the betting variables. These matches were used during the analysis of day &amp; time and the impact of the away team. However, they were dropped from the dataset for analysis of betting data and in the modeling. </span>
<span id="cb26-202"><a href="#cb26-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-203"><a href="#cb26-203" aria-hidden="true" tabindex="-1"></a>Lastly, a few new variables were added. The first variable added was the season during which the match occurred. Although leagues end on different dates in different years, the date selected for the seasons to change was July 14th. Most leagues conclude at the beginning of June and resume  at the beginning of August. July is predominantly used for international games. Although there were a couple of matches that occurred in July from 2010-2019, July 14th was the only date with zero matches played. So it was used as the cutoff point. </span>
<span id="cb26-204"><a href="#cb26-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-205"><a href="#cb26-205" aria-hidden="true" tabindex="-1"></a>The other variables created were the mean and standard deviation of the home team for that season and the z-score of that individual match. The mean and standard deviation were based upon the home team's attendance for that season. The z-score is the standardization of the match's attendance (number of standard deviations above or below the mean) in relation to the home team's average attendance for that particular season. </span>
<span id="cb26-206"><a href="#cb26-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-207"><a href="#cb26-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-208"><a href="#cb26-208" aria-hidden="true" tabindex="-1"></a><span class="fu">## Final Dataset</span></span>
<span id="cb26-209"><a href="#cb26-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-210"><a href="#cb26-210" aria-hidden="true" tabindex="-1"></a>The resulting dataset consisted of 53,224 rows and 29 columns. The descriptions of variables can be viewed in the <span class="co">[</span><span class="ot">data dictionary</span><span class="co">](https://matthewlwilcox.github.io/Capstone/doc/data_dictionary.html)</span>.</span>
<span id="cb26-211"><a href="#cb26-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-212"><a href="#cb26-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-213"><a href="#cb26-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-214"><a href="#cb26-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-217"><a href="#cb26-217" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb26-218"><a href="#cb26-218" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb26-219"><a href="#cb26-219" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Data Import"</span></span>
<span id="cb26-220"><a href="#cb26-220" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb26-221"><a href="#cb26-221" aria-hidden="true" tabindex="-1"></a>total_data <span class="op">=</span> total_data[[<span class="st">'home_team'</span>, <span class="st">'away_team'</span>,  <span class="st">'date'</span>, <span class="st">'time'</span>,</span>
<span id="cb26-222"><a href="#cb26-222" aria-hidden="true" tabindex="-1"></a>       <span class="st">'day_of_week'</span>, <span class="st">'raw_attendance'</span>, <span class="st">'division'</span>,  <span class="st">'FTR'</span>,</span>
<span id="cb26-223"><a href="#cb26-223" aria-hidden="true" tabindex="-1"></a>       <span class="st">'B365H'</span>, <span class="st">'B365D'</span>, <span class="st">'B365A'</span>, <span class="st">'BWH'</span>, <span class="st">'BWD'</span>, <span class="st">'BWA'</span>,</span>
<span id="cb26-224"><a href="#cb26-224" aria-hidden="true" tabindex="-1"></a>       <span class="st">'WHH'</span>, <span class="st">'WHD'</span>, <span class="st">'WHA'</span>, <span class="st">'VCH'</span>, <span class="st">'VCD'</span>, <span class="st">'VCA'</span>, <span class="st">'BbMx&gt;2.5'</span>, <span class="st">'BbAv&gt;2.5'</span>,</span>
<span id="cb26-225"><a href="#cb26-225" aria-hidden="true" tabindex="-1"></a>       <span class="st">'BbMx&lt;2.5'</span>, <span class="st">'BbAv&lt;2.5'</span>, <span class="st">'date_time'</span>, <span class="st">'season'</span>, <span class="st">'mean_attend'</span>,</span>
<span id="cb26-226"><a href="#cb26-226" aria-hidden="true" tabindex="-1"></a>       <span class="st">'std_attend'</span>, <span class="st">'standard_attend'</span>]]</span>
<span id="cb26-227"><a href="#cb26-227" aria-hidden="true" tabindex="-1"></a>total_data.head()</span>
<span id="cb26-228"><a href="#cb26-228" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-229"><a href="#cb26-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-230"><a href="#cb26-230" aria-hidden="true" tabindex="-1"></a><span class="fu"># Date &amp; Time</span></span>
<span id="cb26-231"><a href="#cb26-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-232"><a href="#cb26-232" aria-hidden="true" tabindex="-1"></a>Now that the data has been processed, we can begin to look at how a variety of factors impact attendance for football matches. The first factor that will be evaluated is the date and time of individual matches. We will examine the impact of the day of the week, time of the match, and the calendar date.</span>
<span id="cb26-233"><a href="#cb26-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-234"><a href="#cb26-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-237"><a href="#cb26-237" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb26-238"><a href="#cb26-238" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb26-239"><a href="#cb26-239" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Time Data Processing"</span></span>
<span id="cb26-240"><a href="#cb26-240" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb26-241"><a href="#cb26-241" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb26-242"><a href="#cb26-242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-243"><a href="#cb26-243" aria-hidden="true" tabindex="-1"></a>time_df <span class="op">=</span> total_data[[</span>
<span id="cb26-244"><a href="#cb26-244" aria-hidden="true" tabindex="-1"></a>    <span class="st">'date'</span>, <span class="st">'time'</span>, <span class="st">'day_of_week'</span>, <span class="st">'date_time'</span>, <span class="st">'raw_attendance'</span>, <span class="st">'standard_attend'</span>, <span class="st">'division'</span></span>
<span id="cb26-245"><a href="#cb26-245" aria-hidden="true" tabindex="-1"></a>]]</span>
<span id="cb26-246"><a href="#cb26-246" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-247"><a href="#cb26-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-248"><a href="#cb26-248" aria-hidden="true" tabindex="-1"></a><span class="fu">## Day of the Week</span></span>
<span id="cb26-251"><a href="#cb26-251" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb26-252"><a href="#cb26-252" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: Group Attendance by day of the week</span></span>
<span id="cb26-253"><a href="#cb26-253" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb26-254"><a href="#cb26-254" aria-hidden="true" tabindex="-1"></a><span class="co"># Grouping of the data</span></span>
<span id="cb26-255"><a href="#cb26-255" aria-hidden="true" tabindex="-1"></a>df_grouped_median <span class="op">=</span> time_df.groupby(<span class="st">'day_of_week'</span>)[<span class="st">'raw_attendance'</span>,  <span class="st">'standard_attend'</span>].median().reset_index()</span>
<span id="cb26-256"><a href="#cb26-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-257"><a href="#cb26-257" aria-hidden="true" tabindex="-1"></a><span class="co"># Making Day of the week categorical type to maintain order on graphs</span></span>
<span id="cb26-258"><a href="#cb26-258" aria-hidden="true" tabindex="-1"></a>day_categories <span class="op">=</span> [<span class="st">'Monday'</span>, <span class="st">'Tuesday'</span>, <span class="st">'Wednesday'</span>, <span class="st">'Thursday'</span>, <span class="st">'Friday'</span>, <span class="st">'Saturday'</span>, <span class="st">'Sunday'</span>]</span>
<span id="cb26-259"><a href="#cb26-259" aria-hidden="true" tabindex="-1"></a>df_grouped_median[<span class="st">'day_of_week'</span>] <span class="op">=</span> pd.Categorical(df_grouped_median[<span class="st">'day_of_week'</span>], categories<span class="op">=</span> day_categories)</span>
<span id="cb26-260"><a href="#cb26-260" aria-hidden="true" tabindex="-1"></a>df_grouped_median.sort_values(by <span class="op">=</span> <span class="st">'day_of_week'</span>, inplace <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb26-261"><a href="#cb26-261" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-262"><a href="#cb26-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-263"><a href="#cb26-263" aria-hidden="true" tabindex="-1"></a>Before we can make graphs and plots to analyze the attendance by day of the week, we need to group the data. For this we grouped the data by the day of the week (ex: Sunday, Monday, etc) and took the median attendance for each group. </span>
<span id="cb26-264"><a href="#cb26-264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-267"><a href="#cb26-267" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb26-268"><a href="#cb26-268" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-day_median_attend</span></span>
<span id="cb26-269"><a href="#cb26-269" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Median Attendance by Day of the Week"</span></span>
<span id="cb26-270"><a href="#cb26-270" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb26-271"><a href="#cb26-271" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Day of the Week Median Plot"</span></span>
<span id="cb26-272"><a href="#cb26-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-273"><a href="#cb26-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-274"><a href="#cb26-274" aria-hidden="true" tabindex="-1"></a>sns.barplot(</span>
<span id="cb26-275"><a href="#cb26-275" aria-hidden="true" tabindex="-1"></a>    data<span class="op">=</span>df_grouped_median, </span>
<span id="cb26-276"><a href="#cb26-276" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="st">'day_of_week'</span>, </span>
<span id="cb26-277"><a href="#cb26-277" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> <span class="st">'raw_attendance'</span>,</span>
<span id="cb26-278"><a href="#cb26-278" aria-hidden="true" tabindex="-1"></a>    color <span class="op">=</span> <span class="st">'#0047AB'</span></span>
<span id="cb26-279"><a href="#cb26-279" aria-hidden="true" tabindex="-1"></a>    ).<span class="bu">set</span>(title <span class="op">=</span><span class="st">'Median Attendance by Day of the Week'</span>)</span>
<span id="cb26-280"><a href="#cb26-280" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">90</span>)</span>
<span id="cb26-281"><a href="#cb26-281" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Day of the Week'</span>)</span>
<span id="cb26-282"><a href="#cb26-282" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Median Attendance'</span>)</span>
<span id="cb26-283"><a href="#cb26-283" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb26-284"><a href="#cb26-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-285"><a href="#cb26-285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-286"><a href="#cb26-286" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-287"><a href="#cb26-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-288"><a href="#cb26-288" aria-hidden="true" tabindex="-1"></a>First, in @fig-day_median_attend, the average attendance for matches is viewed by the day of the week. Wednesday and Sunday have the highest average attendance while Tuesday has the lowest. It is striking that Wednesday has the highest average attendance. Most would expect weekday matches to have lower attendance while games on weekends, especially Saturday, would have higher attendance. </span>
<span id="cb26-289"><a href="#cb26-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-290"><a href="#cb26-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-293"><a href="#cb26-293" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb26-294"><a href="#cb26-294" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb26-295"><a href="#cb26-295" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Day of the Week Total Count"</span></span>
<span id="cb26-296"><a href="#cb26-296" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-count_day</span></span>
<span id="cb26-297"><a href="#cb26-297" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Number of games per day of the week"</span></span>
<span id="cb26-298"><a href="#cb26-298" aria-hidden="true" tabindex="-1"></a>grouped_week_count <span class="op">=</span> time_df.groupby(<span class="st">'day_of_week'</span>).count().reset_index()</span>
<span id="cb26-299"><a href="#cb26-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-300"><a href="#cb26-300" aria-hidden="true" tabindex="-1"></a>grouped_week_count[<span class="st">'day_of_week'</span>] <span class="op">=</span> pd.Categorical(grouped_week_count[<span class="st">'day_of_week'</span>], categories<span class="op">=</span> day_categories)</span>
<span id="cb26-301"><a href="#cb26-301" aria-hidden="true" tabindex="-1"></a>grouped_week_count.sort_values(by <span class="op">=</span> <span class="st">'day_of_week'</span>, inplace <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb26-302"><a href="#cb26-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-303"><a href="#cb26-303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-304"><a href="#cb26-304" aria-hidden="true" tabindex="-1"></a>sns.barplot(data <span class="op">=</span> grouped_week_count, x <span class="op">=</span> <span class="st">'day_of_week'</span>, y <span class="op">=</span> <span class="st">'date'</span>,</span>
<span id="cb26-305"><a href="#cb26-305" aria-hidden="true" tabindex="-1"></a>    color <span class="op">=</span> <span class="st">'#0047AB'</span>)</span>
<span id="cb26-306"><a href="#cb26-306" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Day of the Week'</span>)</span>
<span id="cb26-307"><a href="#cb26-307" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Count'</span>)</span>
<span id="cb26-308"><a href="#cb26-308" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Number of Games per Day of the Week'</span>)</span>
<span id="cb26-309"><a href="#cb26-309" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb26-310"><a href="#cb26-310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-311"><a href="#cb26-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-312"><a href="#cb26-312" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-313"><a href="#cb26-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-314"><a href="#cb26-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-315"><a href="#cb26-315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-318"><a href="#cb26-318" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb26-319"><a href="#cb26-319" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-day_median_attend_div</span></span>
<span id="cb26-320"><a href="#cb26-320" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: Number of games per day of week divided by league</span></span>
<span id="cb26-321"><a href="#cb26-321" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Number of games per day of week divided by league"</span></span>
<span id="cb26-322"><a href="#cb26-322" aria-hidden="true" tabindex="-1"></a>grouped_week_count_division <span class="op">=</span>  time_df.groupby([<span class="st">'day_of_week'</span>, <span class="st">'division'</span>]).count().reset_index()</span>
<span id="cb26-323"><a href="#cb26-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-324"><a href="#cb26-324" aria-hidden="true" tabindex="-1"></a>grouped_week_count_division[<span class="st">'day_of_week'</span>] <span class="op">=</span> pd.Categorical(grouped_week_count_division[<span class="st">'day_of_week'</span>], categories<span class="op">=</span> day_categories)</span>
<span id="cb26-325"><a href="#cb26-325" aria-hidden="true" tabindex="-1"></a>grouped_week_count_division.sort_values(by <span class="op">=</span> <span class="st">'day_of_week'</span>, inplace <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb26-326"><a href="#cb26-326" aria-hidden="true" tabindex="-1"></a>grouped_week_count_division <span class="op">=</span> grouped_week_count_division[[<span class="st">'day_of_week'</span>, <span class="st">'division'</span>, <span class="st">'date'</span>]]</span>
<span id="cb26-327"><a href="#cb26-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-328"><a href="#cb26-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-329"><a href="#cb26-329" aria-hidden="true" tabindex="-1"></a>total_div_number <span class="op">=</span> grouped_week_count_division.groupby(<span class="st">'day_of_week'</span>).<span class="bu">sum</span>().reset_index()</span>
<span id="cb26-330"><a href="#cb26-330" aria-hidden="true" tabindex="-1"></a><span class="co"># print(total_div_number)</span></span>
<span id="cb26-331"><a href="#cb26-331" aria-hidden="true" tabindex="-1"></a>rose_df <span class="op">=</span> pd.merge(grouped_week_count_division, total_div_number, on<span class="op">=</span> <span class="st">'day_of_week'</span>)</span>
<span id="cb26-332"><a href="#cb26-332" aria-hidden="true" tabindex="-1"></a>rose_df[<span class="st">'pct'</span>] <span class="op">=</span> rose_df[<span class="st">'date_x'</span>]<span class="op">/</span>rose_df[<span class="st">'date_y'</span>]</span>
<span id="cb26-333"><a href="#cb26-333" aria-hidden="true" tabindex="-1"></a><span class="co"># print(rose_df)</span></span>
<span id="cb26-334"><a href="#cb26-334" aria-hidden="true" tabindex="-1"></a>rose_df[<span class="st">'League'</span>] <span class="op">=</span> rose_df[<span class="st">'division'</span>]</span>
<span id="cb26-335"><a href="#cb26-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-336"><a href="#cb26-336" aria-hidden="true" tabindex="-1"></a>div_dict2 <span class="op">=</span> {<span class="st">'D1'</span>:<span class="st">'Bundesliga (1st Div)'</span>, <span class="st">'D2'</span>: <span class="st">'2. Bundesliga (2nd Div)'</span>, <span class="st">'E0'</span>:<span class="st">'Premier League (1st Div)'</span>, <span class="st">'E1'</span>:<span class="st">'Championship (2nd Div)'</span>, </span>
<span id="cb26-337"><a href="#cb26-337" aria-hidden="true" tabindex="-1"></a>            <span class="st">'E2'</span>:<span class="st">'League 1 (3rd Div)'</span>, <span class="st">'E3'</span>:<span class="st">'League 2 (4th Div)'</span>,<span class="st">'SP1'</span>:<span class="st">'La Liga Primera (1st Div)'</span>, <span class="st">'SP2'</span>:<span class="st">'La Liga Segunda (2nd Div)'</span>,</span>
<span id="cb26-338"><a href="#cb26-338" aria-hidden="true" tabindex="-1"></a>              <span class="st">'B1'</span>:<span class="st">'Jupiler League (1st Div)'</span>, <span class="st">'F1'</span>:<span class="st">'Ligue 1 (1st Div)'</span>,<span class="st">'F2'</span>:<span class="st">'Ligue 2 (2nd Div)'</span>,<span class="st">'I1'</span>:<span class="st">'Serie A (1st Div)'</span>,<span class="st">'I2'</span>:<span class="st">'Serie B (2nd Div)'</span>, </span>
<span id="cb26-339"><a href="#cb26-339" aria-hidden="true" tabindex="-1"></a>              <span class="st">'SC0'</span>:<span class="st">'Scottish Premier League (1st Div)'</span>, <span class="st">'SC1'</span>:<span class="st">'Scottish Division 1 (2nd Div)'</span>, <span class="st">'T1'</span>:<span class="st">'Fubol Ligi 1 (1st Div)'</span>, <span class="st">'P1'</span>: <span class="st">'Liga 1 (1st Div)'</span>}</span>
<span id="cb26-340"><a href="#cb26-340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-341"><a href="#cb26-341" aria-hidden="true" tabindex="-1"></a>rose_df <span class="op">=</span> rose_df.replace({<span class="st">'League'</span>:div_dict2})</span>
<span id="cb26-342"><a href="#cb26-342" aria-hidden="true" tabindex="-1"></a>rose_df</span>
<span id="cb26-343"><a href="#cb26-343" aria-hidden="true" tabindex="-1"></a>colors <span class="op">=</span> px.colors.qualitative.Light24 <span class="op">+</span> px.colors.qualitative.Alphabet </span>
<span id="cb26-344"><a href="#cb26-344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-345"><a href="#cb26-345" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> px.bar_polar(rose_df, theta <span class="op">=</span> <span class="st">'day_of_week'</span>, r <span class="op">=</span> <span class="st">'pct'</span>, color <span class="op">=</span> <span class="st">'League'</span>, color_discrete_sequence<span class="op">=</span> colors)</span>
<span id="cb26-346"><a href="#cb26-346" aria-hidden="true" tabindex="-1"></a>fig.show()</span>
<span id="cb26-347"><a href="#cb26-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-348"><a href="#cb26-348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-349"><a href="#cb26-349" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-350"><a href="#cb26-350" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb26-351"><a href="#cb26-351" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb26-352"><a href="#cb26-352" aria-hidden="true" tabindex="-1"></a> @fig-count_day explains the suprising results that Wednesday had the highest average attendance instead of Saturday. Saturday had by far the highest number of games in comparison to any day of the week while Wednesday had significantly fewer games. This results in Saturday having more games from lower leagues, which tend to have lower attendance, decreasing the average attendance, while Wedneday had more games played by top leagues increasing its average attendance. This is confirmed in @fig-day_median_attend_div. Looking at the proportion of games on Saturday, lower leagues had a much higher proportion of games. Wednesday's games on the other hand were  predominantly composed of the top leagues in England, France, and Italy. The top leagues tend to have more highly attended games; hence Wednesday has the highest average attendance. </span>
<span id="cb26-353"><a href="#cb26-353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-354"><a href="#cb26-354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-355"><a href="#cb26-355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-356"><a href="#cb26-356" aria-hidden="true" tabindex="-1"></a><span class="fu">## Time of Day</span></span>
<span id="cb26-357"><a href="#cb26-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-358"><a href="#cb26-358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-361"><a href="#cb26-361" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb26-362"><a href="#cb26-362" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb26-363"><a href="#cb26-363" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Grouping Attendance by Time of Day"</span></span>
<span id="cb26-364"><a href="#cb26-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-365"><a href="#cb26-365" aria-hidden="true" tabindex="-1"></a>df_grouped_median_tod<span class="op">=</span> time_df.groupby(time_df[<span class="st">'date_time'</span>].dt.hour).median()</span>
<span id="cb26-366"><a href="#cb26-366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-367"><a href="#cb26-367" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-368"><a href="#cb26-368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-369"><a href="#cb26-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-370"><a href="#cb26-370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-373"><a href="#cb26-373" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb26-374"><a href="#cb26-374" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb26-375"><a href="#cb26-375" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Plot Number of games by time of day"</span></span>
<span id="cb26-376"><a href="#cb26-376" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-attendance_time</span></span>
<span id="cb26-377"><a href="#cb26-377" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: 'Attendance and Match Count by Time of Day'</span></span>
<span id="cb26-378"><a href="#cb26-378" aria-hidden="true" tabindex="-1"></a>df_grouped_count <span class="op">=</span> time_df.groupby(time_df[<span class="st">'date_time'</span>].dt.hour).count()</span>
<span id="cb26-379"><a href="#cb26-379" aria-hidden="true" tabindex="-1"></a><span class="co"># print(df_grouped_count)</span></span>
<span id="cb26-380"><a href="#cb26-380" aria-hidden="true" tabindex="-1"></a>df_grouped_count <span class="op">=</span> df_grouped_count[<span class="st">'raw_attendance'</span>].reset_index()</span>
<span id="cb26-381"><a href="#cb26-381" aria-hidden="true" tabindex="-1"></a>df_grouped_count[<span class="st">'count'</span>] <span class="op">=</span> df_grouped_count[<span class="st">'raw_attendance'</span>]</span>
<span id="cb26-382"><a href="#cb26-382" aria-hidden="true" tabindex="-1"></a>df_grouped_count <span class="op">=</span> df_grouped_count[[<span class="st">'date_time'</span>, <span class="st">'count'</span>]]</span>
<span id="cb26-383"><a href="#cb26-383" aria-hidden="true" tabindex="-1"></a><span class="co"># df_grouped_count= df_grouped_count.rename(columns = {'date':'count'})</span></span>
<span id="cb26-384"><a href="#cb26-384" aria-hidden="true" tabindex="-1"></a><span class="co"># print(df_grouped_count)</span></span>
<span id="cb26-385"><a href="#cb26-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-386"><a href="#cb26-386" aria-hidden="true" tabindex="-1"></a>df_count_atted <span class="op">=</span> pd.merge(</span>
<span id="cb26-387"><a href="#cb26-387" aria-hidden="true" tabindex="-1"></a>    df_grouped_count,df_grouped_median_tod, on <span class="op">=</span> <span class="st">'date_time'</span>)</span>
<span id="cb26-388"><a href="#cb26-388" aria-hidden="true" tabindex="-1"></a><span class="co"># df_count_atted = df_count_atted.drop(columns= ['capacity_filled'])</span></span>
<span id="cb26-389"><a href="#cb26-389" aria-hidden="true" tabindex="-1"></a>df_count_atted.rename(</span>
<span id="cb26-390"><a href="#cb26-390" aria-hidden="true" tabindex="-1"></a>    columns <span class="op">=</span> {<span class="st">'raw_attendance'</span>: <span class="st">'Attendance'</span>, <span class="st">'count'</span>: <span class="st">"Number of Games"</span>}, </span>
<span id="cb26-391"><a href="#cb26-391" aria-hidden="true" tabindex="-1"></a>    inplace<span class="op">=</span> <span class="va">True</span></span>
<span id="cb26-392"><a href="#cb26-392" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb26-393"><a href="#cb26-393" aria-hidden="true" tabindex="-1"></a><span class="co"># print(df_count_atted)</span></span>
<span id="cb26-394"><a href="#cb26-394" aria-hidden="true" tabindex="-1"></a>melted_count_attend <span class="op">=</span> pd.melt(</span>
<span id="cb26-395"><a href="#cb26-395" aria-hidden="true" tabindex="-1"></a>    df_count_atted, value_vars<span class="op">=</span>[<span class="st">'Number of Games'</span>, <span class="st">'Attendance'</span>],</span>
<span id="cb26-396"><a href="#cb26-396" aria-hidden="true" tabindex="-1"></a>     id_vars<span class="op">=</span> <span class="st">'date_time'</span>)</span>
<span id="cb26-397"><a href="#cb26-397" aria-hidden="true" tabindex="-1"></a><span class="co"># print(melted_count_attend)</span></span>
<span id="cb26-398"><a href="#cb26-398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-399"><a href="#cb26-399" aria-hidden="true" tabindex="-1"></a>sns.lineplot(</span>
<span id="cb26-400"><a href="#cb26-400" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> melted_count_attend, x <span class="op">=</span> <span class="st">'date_time'</span>, y <span class="op">=</span> <span class="st">'value'</span>, hue <span class="op">=</span> <span class="st">'variable'</span>)</span>
<span id="cb26-401"><a href="#cb26-401" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Average Attendance and Total Game Count by Time of Day'</span>)</span>
<span id="cb26-402"><a href="#cb26-402" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Hour of the Day'</span>)</span>
<span id="cb26-403"><a href="#cb26-403" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Average Attendance/Number of Games'</span>)</span>
<span id="cb26-404"><a href="#cb26-404" aria-hidden="true" tabindex="-1"></a>plt.legend().set_title(<span class="st">''</span>)</span>
<span id="cb26-405"><a href="#cb26-405" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb26-406"><a href="#cb26-406" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-407"><a href="#cb26-407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-408"><a href="#cb26-408" aria-hidden="true" tabindex="-1"></a>The time and day of a match resulted in a similar situation as the day of the week. In @fig-attendance_time, there were dips in attendance at 3 pm and 9 pm; however, these were also the most attended times for matches. 12 pm and 11 pm matches had the highest attendance on average however had a lower amount of games. So similarly with day of the week, the more matches that occured, the average attendance is skewed lower, while when less matches occur, the average attendance is skewed higher. </span>
<span id="cb26-409"><a href="#cb26-409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-410"><a href="#cb26-410" aria-hidden="true" tabindex="-1"></a><span class="fu">## Calendar Date</span></span>
<span id="cb26-411"><a href="#cb26-411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-414"><a href="#cb26-414" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb26-415"><a href="#cb26-415" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: Set up Data for Calendar Plots</span></span>
<span id="cb26-416"><a href="#cb26-416" aria-hidden="true" tabindex="-1"></a>calendar_plot_data <span class="op">=</span> total_data</span>
<span id="cb26-417"><a href="#cb26-417" aria-hidden="true" tabindex="-1"></a>calendar_plot_data[<span class="st">'month_day'</span>] <span class="op">=</span> calendar_plot_data[<span class="st">'date_time'</span>].dt.strftime(<span class="st">'%m-</span><span class="sc">%d</span><span class="st">'</span>)</span>
<span id="cb26-418"><a href="#cb26-418" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-419"><a href="#cb26-419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-420"><a href="#cb26-420" aria-hidden="true" tabindex="-1"></a>The last aspect of the day &amp; time factor is the calendar date of a match. This is evaluated using the calendar plots below.</span>
<span id="cb26-421"><a href="#cb26-421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-422"><a href="#cb26-422" aria-hidden="true" tabindex="-1"></a><span class="fu">### Trends in Quantity of Matches</span></span>
<span id="cb26-423"><a href="#cb26-423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-426"><a href="#cb26-426" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb26-427"><a href="#cb26-427" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-cal_count</span></span>
<span id="cb26-428"><a href="#cb26-428" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Calendar Plot of total Number of Matches</span></span>
<span id="cb26-429"><a href="#cb26-429" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb26-430"><a href="#cb26-430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-431"><a href="#cb26-431" aria-hidden="true" tabindex="-1"></a>date_of_year <span class="op">=</span> calendar_plot_data.groupby(<span class="st">'month_day'</span>).count()</span>
<span id="cb26-432"><a href="#cb26-432" aria-hidden="true" tabindex="-1"></a>date_of_year[<span class="st">'count'</span>] <span class="op">=</span> date_of_year[<span class="st">'standard_attend'</span>]</span>
<span id="cb26-433"><a href="#cb26-433" aria-hidden="true" tabindex="-1"></a>date_of_year <span class="op">=</span> date_of_year[<span class="st">'count'</span>].sort_values().reset_index()</span>
<span id="cb26-434"><a href="#cb26-434" aria-hidden="true" tabindex="-1"></a><span class="co"># print(date_of_year)</span></span>
<span id="cb26-435"><a href="#cb26-435" aria-hidden="true" tabindex="-1"></a>date_of_year[<span class="st">'total_date'</span>] <span class="op">=</span> <span class="st">'2024-'</span> <span class="op">+</span> date_of_year[<span class="st">'month_day'</span>]</span>
<span id="cb26-436"><a href="#cb26-436" aria-hidden="true" tabindex="-1"></a>date_of_year[<span class="st">'total_date'</span>]<span class="op">=</span> pd.to_datetime(date_of_year[<span class="st">'total_date'</span>], <span class="bu">format</span> <span class="op">=</span> <span class="st">"%Y-%m-</span><span class="sc">%d</span><span class="st">"</span>)</span>
<span id="cb26-437"><a href="#cb26-437" aria-hidden="true" tabindex="-1"></a>events <span class="op">=</span> pd.Series(date_of_year[<span class="st">'count'</span>].values.tolist(), index <span class="op">=</span> date_of_year[<span class="st">'total_date'</span>].values.tolist())</span>
<span id="cb26-438"><a href="#cb26-438" aria-hidden="true" tabindex="-1"></a>july.heatmap(</span>
<span id="cb26-439"><a href="#cb26-439" aria-hidden="true" tabindex="-1"></a>    dates <span class="op">=</span> date_of_year[<span class="st">'total_date'</span>],</span>
<span id="cb26-440"><a href="#cb26-440" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> date_of_year[<span class="st">'count'</span>], </span>
<span id="cb26-441"><a href="#cb26-441" aria-hidden="true" tabindex="-1"></a>    date_label <span class="op">=</span> <span class="va">True</span>, cmap <span class="op">=</span> <span class="st">'RdYlBu_r'</span>, </span>
<span id="cb26-442"><a href="#cb26-442" aria-hidden="true" tabindex="-1"></a>    fontsize <span class="op">=</span><span class="dv">10</span>, </span>
<span id="cb26-443"><a href="#cb26-443" aria-hidden="true" tabindex="-1"></a>    weekday_label<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb26-444"><a href="#cb26-444" aria-hidden="true" tabindex="-1"></a>    year_label<span class="op">=</span> <span class="va">False</span>,</span>
<span id="cb26-445"><a href="#cb26-445" aria-hidden="true" tabindex="-1"></a>     title <span class="op">=</span> <span class="st">'Number of Games per day 2010-2019'</span>,</span>
<span id="cb26-446"><a href="#cb26-446" aria-hidden="true" tabindex="-1"></a>             month_grid<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb26-447"><a href="#cb26-447" aria-hidden="true" tabindex="-1"></a>    colorbar<span class="op">=</span> <span class="va">True</span>, dpi <span class="op">=</span><span class="dv">1200</span>)</span>
<span id="cb26-448"><a href="#cb26-448" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb26-449"><a href="#cb26-449" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-450"><a href="#cb26-450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-451"><a href="#cb26-451" aria-hidden="true" tabindex="-1"></a>Before looking at the attendance, it's important to view trends in when matches actually occur. In @fig-cal_count, there are very few games played from mid-June to the end of July. This is most likely attributed to European leagues predominantly being on break during these months due to FIFA international breaks. During this break, players typically return to their national teams to play in international competitions and, every four years, the World Cup. Another significant period of time is the Christmas holiday. Christmas has one of the lowest total number of games occurring. However, December 26th, or Boxing Day, had the highest number of games played out of any date. </span>
<span id="cb26-452"><a href="#cb26-452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-453"><a href="#cb26-453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-454"><a href="#cb26-454" aria-hidden="true" tabindex="-1"></a><span class="fu">### Trends in Attendance of Matches</span></span>
<span id="cb26-455"><a href="#cb26-455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-458"><a href="#cb26-458" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb26-459"><a href="#cb26-459" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-cal_attend</span></span>
<span id="cb26-460"><a href="#cb26-460" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Calendar Plot of Attendance</span></span>
<span id="cb26-461"><a href="#cb26-461" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb26-462"><a href="#cb26-462" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-463"><a href="#cb26-463" aria-hidden="true" tabindex="-1"></a>attend_date <span class="op">=</span> calendar_plot_data.groupby(<span class="st">'month_day'</span>).mean()</span>
<span id="cb26-464"><a href="#cb26-464" aria-hidden="true" tabindex="-1"></a>attend_date[<span class="st">'count'</span>] <span class="op">=</span> attend_date[<span class="st">'standard_attend'</span>]</span>
<span id="cb26-465"><a href="#cb26-465" aria-hidden="true" tabindex="-1"></a>attend_date <span class="op">=</span> attend_date[<span class="st">'count'</span>].sort_values().reset_index()</span>
<span id="cb26-466"><a href="#cb26-466" aria-hidden="true" tabindex="-1"></a>attend_date[<span class="st">'total_date'</span>] <span class="op">=</span> <span class="st">'2024-'</span> <span class="op">+</span> attend_date[<span class="st">'month_day'</span>]</span>
<span id="cb26-467"><a href="#cb26-467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-468"><a href="#cb26-468" aria-hidden="true" tabindex="-1"></a>attend_date[<span class="st">'total_date'</span>] <span class="op">=</span> pd.to_datetime(</span>
<span id="cb26-469"><a href="#cb26-469" aria-hidden="true" tabindex="-1"></a>    attend_date[<span class="st">'total_date'</span>], <span class="bu">format</span> <span class="op">=</span> <span class="st">"%Y-%m-</span><span class="sc">%d</span><span class="st">"</span>)</span>
<span id="cb26-470"><a href="#cb26-470" aria-hidden="true" tabindex="-1"></a>events <span class="op">=</span> pd.Series(</span>
<span id="cb26-471"><a href="#cb26-471" aria-hidden="true" tabindex="-1"></a>    attend_date[<span class="st">'count'</span>].values.tolist(),</span>
<span id="cb26-472"><a href="#cb26-472" aria-hidden="true" tabindex="-1"></a>     index <span class="op">=</span> attend_date[<span class="st">'total_date'</span>].values.tolist())</span>
<span id="cb26-473"><a href="#cb26-473" aria-hidden="true" tabindex="-1"></a>july.heatmap(</span>
<span id="cb26-474"><a href="#cb26-474" aria-hidden="true" tabindex="-1"></a>    dates <span class="op">=</span> attend_date[<span class="st">'total_date'</span>],</span>
<span id="cb26-475"><a href="#cb26-475" aria-hidden="true" tabindex="-1"></a>     data <span class="op">=</span> attend_date[<span class="st">'count'</span>],</span>
<span id="cb26-476"><a href="#cb26-476" aria-hidden="true" tabindex="-1"></a>    cmap<span class="op">=</span><span class="st">'RdYlBu_r'</span>, date_label <span class="op">=</span> <span class="va">True</span>,</span>
<span id="cb26-477"><a href="#cb26-477" aria-hidden="true" tabindex="-1"></a>    fontsize <span class="op">=</span><span class="dv">10</span>, weekday_label<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb26-478"><a href="#cb26-478" aria-hidden="true" tabindex="-1"></a>    year_label<span class="op">=</span> <span class="va">False</span>,</span>
<span id="cb26-479"><a href="#cb26-479" aria-hidden="true" tabindex="-1"></a>    title <span class="op">=</span> <span class="st">'Average Attendance per Day Standardized 2010-2019'</span>,</span>
<span id="cb26-480"><a href="#cb26-480" aria-hidden="true" tabindex="-1"></a>             month_grid<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb26-481"><a href="#cb26-481" aria-hidden="true" tabindex="-1"></a>    colorbar<span class="op">=</span> <span class="va">True</span>, dpi <span class="op">=</span><span class="dv">1200</span>)</span>
<span id="cb26-482"><a href="#cb26-482" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb26-483"><a href="#cb26-483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-484"><a href="#cb26-484" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-485"><a href="#cb26-485" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-486"><a href="#cb26-486" aria-hidden="true" tabindex="-1"></a>Now looking at the attendance for these matches based on their calendar date, some trends appear. First, there is a grouping of higher-than-average attended matches in May. This can most likely be attributed to European seasons ending. In turn, these matches have a higher weight to fans due to teams vying for promotion (moving up a league), attempting to prevent relegation (moving down a league), and earning placement into European competitions such as UEFA Champions league and the Europa League. Additionally, with holidays there is an effect on attendance. First, November 6th, which is All Saint's Day, saw a decrease in attendance. Christmas had lower attendance, while Boxing Day to New Year's Eve had greater attendance than what is seen in the rest of December and January. </span>
<span id="cb26-487"><a href="#cb26-487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-488"><a href="#cb26-488" aria-hidden="true" tabindex="-1"></a><span class="fu"># Away Team Impact</span></span>
<span id="cb26-489"><a href="#cb26-489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-492"><a href="#cb26-492" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb26-493"><a href="#cb26-493" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb26-494"><a href="#cb26-494" aria-hidden="true" tabindex="-1"></a>away_team_impact <span class="op">=</span> total_data.groupby([<span class="st">'away_team'</span>, <span class="st">'division'</span>])[<span class="st">'standard_attend'</span>].mean().reset_index()</span>
<span id="cb26-495"><a href="#cb26-495" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-496"><a href="#cb26-496" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-497"><a href="#cb26-497" aria-hidden="true" tabindex="-1"></a>The next factor viewed is the impact of the away team on attendance. We are looking at how who the away team is impacts the attendance for the home team. For this, the standardized attendance was grouped by the away teams and then averaged. The results can be seen below. You can select what leagues you would like to view and the top number of teams from that league. </span>
<span id="cb26-498"><a href="#cb26-498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-501"><a href="#cb26-501" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb26-502"><a href="#cb26-502" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb26-503"><a href="#cb26-503" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb26-504"><a href="#cb26-504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-505"><a href="#cb26-505" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-506"><a href="#cb26-506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-507"><a href="#cb26-507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-508"><a href="#cb26-508" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-509"><a href="#cb26-509" aria-hidden="true" tabindex="-1"></a><span class="co"># away_team_impact = away_team_impact[away_team_impact['division'].isin(['E3', 'E1', 'E2'])]</span></span>
<span id="cb26-510"><a href="#cb26-510" aria-hidden="true" tabindex="-1"></a>div_dict <span class="op">=</span> {<span class="st">'D1'</span>:<span class="st">'Bundesliga'</span>, <span class="st">'D2'</span>: <span class="st">'2. Bundesliga'</span>, <span class="st">'E0'</span>:<span class="st">'Premier League'</span>, <span class="st">'E1'</span>:<span class="st">'Championship'</span>, </span>
<span id="cb26-511"><a href="#cb26-511" aria-hidden="true" tabindex="-1"></a>            <span class="st">'E2'</span>:<span class="st">'League 1'</span>, <span class="st">'E3'</span>:<span class="st">'League 2'</span>,<span class="st">'SP1'</span>:<span class="st">'La Liga Primera'</span>, <span class="st">'SP2'</span>:<span class="st">'La Liga Segunda'</span>,</span>
<span id="cb26-512"><a href="#cb26-512" aria-hidden="true" tabindex="-1"></a>              <span class="st">'B1'</span>:<span class="st">'Jupiler League'</span>, <span class="st">'F1'</span>:<span class="st">'Ligue 1'</span>,<span class="st">'F2'</span>:<span class="st">'Ligue 2'</span>,<span class="st">'I1'</span>:<span class="st">'Serie A'</span>,<span class="st">'I2'</span>:<span class="st">'Serie B'</span>, </span>
<span id="cb26-513"><a href="#cb26-513" aria-hidden="true" tabindex="-1"></a>              <span class="st">'SC0'</span>:<span class="st">'Scottish Premier League'</span>, <span class="st">'SC1'</span>:<span class="st">'Scottish Division 1'</span>, <span class="st">'T1'</span>:<span class="st">'Fubol Ligi 1'</span>, <span class="st">'P1'</span>: <span class="st">'Liga 1'</span>}</span>
<span id="cb26-514"><a href="#cb26-514" aria-hidden="true" tabindex="-1"></a>divisions_list <span class="op">=</span>[</span>
<span id="cb26-515"><a href="#cb26-515" aria-hidden="true" tabindex="-1"></a>    <span class="st">'D1'</span>, <span class="st">'D2'</span>, <span class="st">'E0'</span>, <span class="st">'E1'</span>, <span class="st">'E2'</span>, <span class="st">'E3'</span>, <span class="st">'SP1'</span> ,<span class="st">'SP2'</span>, <span class="st">'B1'</span>, <span class="st">'F1'</span>, <span class="st">'F2'</span>, <span class="st">'I1'</span>,</span>
<span id="cb26-516"><a href="#cb26-516" aria-hidden="true" tabindex="-1"></a>     <span class="st">'I2'</span>, <span class="st">'SC0'</span>, <span class="st">'SC1'</span>, <span class="st">'T1'</span>, <span class="st">'P1'</span></span>
<span id="cb26-517"><a href="#cb26-517" aria-hidden="true" tabindex="-1"></a>     ]</span>
<span id="cb26-518"><a href="#cb26-518" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-519"><a href="#cb26-519" aria-hidden="true" tabindex="-1"></a>away_team_impact <span class="op">=</span> away_team_impact[[<span class="st">'away_team'</span>, <span class="st">'division'</span>, <span class="st">'standard_attend'</span>]]</span>
<span id="cb26-520"><a href="#cb26-520" aria-hidden="true" tabindex="-1"></a><span class="co"># print(away_team_impact)</span></span>
<span id="cb26-521"><a href="#cb26-521" aria-hidden="true" tabindex="-1"></a>initial_graph_df <span class="op">=</span> pd.DataFrame(</span>
<span id="cb26-522"><a href="#cb26-522" aria-hidden="true" tabindex="-1"></a>    columns <span class="op">=</span> [<span class="st">'away_team'</span>, <span class="st">'division'</span>, <span class="st">'standard_attend'</span>])</span>
<span id="cb26-523"><a href="#cb26-523" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-524"><a href="#cb26-524" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> divisions_list:</span>
<span id="cb26-525"><a href="#cb26-525" aria-hidden="true" tabindex="-1"></a>    temp_impact_df <span class="op">=</span> away_team_impact[away_team_impact[<span class="st">'division'</span>] <span class="op">==</span> i].sort_values(<span class="st">'standard_attend'</span>,ascending <span class="op">=</span> <span class="va">False</span>).head(<span class="dv">3</span>)</span>
<span id="cb26-526"><a href="#cb26-526" aria-hidden="true" tabindex="-1"></a>    initial_graph_df <span class="op">=</span> pd.concat([initial_graph_df, temp_impact_df], axis <span class="op">=</span> <span class="dv">0</span>)</span>
<span id="cb26-527"><a href="#cb26-527" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-528"><a href="#cb26-528" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-529"><a href="#cb26-529" aria-hidden="true" tabindex="-1"></a><span class="co"># fig = go.Figure(px.bar(away_team_impact, y= 'away_team', x = 'standard_attend', color = 'division'))</span></span>
<span id="cb26-530"><a href="#cb26-530" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-531"><a href="#cb26-531" aria-hidden="true" tabindex="-1"></a>app <span class="op">=</span> JupyterDash(<span class="va">__name__</span>)</span>
<span id="cb26-532"><a href="#cb26-532" aria-hidden="true" tabindex="-1"></a>app.layout <span class="op">=</span> html.Div(<span class="bu">id</span> <span class="op">=</span> <span class="st">'parent'</span>, children <span class="op">=</span> [</span>
<span id="cb26-533"><a href="#cb26-533" aria-hidden="true" tabindex="-1"></a>    html.H1(<span class="bu">id</span> <span class="op">=</span> <span class="st">'H1'</span>, children <span class="op">=</span> <span class="st">'Away Team Impact'</span>),</span>
<span id="cb26-534"><a href="#cb26-534" aria-hidden="true" tabindex="-1"></a>    dcc.Slider(<span class="dv">0</span>,<span class="dv">20</span>,<span class="dv">1</span>, value <span class="op">=</span><span class="dv">3</span>,<span class="bu">id</span> <span class="op">=</span> <span class="st">'slider'</span>),</span>
<span id="cb26-535"><a href="#cb26-535" aria-hidden="true" tabindex="-1"></a>    dcc.Dropdown(<span class="bu">id</span> <span class="op">=</span> <span class="st">'dropdown'</span>, </span>
<span id="cb26-536"><a href="#cb26-536" aria-hidden="true" tabindex="-1"></a>                 options <span class="op">=</span> [</span>
<span id="cb26-537"><a href="#cb26-537" aria-hidden="true" tabindex="-1"></a>                {<span class="st">'label'</span>: <span class="st">'Bundesliga'</span>, <span class="st">'value'</span>:<span class="st">'D1'</span>},</span>
<span id="cb26-538"><a href="#cb26-538" aria-hidden="true" tabindex="-1"></a>                {<span class="st">'label'</span>: <span class="st">'2. Bundesliga'</span>, <span class="st">'value'</span>:<span class="st">'D2'</span>},</span>
<span id="cb26-539"><a href="#cb26-539" aria-hidden="true" tabindex="-1"></a>                {<span class="st">'label'</span>: <span class="st">'Premier League'</span>, <span class="st">'value'</span>:<span class="st">'E0'</span>},</span>
<span id="cb26-540"><a href="#cb26-540" aria-hidden="true" tabindex="-1"></a>                {<span class="st">'label'</span>: <span class="st">'Championship'</span>, <span class="st">'value'</span>:<span class="st">'E1'</span>},</span>
<span id="cb26-541"><a href="#cb26-541" aria-hidden="true" tabindex="-1"></a>                {<span class="st">'label'</span>: <span class="st">'League 1'</span>, <span class="st">'value'</span>:<span class="st">'E2'</span>},</span>
<span id="cb26-542"><a href="#cb26-542" aria-hidden="true" tabindex="-1"></a>                {<span class="st">'label'</span>: <span class="st">'League 2'</span>, <span class="st">'value'</span>:<span class="st">'E3'</span>},</span>
<span id="cb26-543"><a href="#cb26-543" aria-hidden="true" tabindex="-1"></a>                {<span class="st">'label'</span>: <span class="st">'La Liga Primera'</span>, <span class="st">'value'</span>:<span class="st">'SP1'</span>},</span>
<span id="cb26-544"><a href="#cb26-544" aria-hidden="true" tabindex="-1"></a>                {<span class="st">'label'</span>: <span class="st">'La Liga Segunda'</span>, <span class="st">'value'</span>:<span class="st">'SP2'</span>},</span>
<span id="cb26-545"><a href="#cb26-545" aria-hidden="true" tabindex="-1"></a>                {<span class="st">'label'</span>: <span class="st">'Jupiler League'</span>, <span class="st">'value'</span>:<span class="st">'B1'</span>},</span>
<span id="cb26-546"><a href="#cb26-546" aria-hidden="true" tabindex="-1"></a>                {<span class="st">'label'</span>: <span class="st">'Ligue 1'</span>, <span class="st">'value'</span>:<span class="st">'F1'</span>},</span>
<span id="cb26-547"><a href="#cb26-547" aria-hidden="true" tabindex="-1"></a>                {<span class="st">'label'</span>: <span class="st">'Ligue 2'</span>, <span class="st">'value'</span>:<span class="st">'F2'</span>},</span>
<span id="cb26-548"><a href="#cb26-548" aria-hidden="true" tabindex="-1"></a>                {<span class="st">'label'</span>: <span class="st">'Serie A'</span>, <span class="st">'value'</span>:<span class="st">'I1'</span>},</span>
<span id="cb26-549"><a href="#cb26-549" aria-hidden="true" tabindex="-1"></a>                {<span class="st">'label'</span>: <span class="st">'Serie B'</span>, <span class="st">'value'</span>:<span class="st">'I2'</span>},</span>
<span id="cb26-550"><a href="#cb26-550" aria-hidden="true" tabindex="-1"></a>                {<span class="st">'label'</span>: <span class="st">'Scotish Premier League'</span>, <span class="st">'value'</span>:<span class="st">'SC0'</span>},</span>
<span id="cb26-551"><a href="#cb26-551" aria-hidden="true" tabindex="-1"></a>                {<span class="st">'label'</span>: <span class="st">'Scotish Division 1'</span>, <span class="st">'value'</span>:<span class="st">'SC1'</span>},</span>
<span id="cb26-552"><a href="#cb26-552" aria-hidden="true" tabindex="-1"></a>                {<span class="st">'label'</span>: <span class="st">'Fubol Ligi 1'</span>, <span class="st">'value'</span>:<span class="st">'T1'</span>},</span>
<span id="cb26-553"><a href="#cb26-553" aria-hidden="true" tabindex="-1"></a>                {<span class="st">'label'</span>: <span class="st">'Liga 1'</span>, <span class="st">'value'</span>:<span class="st">'P1'</span>}</span>
<span id="cb26-554"><a href="#cb26-554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-555"><a href="#cb26-555" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-556"><a href="#cb26-556" aria-hidden="true" tabindex="-1"></a>                 ], value <span class="op">=</span> [<span class="st">'D1'</span>, <span class="st">'D2'</span>, <span class="st">'E0'</span>, <span class="st">'E1'</span>, <span class="st">'E2'</span>, <span class="st">'E3'</span>, <span class="st">'SP1'</span> ,<span class="st">'SP2'</span>, <span class="st">'B1'</span>, <span class="st">'F1'</span>, <span class="st">'F2'</span>, <span class="st">'I1'</span>, <span class="st">'I2'</span>, <span class="st">'SC0'</span>, <span class="st">'SC1'</span>, <span class="st">'T1'</span>, <span class="st">'P1'</span>],</span>
<span id="cb26-557"><a href="#cb26-557" aria-hidden="true" tabindex="-1"></a>                 multi <span class="op">=</span> <span class="va">True</span>),</span>
<span id="cb26-558"><a href="#cb26-558" aria-hidden="true" tabindex="-1"></a>    dcc.Graph(<span class="bu">id</span> <span class="op">=</span> <span class="st">'bar_plot'</span>, figure<span class="op">=</span>px.bar(</span>
<span id="cb26-559"><a href="#cb26-559" aria-hidden="true" tabindex="-1"></a>        initial_graph_df.replace({<span class="st">'division'</span>:div_dict}),</span>
<span id="cb26-560"><a href="#cb26-560" aria-hidden="true" tabindex="-1"></a>         x<span class="op">=</span><span class="st">'away_team'</span>, y<span class="op">=</span><span class="st">'standard_attend'</span>, color<span class="op">=</span><span class="st">'division'</span>))</span>
<span id="cb26-561"><a href="#cb26-561" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb26-562"><a href="#cb26-562" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-563"><a href="#cb26-563" aria-hidden="true" tabindex="-1"></a><span class="at">@app.callback</span>(</span>
<span id="cb26-564"><a href="#cb26-564" aria-hidden="true" tabindex="-1"></a>    Output(<span class="st">"bar_plot"</span>, <span class="st">"figure"</span>), </span>
<span id="cb26-565"><a href="#cb26-565" aria-hidden="true" tabindex="-1"></a>    [Input(<span class="st">"dropdown"</span>, <span class="st">"value"</span>),</span>
<span id="cb26-566"><a href="#cb26-566" aria-hidden="true" tabindex="-1"></a>     Input(<span class="st">'slider'</span>, <span class="st">'value'</span>)]</span>
<span id="cb26-567"><a href="#cb26-567" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb26-568"><a href="#cb26-568" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> update_graph(drop_value, slider_value):</span>
<span id="cb26-569"><a href="#cb26-569" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(value)</span></span>
<span id="cb26-570"><a href="#cb26-570" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> away_team_impact</span>
<span id="cb26-571"><a href="#cb26-571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-572"><a href="#cb26-572" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb26-573"><a href="#cb26-573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-574"><a href="#cb26-574" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df[df[<span class="st">'division'</span>].isin(<span class="bu">list</span>(drop_value))]</span>
<span id="cb26-575"><a href="#cb26-575" aria-hidden="true" tabindex="-1"></a>    graph_df <span class="op">=</span> pd.DataFrame(columns <span class="op">=</span> [<span class="st">'away_team'</span>, <span class="st">'division'</span>, <span class="st">'standard_attend'</span>])</span>
<span id="cb26-576"><a href="#cb26-576" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> drop_value:</span>
<span id="cb26-577"><a href="#cb26-577" aria-hidden="true" tabindex="-1"></a>        temp_impact_df <span class="op">=</span> df[df[<span class="st">'division'</span>] <span class="op">==</span> i].sort_values(<span class="st">'standard_attend'</span>,ascending <span class="op">=</span> <span class="va">False</span>).head(slider_value)</span>
<span id="cb26-578"><a href="#cb26-578" aria-hidden="true" tabindex="-1"></a>        graph_df <span class="op">=</span> pd.concat([graph_df, temp_impact_df], axis <span class="op">=</span> <span class="dv">0</span>)</span>
<span id="cb26-579"><a href="#cb26-579" aria-hidden="true" tabindex="-1"></a>    graph_df <span class="op">=</span> graph_df.reset_index().drop(columns <span class="op">=</span> [<span class="st">'index'</span>]).replace({<span class="st">'division'</span>:div_dict})</span>
<span id="cb26-580"><a href="#cb26-580" aria-hidden="true" tabindex="-1"></a>    fig <span class="op">=</span> px.bar(graph_df, x<span class="op">=</span> <span class="st">'away_team'</span>, y<span class="op">=</span> <span class="st">'standard_attend'</span>, color <span class="op">=</span> <span class="st">'division'</span>)</span>
<span id="cb26-581"><a href="#cb26-581" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> fig</span>
<span id="cb26-582"><a href="#cb26-582" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">'__main__'</span>:</span>
<span id="cb26-583"><a href="#cb26-583" aria-hidden="true" tabindex="-1"></a>    app.run_server(mode<span class="op">=</span><span class="st">'inline'</span>)</span>
<span id="cb26-584"><a href="#cb26-584" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-585"><a href="#cb26-585" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-586"><a href="#cb26-586" aria-hidden="true" tabindex="-1"></a><span class="in">```{=html}</span></span>
<span id="cb26-587"><a href="#cb26-587" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;iframe width="650" height="500" src="http://127.0.0.1:8050"&gt;&lt;/iframe&gt;</span></span>
<span id="cb26-588"><a href="#cb26-588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-589"><a href="#cb26-589" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-590"><a href="#cb26-590" aria-hidden="true" tabindex="-1"></a><span class="fu">## Top Teams in the Biggest Leagues</span></span>
<span id="cb26-591"><a href="#cb26-591" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-594"><a href="#cb26-594" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb26-595"><a href="#cb26-595" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-top_away_league</span></span>
<span id="cb26-596"><a href="#cb26-596" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: 'Greatest Away teams Impact on Attendance: First Divisions'</span></span>
<span id="cb26-597"><a href="#cb26-597" aria-hidden="true" tabindex="-1"></a>away_team_top_3 <span class="op">=</span> pd.DataFrame(columns <span class="op">=</span> [<span class="st">'away_team'</span>, <span class="st">'division'</span>, <span class="st">'standard_attend'</span>])</span>
<span id="cb26-598"><a href="#cb26-598" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-599"><a href="#cb26-599" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-600"><a href="#cb26-600" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> divisions_list:</span>
<span id="cb26-601"><a href="#cb26-601" aria-hidden="true" tabindex="-1"></a>        temp_impact_df <span class="op">=</span> away_team_impact[away_team_impact[<span class="st">'division'</span>] <span class="op">==</span> i].sort_values(<span class="st">'standard_attend'</span>,ascending <span class="op">=</span> <span class="va">False</span>).head(<span class="dv">3</span>)</span>
<span id="cb26-602"><a href="#cb26-602" aria-hidden="true" tabindex="-1"></a>        away_team_top_3 <span class="op">=</span> pd.concat([away_team_top_3, temp_impact_df], axis <span class="op">=</span> <span class="dv">0</span>)</span>
<span id="cb26-603"><a href="#cb26-603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-604"><a href="#cb26-604" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-605"><a href="#cb26-605" aria-hidden="true" tabindex="-1"></a>top_league_away <span class="op">=</span> away_team_top_3[away_team_top_3[<span class="st">'division'</span>].isin([<span class="st">'E0'</span>, <span class="st">'I1'</span>, <span class="st">'F1'</span>, <span class="st">'SP1'</span>, <span class="st">'D1'</span>])].replace({<span class="st">'division'</span>:div_dict})</span>
<span id="cb26-606"><a href="#cb26-606" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-607"><a href="#cb26-607" aria-hidden="true" tabindex="-1"></a>sns.barplot(data <span class="op">=</span> top_league_away, x <span class="op">=</span> <span class="st">'standard_attend'</span>, y <span class="op">=</span> <span class="st">'away_team'</span>, hue <span class="op">=</span> <span class="st">'division'</span>, dodge <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb26-608"><a href="#cb26-608" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Away Team's Impact on Attendance: Top 3 teams per Top League"</span>)</span>
<span id="cb26-609"><a href="#cb26-609" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Mean Attendance Increase'</span>)</span>
<span id="cb26-610"><a href="#cb26-610" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Away Team'</span>)</span>
<span id="cb26-611"><a href="#cb26-611" aria-hidden="true" tabindex="-1"></a>plt.legend(bbox_to_anchor<span class="op">=</span>(<span class="fl">1.05</span>, <span class="dv">1</span>), loc<span class="op">=</span><span class="st">'upper left'</span>, borderaxespad<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb26-612"><a href="#cb26-612" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb26-613"><a href="#cb26-613" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-614"><a href="#cb26-614" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-615"><a href="#cb26-615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-616"><a href="#cb26-616" aria-hidden="true" tabindex="-1"></a>In @fig-top_away_league, we see the top 3 teams with the greatest impact on attendance in the top league in Germany, England, Spain, France, and Italy. The teams with the greatest impact on the home team's attendance are all big-name teams that are globally marketed. They have historical and current success within their league. For instance, in La Liga Primera, the three teams, Real Madrid, FC Barcelona, and Atletico Madrid, are the only teams that have won the league since 2004 <span class="co">[</span><span class="ot">@sportskeeda</span><span class="co">]</span>, and in turn have the greatest increase in attendance for their league. </span>
<span id="cb26-617"><a href="#cb26-617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-618"><a href="#cb26-618" aria-hidden="true" tabindex="-1"></a><span class="fu">## Greatest Away Team Impact - English Leagues</span></span>
<span id="cb26-619"><a href="#cb26-619" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-620"><a href="#cb26-620" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-623"><a href="#cb26-623" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb26-624"><a href="#cb26-624" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-england_away</span></span>
<span id="cb26-625"><a href="#cb26-625" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: 'Top 3 Away Teams per English League'</span></span>
<span id="cb26-626"><a href="#cb26-626" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: Top 3 away teams English League's plot</span></span>
<span id="cb26-627"><a href="#cb26-627" aria-hidden="true" tabindex="-1"></a>top_england_away <span class="op">=</span> away_team_top_3[away_team_top_3[<span class="st">'division'</span>].isin([<span class="st">'E0'</span>, <span class="st">'E1'</span>, <span class="st">'E2'</span>, <span class="st">'E3'</span>])].replace({<span class="st">'division'</span>:div_dict})</span>
<span id="cb26-628"><a href="#cb26-628" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-629"><a href="#cb26-629" aria-hidden="true" tabindex="-1"></a>sns.barplot(data <span class="op">=</span> top_england_away, x <span class="op">=</span> <span class="st">'standard_attend'</span>, y <span class="op">=</span> <span class="st">'away_team'</span>, hue <span class="op">=</span> <span class="st">'division'</span>, dodge <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb26-630"><a href="#cb26-630" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Away Teams Impact on Attendance: Top 3 teams per English League'</span>)</span>
<span id="cb26-631"><a href="#cb26-631" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Mean Attendance Increase'</span>)</span>
<span id="cb26-632"><a href="#cb26-632" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Away Team'</span>)</span>
<span id="cb26-633"><a href="#cb26-633" aria-hidden="true" tabindex="-1"></a>plt.legend(bbox_to_anchor<span class="op">=</span>(<span class="fl">1.05</span>, <span class="dv">1</span>), loc<span class="op">=</span><span class="st">'upper left'</span>, borderaxespad<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb26-634"><a href="#cb26-634" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb26-635"><a href="#cb26-635" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-636"><a href="#cb26-636" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-637"><a href="#cb26-637" aria-hidden="true" tabindex="-1"></a>Looking at teams in lower leagues, similar trends appear. @fig-england_away shows the lower leagues in England. All of the teams shown here have had historical success. For some of the teams, such as Leeds United and Coventry City, the success was in the past. Coventry City was in the top division of English Football from 1967 to 2001, winning the FA Cup in 1968. Leeds United is an even better example of historic success, winning the first division in the 1968-69, 1973-74, and 1991-92 seasons. Both of these teams have had historical success in their past, however their performances have declined in the modern era, forcing them to drop leagues. Other teams here, such as Newcastle, West Ham United, and Sunderland, were at the top level of football during this time period, however, were relegated by one or two leagues during that time. With that, they still have an impact, increasing attendance for the home teams. So, teams that have had historical success or recently were relegated from higher leagues are seen to have an impact on the home team's attendance. </span>
<span id="cb26-638"><a href="#cb26-638" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-639"><a href="#cb26-639" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-640"><a href="#cb26-640" aria-hidden="true" tabindex="-1"></a><span class="fu"># Betting Odds</span></span>
<span id="cb26-641"><a href="#cb26-641" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-642"><a href="#cb26-642" aria-hidden="true" tabindex="-1"></a>The final factor used in evaluating attendance was the betting odds for an individual match. Betting odds were used as a method to show favorability and public perception of a match. It shows the current perceived strength of each team. </span>
<span id="cb26-643"><a href="#cb26-643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-644"><a href="#cb26-644" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-645"><a href="#cb26-645" aria-hidden="true" tabindex="-1"></a><span class="fu">## Comparing Betting Data Sources</span></span>
<span id="cb26-646"><a href="#cb26-646" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-647"><a href="#cb26-647" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-650"><a href="#cb26-650" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb26-651"><a href="#cb26-651" aria-hidden="true" tabindex="-1"></a>bet_dataset <span class="op">=</span> total_data[[<span class="st">'raw_attendance'</span>, <span class="st">'division'</span>, <span class="st">'FTR'</span>,</span>
<span id="cb26-652"><a href="#cb26-652" aria-hidden="true" tabindex="-1"></a>        <span class="st">'B365H'</span>, <span class="st">'B365D'</span>, <span class="st">'B365A'</span>, <span class="st">'BWH'</span>, <span class="st">'BWD'</span>, <span class="st">'BWA'</span>, <span class="st">'WHH'</span>, <span class="st">'WHD'</span>,</span>
<span id="cb26-653"><a href="#cb26-653" aria-hidden="true" tabindex="-1"></a>       <span class="st">'WHA'</span>, <span class="st">'VCH'</span>, <span class="st">'VCD'</span>, <span class="st">'VCA'</span>, <span class="st">'BbMx&gt;2.5'</span>, <span class="st">'BbAv&gt;2.5'</span>, <span class="st">'BbMx&lt;2.5'</span>,</span>
<span id="cb26-654"><a href="#cb26-654" aria-hidden="true" tabindex="-1"></a>       <span class="st">'BbAv&lt;2.5'</span>]]</span>
<span id="cb26-655"><a href="#cb26-655" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-656"><a href="#cb26-656" aria-hidden="true" tabindex="-1"></a>b365_conditions <span class="op">=</span> [(bet_dataset[<span class="st">'B365H'</span>] <span class="op">&lt;</span> bet_dataset[<span class="st">'B365A'</span>]) <span class="op">&amp;</span> (bet_dataset[<span class="st">'B365H'</span>] <span class="op">&lt;</span> bet_dataset[<span class="st">'B365D'</span>]),</span>
<span id="cb26-657"><a href="#cb26-657" aria-hidden="true" tabindex="-1"></a>                   (bet_dataset[<span class="st">'B365A'</span>] <span class="op">&lt;</span> bet_dataset[<span class="st">'B365H'</span>]) <span class="op">&amp;</span> (bet_dataset[<span class="st">'B365A'</span>] <span class="op">&lt;</span> bet_dataset[<span class="st">'B365D'</span>]),</span>
<span id="cb26-658"><a href="#cb26-658" aria-hidden="true" tabindex="-1"></a>                   (bet_dataset[<span class="st">'B365D'</span>] <span class="op">&lt;</span> bet_dataset[<span class="st">'B365A'</span>]) <span class="op">&amp;</span> (bet_dataset[<span class="st">'B365D'</span>] <span class="op">&lt;</span> bet_dataset[<span class="st">'B365H'</span>])]</span>
<span id="cb26-659"><a href="#cb26-659" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-660"><a href="#cb26-660" aria-hidden="true" tabindex="-1"></a>b365_vals <span class="op">=</span> [<span class="st">'H'</span>, <span class="st">'A'</span>, <span class="st">'D'</span>]</span>
<span id="cb26-661"><a href="#cb26-661" aria-hidden="true" tabindex="-1"></a>bet_dataset[<span class="st">'B365_Result'</span>] <span class="op">=</span> np.select(b365_conditions,b365_vals)</span>
<span id="cb26-662"><a href="#cb26-662" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-663"><a href="#cb26-663" aria-hidden="true" tabindex="-1"></a>bw_conditions <span class="op">=</span> [(bet_dataset[<span class="st">'BWH'</span>] <span class="op">&lt;</span> bet_dataset[<span class="st">'BWA'</span>]) <span class="op">&amp;</span> (bet_dataset[<span class="st">'BWH'</span>] <span class="op">&lt;</span> bet_dataset[<span class="st">'BWD'</span>]),</span>
<span id="cb26-664"><a href="#cb26-664" aria-hidden="true" tabindex="-1"></a>                   (bet_dataset[<span class="st">'BWA'</span>] <span class="op">&lt;</span> bet_dataset[<span class="st">'BWH'</span>]) <span class="op">&amp;</span> (bet_dataset[<span class="st">'BWA'</span>] <span class="op">&lt;</span> bet_dataset[<span class="st">'BWD'</span>]),</span>
<span id="cb26-665"><a href="#cb26-665" aria-hidden="true" tabindex="-1"></a>                   (bet_dataset[<span class="st">'BWD'</span>] <span class="op">&lt;</span> bet_dataset[<span class="st">'BWA'</span>]) <span class="op">&amp;</span> (bet_dataset[<span class="st">'BWD'</span>] <span class="op">&lt;</span> bet_dataset[<span class="st">'BWH'</span>])]</span>
<span id="cb26-666"><a href="#cb26-666" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-667"><a href="#cb26-667" aria-hidden="true" tabindex="-1"></a>bw_vals <span class="op">=</span> [<span class="st">'H'</span>, <span class="st">'A'</span>, <span class="st">'D'</span>]</span>
<span id="cb26-668"><a href="#cb26-668" aria-hidden="true" tabindex="-1"></a>bet_dataset[<span class="st">'BW_Result'</span>] <span class="op">=</span> np.select(bw_conditions,bw_vals)</span>
<span id="cb26-669"><a href="#cb26-669" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-670"><a href="#cb26-670" aria-hidden="true" tabindex="-1"></a>wh_conditions <span class="op">=</span> [(bet_dataset[<span class="st">'WHH'</span>] <span class="op">&lt;</span> bet_dataset[<span class="st">'WHA'</span>]) <span class="op">&amp;</span> (bet_dataset[<span class="st">'WHH'</span>] <span class="op">&lt;</span> bet_dataset[<span class="st">'WHD'</span>]),</span>
<span id="cb26-671"><a href="#cb26-671" aria-hidden="true" tabindex="-1"></a>                   (bet_dataset[<span class="st">'WHA'</span>] <span class="op">&lt;</span> bet_dataset[<span class="st">'WHH'</span>]) <span class="op">&amp;</span> (bet_dataset[<span class="st">'WHA'</span>] <span class="op">&lt;</span> bet_dataset[<span class="st">'WHD'</span>]),</span>
<span id="cb26-672"><a href="#cb26-672" aria-hidden="true" tabindex="-1"></a>                   (bet_dataset[<span class="st">'WHD'</span>] <span class="op">&lt;</span> bet_dataset[<span class="st">'WHA'</span>]) <span class="op">&amp;</span> (bet_dataset[<span class="st">'WHD'</span>] <span class="op">&lt;</span> bet_dataset[<span class="st">'WHH'</span>])]</span>
<span id="cb26-673"><a href="#cb26-673" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-674"><a href="#cb26-674" aria-hidden="true" tabindex="-1"></a>wh_vals <span class="op">=</span> [<span class="st">'H'</span>, <span class="st">'A'</span>, <span class="st">'D'</span>]</span>
<span id="cb26-675"><a href="#cb26-675" aria-hidden="true" tabindex="-1"></a>bet_dataset[<span class="st">'WH_Result'</span>] <span class="op">=</span> np.select(wh_conditions,wh_vals)</span>
<span id="cb26-676"><a href="#cb26-676" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-677"><a href="#cb26-677" aria-hidden="true" tabindex="-1"></a>vc_conditions <span class="op">=</span> [(bet_dataset[<span class="st">'VCH'</span>] <span class="op">&lt;</span> bet_dataset[<span class="st">'VCA'</span>]) <span class="op">&amp;</span> (bet_dataset[<span class="st">'VCH'</span>] <span class="op">&lt;</span> bet_dataset[<span class="st">'VCD'</span>]),</span>
<span id="cb26-678"><a href="#cb26-678" aria-hidden="true" tabindex="-1"></a>                   (bet_dataset[<span class="st">'VCA'</span>] <span class="op">&lt;</span> bet_dataset[<span class="st">'VCH'</span>]) <span class="op">&amp;</span> (bet_dataset[<span class="st">'VCA'</span>] <span class="op">&lt;</span> bet_dataset[<span class="st">'VCD'</span>]),</span>
<span id="cb26-679"><a href="#cb26-679" aria-hidden="true" tabindex="-1"></a>                   (bet_dataset[<span class="st">'VCD'</span>] <span class="op">&lt;</span> bet_dataset[<span class="st">'VCA'</span>]) <span class="op">&amp;</span> (bet_dataset[<span class="st">'VCD'</span>] <span class="op">&lt;</span> bet_dataset[<span class="st">'VCH'</span>])]</span>
<span id="cb26-680"><a href="#cb26-680" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-681"><a href="#cb26-681" aria-hidden="true" tabindex="-1"></a>vc_vals <span class="op">=</span> [<span class="st">'H'</span>, <span class="st">'A'</span>, <span class="st">'D'</span>]</span>
<span id="cb26-682"><a href="#cb26-682" aria-hidden="true" tabindex="-1"></a>bet_dataset[<span class="st">'VC_Result'</span>] <span class="op">=</span> np.select(vc_conditions,vc_vals)</span>
<span id="cb26-683"><a href="#cb26-683" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-684"><a href="#cb26-684" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-685"><a href="#cb26-685" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-686"><a href="#cb26-686" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-687"><a href="#cb26-687" aria-hidden="true" tabindex="-1"></a>The dataset gathered had different sources of betting odds. Some were removed before the final dataset due to too many missing values, but the betting companies that remained were Bet365, Bet&amp;Win, William Hill, and VC Bet. </span>
<span id="cb26-688"><a href="#cb26-688" aria-hidden="true" tabindex="-1"></a>`</span>
<span id="cb26-689"><a href="#cb26-689" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-692"><a href="#cb26-692" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb26-693"><a href="#cb26-693" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-betting_comp</span></span>
<span id="cb26-694"><a href="#cb26-694" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Betting Data Compared to Actual Match Result</span></span>
<span id="cb26-695"><a href="#cb26-695" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: False</span></span>
<span id="cb26-696"><a href="#cb26-696" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-697"><a href="#cb26-697" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> betting_accuracy_vis(name, axis):</span>
<span id="cb26-698"><a href="#cb26-698" aria-hidden="true" tabindex="-1"></a>    b365_data <span class="op">=</span> bet_dataset[[name, <span class="st">'FTR'</span>]].dropna()</span>
<span id="cb26-699"><a href="#cb26-699" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(b365_data[name].value_counts())</span></span>
<span id="cb26-700"><a href="#cb26-700" aria-hidden="true" tabindex="-1"></a>    b365_data <span class="op">=</span> b365_data[b365_data[name]<span class="op">!=</span> <span class="st">'0'</span>]</span>
<span id="cb26-701"><a href="#cb26-701" aria-hidden="true" tabindex="-1"></a>    b365_data <span class="op">=</span> b365_data.groupby([<span class="st">'FTR'</span>,name]).size()</span>
<span id="cb26-702"><a href="#cb26-702" aria-hidden="true" tabindex="-1"></a>    b365_data <span class="op">=</span> b365_data.reset_index(name <span class="op">=</span> <span class="st">'count'</span>)</span>
<span id="cb26-703"><a href="#cb26-703" aria-hidden="true" tabindex="-1"></a>    FTR_result <span class="op">=</span> b365_data[[name,<span class="st">'count'</span>]].rename(columns <span class="op">=</span> {<span class="st">'count'</span>:<span class="st">'total'</span>})</span>
<span id="cb26-704"><a href="#cb26-704" aria-hidden="true" tabindex="-1"></a>    FTR_result <span class="op">=</span> FTR_result.groupby([name]).<span class="bu">sum</span>().reset_index()</span>
<span id="cb26-705"><a href="#cb26-705" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(FTR_result)</span></span>
<span id="cb26-706"><a href="#cb26-706" aria-hidden="true" tabindex="-1"></a>    b365_data <span class="op">=</span> pd.merge(b365_data, FTR_result, on <span class="op">=</span>name)</span>
<span id="cb26-707"><a href="#cb26-707" aria-hidden="true" tabindex="-1"></a>    total_count <span class="op">=</span> b365_data[<span class="st">'count'</span>].<span class="bu">sum</span>()</span>
<span id="cb26-708"><a href="#cb26-708" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(total_count)</span></span>
<span id="cb26-709"><a href="#cb26-709" aria-hidden="true" tabindex="-1"></a>    b365_data[<span class="st">'pct'</span>] <span class="op">=</span> b365_data[<span class="st">'count'</span>]<span class="op">/</span>b365_data[<span class="st">'total'</span>] <span class="op">*</span><span class="dv">100</span></span>
<span id="cb26-710"><a href="#cb26-710" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(b365_data)</span></span>
<span id="cb26-711"><a href="#cb26-711" aria-hidden="true" tabindex="-1"></a>    b365_data <span class="op">=</span> b365_data.pivot(index <span class="op">=</span> <span class="st">'FTR'</span>, columns <span class="op">=</span> name, values <span class="op">=</span> <span class="st">'pct'</span>)</span>
<span id="cb26-712"><a href="#cb26-712" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(b365_data)</span></span>
<span id="cb26-713"><a href="#cb26-713" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-714"><a href="#cb26-714" aria-hidden="true" tabindex="-1"></a>    fig <span class="op">=</span> sns.heatmap(data <span class="op">=</span> b365_data, annot<span class="op">=</span> <span class="va">True</span>, ax <span class="op">=</span> axis)</span>
<span id="cb26-715"><a href="#cb26-715" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">'Match Result'</span>)</span>
<span id="cb26-716"><a href="#cb26-716" aria-hidden="true" tabindex="-1"></a>    <span class="co"># plt.xticks(['Win', 'Draw', 'Loss'])</span></span>
<span id="cb26-717"><a href="#cb26-717" aria-hidden="true" tabindex="-1"></a>    <span class="co"># plt.yticks(['Win', 'Draw', 'Loss'])</span></span>
<span id="cb26-718"><a href="#cb26-718" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-719"><a href="#cb26-719" aria-hidden="true" tabindex="-1"></a>    <span class="co"># plt.title(name + ' Accuracy in predicting Actual Result')</span></span>
<span id="cb26-720"><a href="#cb26-720" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb26-721"><a href="#cb26-721" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> fig</span>
<span id="cb26-722"><a href="#cb26-722" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-723"><a href="#cb26-723" aria-hidden="true" tabindex="-1"></a>result_name_list <span class="op">=</span> [<span class="st">'B365_Result'</span>, <span class="st">'BW_Result'</span>, <span class="st">'WH_Result'</span>, <span class="st">'VC_Result'</span>]</span>
<span id="cb26-724"><a href="#cb26-724" aria-hidden="true" tabindex="-1"></a><span class="co"># for i in result_name_list:</span></span>
<span id="cb26-725"><a href="#cb26-725" aria-hidden="true" tabindex="-1"></a><span class="co">#     betting_accuracy_vis(i)</span></span>
<span id="cb26-726"><a href="#cb26-726" aria-hidden="true" tabindex="-1"></a>figure, ax <span class="op">=</span> plt.subplots(<span class="dv">2</span>,<span class="dv">2</span>)</span>
<span id="cb26-727"><a href="#cb26-727" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-728"><a href="#cb26-728" aria-hidden="true" tabindex="-1"></a>betting_accuracy_vis(<span class="st">'B365_Result'</span>, ax[<span class="dv">0</span>,<span class="dv">0</span>])</span>
<span id="cb26-729"><a href="#cb26-729" aria-hidden="true" tabindex="-1"></a>betting_accuracy_vis(<span class="st">'BW_Result'</span>, ax[<span class="dv">0</span>,<span class="dv">1</span>])</span>
<span id="cb26-730"><a href="#cb26-730" aria-hidden="true" tabindex="-1"></a>betting_accuracy_vis(<span class="st">'WH_Result'</span>, ax[<span class="dv">1</span>,<span class="dv">0</span>])</span>
<span id="cb26-731"><a href="#cb26-731" aria-hidden="true" tabindex="-1"></a>betting_accuracy_vis(<span class="st">'VC_Result'</span>, ax[<span class="dv">1</span>,<span class="dv">1</span>])</span>
<span id="cb26-732"><a href="#cb26-732" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb26-733"><a href="#cb26-733" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-734"><a href="#cb26-734" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-735"><a href="#cb26-735" aria-hidden="true" tabindex="-1"></a>:::{.callout-note}</span>
<span id="cb26-736"><a href="#cb26-736" aria-hidden="true" tabindex="-1"></a>For the Results H = Home team Wins, A = Away team Wins, D = Draw.</span>
<span id="cb26-737"><a href="#cb26-737" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb26-738"><a href="#cb26-738" aria-hidden="true" tabindex="-1"></a>:::{.callout-tip title="Explanation of How to read the graphs percentages"}</span>
<span id="cb26-739"><a href="#cb26-739" aria-hidden="true" tabindex="-1"></a>The number within each cell is the percentage of predicted results occuring. For instance, when B365 predicted the away team to win, 27% of the time the home team won, 27% of the time the teams drew, and 47% of the time the away team won. </span>
<span id="cb26-740"><a href="#cb26-740" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb26-741"><a href="#cb26-741" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-742"><a href="#cb26-742" aria-hidden="true" tabindex="-1"></a>The heatmaps seen in @fig-betting_comp, show the distribution of what the betting company favored as the result and what  the actual result of a match was. The difference in the individual betting companies was slim to non-existant. Due to this, we assume that all the betting data is comparable. For the remainder of the project, Bet 365 is used because it had one of the fewest numbers of missing values. </span>
<span id="cb26-743"><a href="#cb26-743" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-744"><a href="#cb26-744" aria-hidden="true" tabindex="-1"></a><span class="fu">## Betting Odds</span></span>
<span id="cb26-747"><a href="#cb26-747" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb26-748"><a href="#cb26-748" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb26-749"><a href="#cb26-749" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: Betting Data Boolean Variables Created</span></span>
<span id="cb26-750"><a href="#cb26-750" aria-hidden="true" tabindex="-1"></a>bet_data <span class="op">=</span> total_data</span>
<span id="cb26-751"><a href="#cb26-751" aria-hidden="true" tabindex="-1"></a>bet_data <span class="op">=</span> bet_data.dropna(subset <span class="op">=</span> [<span class="st">'B365H'</span>, <span class="st">'B365A'</span>])</span>
<span id="cb26-752"><a href="#cb26-752" aria-hidden="true" tabindex="-1"></a>h_fav <span class="op">=</span> []</span>
<span id="cb26-753"><a href="#cb26-753" aria-hidden="true" tabindex="-1"></a>attend_increase <span class="op">=</span> []</span>
<span id="cb26-754"><a href="#cb26-754" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> index, rows <span class="kw">in</span> bet_data.iterrows():</span>
<span id="cb26-755"><a href="#cb26-755" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> rows[<span class="st">'B365H'</span>] <span class="op">&lt;</span> rows[<span class="st">'B365A'</span>]:</span>
<span id="cb26-756"><a href="#cb26-756" aria-hidden="true" tabindex="-1"></a>        h_fav <span class="op">=</span> h_fav <span class="op">+</span> [<span class="va">True</span>]</span>
<span id="cb26-757"><a href="#cb26-757" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb26-758"><a href="#cb26-758" aria-hidden="true" tabindex="-1"></a>        h_fav <span class="op">=</span> h_fav <span class="op">+</span> [<span class="va">False</span>]</span>
<span id="cb26-759"><a href="#cb26-759" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> rows[<span class="st">'standard_attend'</span>] <span class="op">&gt;=</span> <span class="dv">0</span>:</span>
<span id="cb26-760"><a href="#cb26-760" aria-hidden="true" tabindex="-1"></a>        attend_increase <span class="op">=</span> attend_increase <span class="op">+</span> [<span class="va">True</span>]</span>
<span id="cb26-761"><a href="#cb26-761" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb26-762"><a href="#cb26-762" aria-hidden="true" tabindex="-1"></a>        attend_increase <span class="op">=</span> attend_increase <span class="op">+</span> [<span class="va">False</span>]</span>
<span id="cb26-763"><a href="#cb26-763" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb26-764"><a href="#cb26-764" aria-hidden="true" tabindex="-1"></a>bet_increase_bool <span class="op">=</span> bet_data</span>
<span id="cb26-765"><a href="#cb26-765" aria-hidden="true" tabindex="-1"></a>bet_increase_bool[<span class="st">'home_fav'</span>] <span class="op">=</span> h_fav</span>
<span id="cb26-766"><a href="#cb26-766" aria-hidden="true" tabindex="-1"></a>bet_increase_bool[<span class="st">'attend_increase'</span>] <span class="op">=</span> attend_increase</span>
<span id="cb26-767"><a href="#cb26-767" aria-hidden="true" tabindex="-1"></a>bet_bool <span class="op">=</span> bet_increase_bool[[<span class="st">'home_fav'</span>, <span class="st">'attend_increase'</span>,<span class="st">'raw_attendance'</span>]]</span>
<span id="cb26-768"><a href="#cb26-768" aria-hidden="true" tabindex="-1"></a>bet_bool <span class="op">=</span> bet_bool.groupby([<span class="st">'home_fav'</span>, <span class="st">'attend_increase'</span>]).count().reset_index().rename(columns <span class="op">=</span> {<span class="st">'home_fav'</span>:<span class="st">'Home Team Favorited'</span>, <span class="st">'attend_increase'</span>:<span class="st">'Increase In Attendance'</span>})</span>
<span id="cb26-769"><a href="#cb26-769" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-770"><a href="#cb26-770" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-771"><a href="#cb26-771" aria-hidden="true" tabindex="-1"></a>For analyzing the effect of betting odds in the data set, two boolean variables were created. The first variable reflected whether or not there was an increase in attendance. If the z-score for the match was positive or 0, it was determined to have an increased attendance and if it was negative, it decreased attendance. The second was to determine if the home team was favored. If the betting odds of the home team winning was a smaller number than the betting odds for the away team winning,  it was determined that the home team was favored. And if the home team betting odds were greater than the away team betting odds, then it was deterimined as not favored.</span>
<span id="cb26-772"><a href="#cb26-772" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-775"><a href="#cb26-775" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb26-776"><a href="#cb26-776" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-home_fav</span></span>
<span id="cb26-777"><a href="#cb26-777" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Impact of Home team Favorability to win on Attendance</span></span>
<span id="cb26-778"><a href="#cb26-778" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-779"><a href="#cb26-779" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-780"><a href="#cb26-780" aria-hidden="true" tabindex="-1"></a>count_pct <span class="op">=</span> []</span>
<span id="cb26-781"><a href="#cb26-781" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> index, rows <span class="kw">in</span> bet_bool.iterrows():</span>
<span id="cb26-782"><a href="#cb26-782" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print('----------')</span></span>
<span id="cb26-783"><a href="#cb26-783" aria-hidden="true" tabindex="-1"></a>    goals <span class="op">=</span> rows[<span class="st">'Home Team Favorited'</span>]</span>
<span id="cb26-784"><a href="#cb26-784" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(goals)</span></span>
<span id="cb26-785"><a href="#cb26-785" aria-hidden="true" tabindex="-1"></a>    total_count_goals <span class="op">=</span> bet_bool[bet_bool[<span class="st">'Home Team Favorited'</span>] <span class="op">==</span> goals][<span class="st">'raw_attendance'</span>].values</span>
<span id="cb26-786"><a href="#cb26-786" aria-hidden="true" tabindex="-1"></a>    total_count_goals <span class="op">=</span> <span class="bu">sum</span>(total_count_goals)</span>
<span id="cb26-787"><a href="#cb26-787" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(total_count_goals)</span></span>
<span id="cb26-788"><a href="#cb26-788" aria-hidden="true" tabindex="-1"></a>    percent_total <span class="op">=</span> rows[<span class="st">'raw_attendance'</span>]<span class="op">*</span><span class="dv">100</span><span class="op">/</span>total_count_goals</span>
<span id="cb26-789"><a href="#cb26-789" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(percent_total)</span></span>
<span id="cb26-790"><a href="#cb26-790" aria-hidden="true" tabindex="-1"></a>    count_pct <span class="op">=</span> count_pct <span class="op">+</span> [percent_total]</span>
<span id="cb26-791"><a href="#cb26-791" aria-hidden="true" tabindex="-1"></a>bet_bool[<span class="st">'pcnt_values'</span>]  <span class="op">=</span> count_pct</span>
<span id="cb26-792"><a href="#cb26-792" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-793"><a href="#cb26-793" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-794"><a href="#cb26-794" aria-hidden="true" tabindex="-1"></a><span class="co"># bet_bool = bet_bool.pivot_table(values = 'pcnt_values', index = 'Home Team Favorited', columns = 'Increase In Attendance')</span></span>
<span id="cb26-795"><a href="#cb26-795" aria-hidden="true" tabindex="-1"></a><span class="co"># print(bet_bool)</span></span>
<span id="cb26-796"><a href="#cb26-796" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-797"><a href="#cb26-797" aria-hidden="true" tabindex="-1"></a><span class="co"># sns.heatmap(bet_bool,annot= True)</span></span>
<span id="cb26-798"><a href="#cb26-798" aria-hidden="true" tabindex="-1"></a>sns.barplot(data <span class="op">=</span>bet_bool, x <span class="op">=</span> <span class="st">'Home Team Favorited'</span>, y <span class="op">=</span> <span class="st">'pcnt_values'</span>, hue <span class="op">=</span> <span class="st">'Increase In Attendance'</span>)</span>
<span id="cb26-799"><a href="#cb26-799" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-800"><a href="#cb26-800" aria-hidden="true" tabindex="-1"></a>plt.gca().invert_xaxis()</span>
<span id="cb26-801"><a href="#cb26-801" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.gca().invert_yaxis()</span></span>
<span id="cb26-802"><a href="#cb26-802" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Attendance Impact Depending if Home Team is Favored'</span>)</span>
<span id="cb26-803"><a href="#cb26-803" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Percent'</span>)</span>
<span id="cb26-804"><a href="#cb26-804" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb26-805"><a href="#cb26-805" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-806"><a href="#cb26-806" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-807"><a href="#cb26-807" aria-hidden="true" tabindex="-1"></a>@fig-home_fav shows what occurs to attendance when the home team is favored to win. When the home team is favored, the games will typically have less-than-average attendance for that match. However, if the Home team is not favored, the matches are more likely to have a greater-than-average attendance. This could demonstrate that fans like to see underdog performances, and if their team is favored, they do not view the match as important. </span>
<span id="cb26-808"><a href="#cb26-808" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-809"><a href="#cb26-809" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-810"><a href="#cb26-810" aria-hidden="true" tabindex="-1"></a><span class="fu">## Odds of Goals &gt; 2.5</span></span>
<span id="cb26-811"><a href="#cb26-811" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-812"><a href="#cb26-812" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-815"><a href="#cb26-815" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb26-816"><a href="#cb26-816" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb26-817"><a href="#cb26-817" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: Goals Scored Boolean Variable</span></span>
<span id="cb26-818"><a href="#cb26-818" aria-hidden="true" tabindex="-1"></a>goal_data <span class="op">=</span> total_data.dropna(subset <span class="op">=</span> [<span class="st">'standard_attend'</span>, <span class="st">'BbAv&gt;2.5'</span>,<span class="st">'BbAv&lt;2.5'</span>])</span>
<span id="cb26-819"><a href="#cb26-819" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-820"><a href="#cb26-820" aria-hidden="true" tabindex="-1"></a>increase_attend <span class="op">=</span> []</span>
<span id="cb26-821"><a href="#cb26-821" aria-hidden="true" tabindex="-1"></a>higher_goals <span class="op">=</span> []</span>
<span id="cb26-822"><a href="#cb26-822" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> index, rows <span class="kw">in</span> goal_data.iterrows():</span>
<span id="cb26-823"><a href="#cb26-823" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> rows[<span class="st">'standard_attend'</span>] <span class="op">&gt;=</span><span class="dv">0</span>:</span>
<span id="cb26-824"><a href="#cb26-824" aria-hidden="true" tabindex="-1"></a>        increase_attend <span class="op">=</span> increase_attend <span class="op">+</span> [<span class="va">True</span>]</span>
<span id="cb26-825"><a href="#cb26-825" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb26-826"><a href="#cb26-826" aria-hidden="true" tabindex="-1"></a>        increase_attend <span class="op">=</span> increase_attend <span class="op">+</span> [<span class="va">False</span>]</span>
<span id="cb26-827"><a href="#cb26-827" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> rows[<span class="st">'BbAv&gt;2.5'</span>] <span class="op">&lt;=</span> rows[<span class="st">'BbAv&lt;2.5'</span>]:</span>
<span id="cb26-828"><a href="#cb26-828" aria-hidden="true" tabindex="-1"></a>        higher_goals <span class="op">=</span> higher_goals <span class="op">+</span> [<span class="va">True</span>]</span>
<span id="cb26-829"><a href="#cb26-829" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb26-830"><a href="#cb26-830" aria-hidden="true" tabindex="-1"></a>        higher_goals <span class="op">=</span> higher_goals <span class="op">+</span>[<span class="va">False</span>]</span>
<span id="cb26-831"><a href="#cb26-831" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-832"><a href="#cb26-832" aria-hidden="true" tabindex="-1"></a>goal_data[<span class="st">'increase_attend'</span>] <span class="op">=</span> increase_attend</span>
<span id="cb26-833"><a href="#cb26-833" aria-hidden="true" tabindex="-1"></a>goal_data[<span class="st">'higher_goals'</span>] <span class="op">=</span> higher_goals</span>
<span id="cb26-834"><a href="#cb26-834" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-835"><a href="#cb26-835" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> goal_data[[<span class="st">'higher_goals'</span>, <span class="st">'increase_attend'</span>]]</span>
<span id="cb26-836"><a href="#cb26-836" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.value_counts().reset_index(name<span class="op">=</span> <span class="st">'count'</span>)</span>
<span id="cb26-837"><a href="#cb26-837" aria-hidden="true" tabindex="-1"></a>count_pct <span class="op">=</span> []</span>
<span id="cb26-838"><a href="#cb26-838" aria-hidden="true" tabindex="-1"></a>df_grouped_higher_goal_sum <span class="op">=</span> df.groupby(<span class="st">'higher_goals'</span>)[<span class="st">'count'</span>].<span class="bu">sum</span>().reset_index()</span>
<span id="cb26-839"><a href="#cb26-839" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-840"><a href="#cb26-840" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-841"><a href="#cb26-841" aria-hidden="true" tabindex="-1"></a>One of the betting variables that is looked at is the betting odds on the total number of goals scored in a game. The betting odds are  if the game will have more than 2.5 or less than 2.5 goals. With this vairable, another boolean variable was created. If the betting odds for goals being greater than 2.5 was a smaller number than goals being less than 2.5, it was determined that there  was expected to have more than 2.5 goals scored. If the betting odds stated that goals being less than 2.5 had a smaller number than goals being greater than 2.5, it was stated that their was expected to be less than 2.5 goals scored.</span>
<span id="cb26-842"><a href="#cb26-842" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-845"><a href="#cb26-845" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb26-846"><a href="#cb26-846" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-goals</span></span>
<span id="cb26-847"><a href="#cb26-847" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Predicted Goals in relation to attendance</span></span>
<span id="cb26-848"><a href="#cb26-848" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> index, rows <span class="kw">in</span> df.iterrows():</span>
<span id="cb26-849"><a href="#cb26-849" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print('----------')</span></span>
<span id="cb26-850"><a href="#cb26-850" aria-hidden="true" tabindex="-1"></a>    goals <span class="op">=</span> rows[<span class="st">'higher_goals'</span>]</span>
<span id="cb26-851"><a href="#cb26-851" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(goals)</span></span>
<span id="cb26-852"><a href="#cb26-852" aria-hidden="true" tabindex="-1"></a>    total_count_goals <span class="op">=</span> df_grouped_higher_goal_sum[df_grouped_higher_goal_sum[<span class="st">'higher_goals'</span>] <span class="op">==</span> goals][<span class="st">'count'</span>].values</span>
<span id="cb26-853"><a href="#cb26-853" aria-hidden="true" tabindex="-1"></a>    total_count_goals <span class="op">=</span> <span class="bu">sum</span>(total_count_goals)</span>
<span id="cb26-854"><a href="#cb26-854" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(total_count_goals)</span></span>
<span id="cb26-855"><a href="#cb26-855" aria-hidden="true" tabindex="-1"></a>    percent_total <span class="op">=</span> rows[<span class="st">'count'</span>]<span class="op">*</span><span class="dv">100</span><span class="op">/</span>total_count_goals</span>
<span id="cb26-856"><a href="#cb26-856" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(percent_total)</span></span>
<span id="cb26-857"><a href="#cb26-857" aria-hidden="true" tabindex="-1"></a>    count_pct <span class="op">=</span> count_pct <span class="op">+</span> [percent_total]</span>
<span id="cb26-858"><a href="#cb26-858" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'count_pct'</span>] <span class="op">=</span> count_pct</span>
<span id="cb26-859"><a href="#cb26-859" aria-hidden="true" tabindex="-1"></a><span class="co"># total_count = df['count'].sum()</span></span>
<span id="cb26-860"><a href="#cb26-860" aria-hidden="true" tabindex="-1"></a><span class="co"># df['pct'] = df['count']*100/total_count</span></span>
<span id="cb26-861"><a href="#cb26-861" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.rename(columns <span class="op">=</span> {<span class="st">'higher_goals'</span>:<span class="st">'Odds of Goals over 2.5 is favored'</span>, <span class="st">'increase_attend'</span>: <span class="st">'Increased Attendance'</span>})</span>
<span id="cb26-862"><a href="#cb26-862" aria-hidden="true" tabindex="-1"></a>df2 <span class="op">=</span> df.pivot(index <span class="op">=</span> <span class="st">'Odds of Goals over 2.5 is favored'</span>, columns <span class="op">=</span> <span class="st">'Increased Attendance'</span>, values <span class="op">=</span> <span class="st">'count_pct'</span>)</span>
<span id="cb26-863"><a href="#cb26-863" aria-hidden="true" tabindex="-1"></a><span class="co"># print(df)</span></span>
<span id="cb26-864"><a href="#cb26-864" aria-hidden="true" tabindex="-1"></a><span class="co"># sns.heatmap(goal_data = df2, annot= True)</span></span>
<span id="cb26-865"><a href="#cb26-865" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.gca().invert_xaxis()</span></span>
<span id="cb26-866"><a href="#cb26-866" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.gca().invert_yaxis()</span></span>
<span id="cb26-867"><a href="#cb26-867" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.title('Predicted Goals in Relation to Attendance')</span></span>
<span id="cb26-868"><a href="#cb26-868" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.show()</span></span>
<span id="cb26-869"><a href="#cb26-869" aria-hidden="true" tabindex="-1"></a>sns.barplot(data <span class="op">=</span>df, x <span class="op">=</span> <span class="st">'Odds of Goals over 2.5 is favored'</span>, y <span class="op">=</span> <span class="st">'count_pct'</span>, hue <span class="op">=</span> <span class="st">'Increased Attendance'</span>)</span>
<span id="cb26-870"><a href="#cb26-870" aria-hidden="true" tabindex="-1"></a>plt.gca().invert_xaxis()</span>
<span id="cb26-871"><a href="#cb26-871" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Percent'</span>)</span>
<span id="cb26-872"><a href="#cb26-872" aria-hidden="true" tabindex="-1"></a>plt.xticks([<span class="dv">0</span>,<span class="dv">1</span>], [<span class="st">'Less than 2.5 Goals'</span>,<span class="st">'More than 2.5 Goals'</span>])</span>
<span id="cb26-873"><a href="#cb26-873" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Predicted amount of goals scored'</span>)</span>
<span id="cb26-874"><a href="#cb26-874" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Predicted Goals in Relation to Attendance'</span>)</span>
<span id="cb26-875"><a href="#cb26-875" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb26-876"><a href="#cb26-876" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-877"><a href="#cb26-877" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-878"><a href="#cb26-878" aria-hidden="true" tabindex="-1"></a>@fig-goals shows how attendance changes with different predicted number of goals. When the match is expected to be a higher scoring match, the attendance is almost equally likely to increase or decrease. However, when the match is not predicted to have over 2.5 goals scored, the attendance is more likely to be negatively impacted in relation to the season average. </span>
<span id="cb26-879"><a href="#cb26-879" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-880"><a href="#cb26-880" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-881"><a href="#cb26-881" aria-hidden="true" tabindex="-1"></a><span class="fu"># Modeling</span></span>
<span id="cb26-882"><a href="#cb26-882" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-883"><a href="#cb26-883" aria-hidden="true" tabindex="-1"></a>All of this analysis and looking at different factors that would impact attendance have led to predicting the attendance of a game. Given the complexity of the data, a random forest regression model was implemented. Random Forest Regression is a supervised machine learning model. It uses multiple decision trees to make the best model for the data. All of the factors stated before, except the amount of goals predicted to be scored, were used within the model to predict the attendance of a given match. </span>
<span id="cb26-884"><a href="#cb26-884" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-887"><a href="#cb26-887" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb26-888"><a href="#cb26-888" aria-hidden="true" tabindex="-1"></a><span class="co">#|eval: false</span></span>
<span id="cb26-889"><a href="#cb26-889" aria-hidden="true" tabindex="-1"></a>model_dataset <span class="op">=</span> total_data</span>
<span id="cb26-890"><a href="#cb26-890" aria-hidden="true" tabindex="-1"></a>model_dataset <span class="op">=</span> model_dataset.dropna(subset <span class="op">=</span> [<span class="st">'B365A'</span>, <span class="st">'BWH'</span>, <span class="st">'WHH'</span>, <span class="st">'VCD'</span>,<span class="st">'BbMx&gt;2.5'</span>,</span>
<span id="cb26-891"><a href="#cb26-891" aria-hidden="true" tabindex="-1"></a>                             <span class="st">'BbAv&gt;2.5'</span>, <span class="st">'BbMx&lt;2.5'</span>, <span class="st">'BbAv&lt;2.5'</span>, <span class="st">'std_attend'</span>, <span class="st">'standard_attend'</span>])</span>
<span id="cb26-892"><a href="#cb26-892" aria-hidden="true" tabindex="-1"></a>model_dataset <span class="op">=</span> model_dataset.drop([<span class="st">'date_time'</span>], axis <span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb26-893"><a href="#cb26-893" aria-hidden="true" tabindex="-1"></a>obj_data <span class="op">=</span> model_dataset.select_dtypes(include<span class="op">=</span>[<span class="st">'object'</span>]).copy()</span>
<span id="cb26-894"><a href="#cb26-894" aria-hidden="true" tabindex="-1"></a>column_obj_name <span class="op">=</span> obj_data.columns.values.tolist()</span>
<span id="cb26-895"><a href="#cb26-895" aria-hidden="true" tabindex="-1"></a>before_encode <span class="op">=</span> model_dataset[[<span class="st">'division'</span>, <span class="st">'home_team'</span>, <span class="st">'away_team'</span>]]</span>
<span id="cb26-896"><a href="#cb26-896" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-897"><a href="#cb26-897" aria-hidden="true" tabindex="-1"></a>label_encoder <span class="op">=</span> LabelEncoder()</span>
<span id="cb26-898"><a href="#cb26-898" aria-hidden="true" tabindex="-1"></a>post_encode <span class="op">=</span> model_dataset[[<span class="st">'division'</span>, <span class="st">'home_team'</span>, <span class="st">'away_team'</span>]]</span>
<span id="cb26-899"><a href="#cb26-899" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-900"><a href="#cb26-900" aria-hidden="true" tabindex="-1"></a>encode_compare <span class="op">=</span> pd.concat([before_encode, post_encode], axis <span class="op">=</span> <span class="dv">1</span>, ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb26-901"><a href="#cb26-901" aria-hidden="true" tabindex="-1"></a>encode_compare.columns <span class="op">=</span> [<span class="st">'division'</span>, <span class="st">'home_team'</span>, <span class="st">'away_team'</span>, <span class="st">'division_encode'</span>, <span class="st">'home_encode'</span>, <span class="st">'away_encode'</span>]</span>
<span id="cb26-902"><a href="#cb26-902" aria-hidden="true" tabindex="-1"></a><span class="co"># print(encode_compare)</span></span>
<span id="cb26-903"><a href="#cb26-903" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-904"><a href="#cb26-904" aria-hidden="true" tabindex="-1"></a>div_key <span class="op">=</span> pd.Series(encode_compare.division.values, index <span class="op">=</span> encode_compare.division_encode).to_dict()</span>
<span id="cb26-905"><a href="#cb26-905" aria-hidden="true" tabindex="-1"></a>home_key <span class="op">=</span> pd.Series(encode_compare.home_team.values, index <span class="op">=</span> encode_compare.home_encode).to_dict()</span>
<span id="cb26-906"><a href="#cb26-906" aria-hidden="true" tabindex="-1"></a>away_key <span class="op">=</span> pd.Series(encode_compare.away_team.values, index <span class="op">=</span> encode_compare.away_encode).to_dict()</span>
<span id="cb26-907"><a href="#cb26-907" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-908"><a href="#cb26-908" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-909"><a href="#cb26-909" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> obj <span class="kw">in</span> column_obj_name:</span>
<span id="cb26-910"><a href="#cb26-910" aria-hidden="true" tabindex="-1"></a>    model_dataset[obj] <span class="op">=</span> label_encoder.fit_transform(model_dataset[obj])</span>
<span id="cb26-911"><a href="#cb26-911" aria-hidden="true" tabindex="-1"></a>model_dataset <span class="op">=</span> model_dataset.astype(<span class="bu">float</span>)</span>
<span id="cb26-912"><a href="#cb26-912" aria-hidden="true" tabindex="-1"></a>model_dataset <span class="op">=</span> model_dataset.dropna()</span>
<span id="cb26-913"><a href="#cb26-913" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-914"><a href="#cb26-914" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-915"><a href="#cb26-915" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> model_dataset.drop([<span class="st">'raw_attendance'</span>, <span class="st">'standard_attend'</span>], axis <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb26-916"><a href="#cb26-916" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> x[[<span class="st">'home_team'</span>, <span class="st">'away_team'</span>, <span class="st">'division'</span>, <span class="st">'date'</span>, <span class="st">'time'</span>, <span class="st">'day_of_week'</span>,<span class="st">'B365H'</span>, <span class="st">'B365D'</span>,</span>
<span id="cb26-917"><a href="#cb26-917" aria-hidden="true" tabindex="-1"></a>       <span class="st">'B365A'</span>]]</span>
<span id="cb26-918"><a href="#cb26-918" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> model_dataset[<span class="st">'raw_attendance'</span>]</span>
<span id="cb26-919"><a href="#cb26-919" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-920"><a href="#cb26-920" aria-hidden="true" tabindex="-1"></a>x_train, x_test, y_train, y_test <span class="op">=</span> train_test_split(x,y, test_size <span class="op">=</span> <span class="fl">.2</span>, random_state <span class="op">=</span> <span class="dv">11</span>)</span>
<span id="cb26-921"><a href="#cb26-921" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-922"><a href="#cb26-922" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-923"><a href="#cb26-923" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------------------------------------------------------------------------------------------</span></span>
<span id="cb26-924"><a href="#cb26-924" aria-hidden="true" tabindex="-1"></a><span class="co"># Random Forest</span></span>
<span id="cb26-925"><a href="#cb26-925" aria-hidden="true" tabindex="-1"></a><span class="co"># The Random Forest Model was Performed outside the file and will be imported into the document. </span></span>
<span id="cb26-926"><a href="#cb26-926" aria-hidden="true" tabindex="-1"></a><span class="co">#  ------------------------------------------------------------------------------------------------------------------------------------------------</span></span>
<span id="cb26-927"><a href="#cb26-927" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-928"><a href="#cb26-928" aria-hidden="true" tabindex="-1"></a>random_forest_model <span class="op">=</span> RandomForestRegressor(n_estimators <span class="op">=</span> <span class="dv">1000</span>, random_state<span class="op">=</span> <span class="dv">11</span>)</span>
<span id="cb26-929"><a href="#cb26-929" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-930"><a href="#cb26-930" aria-hidden="true" tabindex="-1"></a>random_forest_model.fit(x_train, y_train)</span>
<span id="cb26-931"><a href="#cb26-931" aria-hidden="true" tabindex="-1"></a><span class="co">#  ------------------------------------------------------------------------------------------------------------------------------------------------</span></span>
<span id="cb26-932"><a href="#cb26-932" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-933"><a href="#cb26-933" aria-hidden="true" tabindex="-1"></a><span class="co"># random_forest_model = pickle.load(open('../src/Modeling/Random_forest_model.sav', 'rb'))</span></span>
<span id="cb26-934"><a href="#cb26-934" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-935"><a href="#cb26-935" aria-hidden="true" tabindex="-1"></a>y_predict <span class="op">=</span> random_forest_model.predict(x_test)</span>
<span id="cb26-936"><a href="#cb26-936" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-937"><a href="#cb26-937" aria-hidden="true" tabindex="-1"></a>mae <span class="op">=</span> metrics.mean_absolute_error(y_test, y_predict)</span>
<span id="cb26-938"><a href="#cb26-938" aria-hidden="true" tabindex="-1"></a>mse <span class="op">=</span> metrics.mean_squared_error(y_test, y_predict)</span>
<span id="cb26-939"><a href="#cb26-939" aria-hidden="true" tabindex="-1"></a>mape <span class="op">=</span> metrics.mean_absolute_percentage_error(y_test, y_predict)</span>
<span id="cb26-940"><a href="#cb26-940" aria-hidden="true" tabindex="-1"></a>r2 <span class="op">=</span> metrics.r2_score(y_test, y_predict)</span>
<span id="cb26-941"><a href="#cb26-941" aria-hidden="true" tabindex="-1"></a>result_df <span class="op">=</span> pd.DataFrame(np.array([[<span class="st">'Mean Absolute Error'</span>, mae], [<span class="st">'Mean Squared Error'</span>, mse],</span>
<span id="cb26-942"><a href="#cb26-942" aria-hidden="true" tabindex="-1"></a>    [<span class="st">'Mean Absolute Percentage Error'</span>, mape], [<span class="st">'r</span><span class="ch">\u00b2</span><span class="st">'</span>, r2]]), columns <span class="op">=</span> [<span class="st">'Metric'</span>, <span class="st">'Score'</span>])</span>
<span id="cb26-943"><a href="#cb26-943" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-944"><a href="#cb26-944" aria-hidden="true" tabindex="-1"></a>result_df</span>
<span id="cb26-945"><a href="#cb26-945" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-946"><a href="#cb26-946" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-947"><a href="#cb26-947" aria-hidden="true" tabindex="-1"></a>The Random Forest model used 1000 decision trees to build the model. The results of the model can be seen in the table above. It resulted in a fairly high r^2^ score of over 0.93. Which means approximately 93% of the variability in attendance is accounted for by our variables. Additionally, the mean absolute error score of approximately 2300 showing that the model's prediction is on average off by 2300 people. The table below shows examples from the test set of matches with their predicted and actual attendance. </span>
<span id="cb26-948"><a href="#cb26-948" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-949"><a href="#cb26-949" aria-hidden="true" tabindex="-1"></a><span class="in">```{=html}</span></span>
<span id="cb26-950"><a href="#cb26-950" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-951"><a href="#cb26-951" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;iframe width="700" height="500" src="http://127.0.0.1:4200"&gt;&lt;/iframe&gt;</span></span>
<span id="cb26-952"><a href="#cb26-952" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-953"><a href="#cb26-953" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-954"><a href="#cb26-954" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-955"><a href="#cb26-955" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-956"><a href="#cb26-956" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-957"><a href="#cb26-957" aria-hidden="true" tabindex="-1"></a>Below is another way to visualize the accuracy of the model. You can select the deviation from the actual attendance to see the percentage of the predictions that were accurate within that range. </span>
<span id="cb26-958"><a href="#cb26-958" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-959"><a href="#cb26-959" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-960"><a href="#cb26-960" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-961"><a href="#cb26-961" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-962"><a href="#cb26-962" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-965"><a href="#cb26-965" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb26-966"><a href="#cb26-966" aria-hidden="true" tabindex="-1"></a><span class="co">#|code-summary: Percentage perdicted data within a range</span></span>
<span id="cb26-967"><a href="#cb26-967" aria-hidden="true" tabindex="-1"></a><span class="co">#|eval: false</span></span>
<span id="cb26-968"><a href="#cb26-968" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-969"><a href="#cb26-969" aria-hidden="true" tabindex="-1"></a>model_result <span class="op">=</span> x_test</span>
<span id="cb26-970"><a href="#cb26-970" aria-hidden="true" tabindex="-1"></a>model_result[<span class="st">'raw_attendance'</span>] <span class="op">=</span> y_test</span>
<span id="cb26-971"><a href="#cb26-971" aria-hidden="true" tabindex="-1"></a>model_result[<span class="st">'predicted_attend'</span>] <span class="op">=</span> y_predict</span>
<span id="cb26-972"><a href="#cb26-972" aria-hidden="true" tabindex="-1"></a>model_result[<span class="st">'division'</span>] <span class="op">=</span> model_result[<span class="st">'division'</span>].astype(<span class="bu">int</span>)</span>
<span id="cb26-973"><a href="#cb26-973" aria-hidden="true" tabindex="-1"></a>model_result[<span class="st">'home_team'</span>] <span class="op">=</span> model_result[<span class="st">'home_team'</span>].astype(<span class="bu">int</span>)</span>
<span id="cb26-974"><a href="#cb26-974" aria-hidden="true" tabindex="-1"></a>model_result[<span class="st">'away_team'</span>] <span class="op">=</span> model_result[<span class="st">'away_team'</span>].astype(<span class="bu">int</span>)</span>
<span id="cb26-975"><a href="#cb26-975" aria-hidden="true" tabindex="-1"></a>model_result <span class="op">=</span> model_result.replace({<span class="st">'division'</span>:div_key, <span class="st">'home_team'</span>: home_key, <span class="st">'away_team'</span>:away_key})</span>
<span id="cb26-976"><a href="#cb26-976" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-977"><a href="#cb26-977" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-978"><a href="#cb26-978" aria-hidden="true" tabindex="-1"></a>in_50 <span class="op">=</span> []</span>
<span id="cb26-979"><a href="#cb26-979" aria-hidden="true" tabindex="-1"></a>in_500 <span class="op">=</span>[]</span>
<span id="cb26-980"><a href="#cb26-980" aria-hidden="true" tabindex="-1"></a>in_750 <span class="op">=</span>[]</span>
<span id="cb26-981"><a href="#cb26-981" aria-hidden="true" tabindex="-1"></a>in_1000 <span class="op">=</span>[]</span>
<span id="cb26-982"><a href="#cb26-982" aria-hidden="true" tabindex="-1"></a>in_1500 <span class="op">=</span>[]</span>
<span id="cb26-983"><a href="#cb26-983" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-984"><a href="#cb26-984" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> index, rows <span class="kw">in</span> model_result.iterrows():</span>
<span id="cb26-985"><a href="#cb26-985" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> rows[<span class="st">'predicted_attend'</span>] <span class="op">&lt;</span> rows[<span class="st">'raw_attendance'</span>]<span class="op">+</span><span class="dv">50</span> <span class="kw">and</span> rows[<span class="st">'predicted_attend'</span>] <span class="op">&gt;</span> rows[<span class="st">'raw_attendance'</span>]<span class="op">-</span><span class="dv">50</span>:</span>
<span id="cb26-986"><a href="#cb26-986" aria-hidden="true" tabindex="-1"></a>        in_50 <span class="op">+=</span> [<span class="va">True</span>]</span>
<span id="cb26-987"><a href="#cb26-987" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb26-988"><a href="#cb26-988" aria-hidden="true" tabindex="-1"></a>        in_50 <span class="op">+=</span> [<span class="va">False</span>]</span>
<span id="cb26-989"><a href="#cb26-989" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> rows[<span class="st">'predicted_attend'</span>] <span class="op">&lt;</span> rows[<span class="st">'raw_attendance'</span>]<span class="op">+</span><span class="dv">500</span> <span class="kw">and</span> rows[<span class="st">'predicted_attend'</span>] <span class="op">&gt;</span> rows[<span class="st">'raw_attendance'</span>]<span class="op">-</span><span class="dv">500</span>:</span>
<span id="cb26-990"><a href="#cb26-990" aria-hidden="true" tabindex="-1"></a>        in_500 <span class="op">+=</span> [<span class="va">True</span>]</span>
<span id="cb26-991"><a href="#cb26-991" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb26-992"><a href="#cb26-992" aria-hidden="true" tabindex="-1"></a>        in_500 <span class="op">+=</span> [<span class="va">False</span>]</span>
<span id="cb26-993"><a href="#cb26-993" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> rows[<span class="st">'predicted_attend'</span>] <span class="op">&lt;</span> rows[<span class="st">'raw_attendance'</span>]<span class="op">+</span><span class="dv">750</span> <span class="kw">and</span> rows[<span class="st">'predicted_attend'</span>] <span class="op">&gt;</span> rows[<span class="st">'raw_attendance'</span>]<span class="op">-</span><span class="dv">750</span>:</span>
<span id="cb26-994"><a href="#cb26-994" aria-hidden="true" tabindex="-1"></a>        in_750 <span class="op">+=</span> [<span class="va">True</span>]</span>
<span id="cb26-995"><a href="#cb26-995" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb26-996"><a href="#cb26-996" aria-hidden="true" tabindex="-1"></a>        in_750 <span class="op">+=</span> [<span class="va">False</span>] </span>
<span id="cb26-997"><a href="#cb26-997" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-998"><a href="#cb26-998" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> rows[<span class="st">'predicted_attend'</span>] <span class="op">&lt;</span> rows[<span class="st">'raw_attendance'</span>]<span class="op">+</span><span class="dv">1000</span> <span class="kw">and</span> rows[<span class="st">'predicted_attend'</span>] <span class="op">&gt;</span> rows[<span class="st">'raw_attendance'</span>]<span class="op">-</span><span class="dv">1000</span>:</span>
<span id="cb26-999"><a href="#cb26-999" aria-hidden="true" tabindex="-1"></a>        in_1000 <span class="op">+=</span> [<span class="va">True</span>]</span>
<span id="cb26-1000"><a href="#cb26-1000" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb26-1001"><a href="#cb26-1001" aria-hidden="true" tabindex="-1"></a>        in_1000 <span class="op">+=</span> [<span class="va">False</span>] </span>
<span id="cb26-1002"><a href="#cb26-1002" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> rows[<span class="st">'predicted_attend'</span>] <span class="op">&lt;</span> rows[<span class="st">'raw_attendance'</span>]<span class="op">+</span><span class="dv">1500</span> <span class="kw">and</span> rows[<span class="st">'predicted_attend'</span>] <span class="op">&gt;</span> rows[<span class="st">'raw_attendance'</span>]<span class="op">-</span><span class="dv">15000</span>:</span>
<span id="cb26-1003"><a href="#cb26-1003" aria-hidden="true" tabindex="-1"></a>        in_1500 <span class="op">+=</span> [<span class="va">True</span>]</span>
<span id="cb26-1004"><a href="#cb26-1004" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb26-1005"><a href="#cb26-1005" aria-hidden="true" tabindex="-1"></a>        in_1500 <span class="op">+=</span> [<span class="va">False</span>] </span>
<span id="cb26-1006"><a href="#cb26-1006" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-1007"><a href="#cb26-1007" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-1008"><a href="#cb26-1008" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-1009"><a href="#cb26-1009" aria-hidden="true" tabindex="-1"></a>model_result[<span class="st">'in_50'</span>] <span class="op">=</span> in_50</span>
<span id="cb26-1010"><a href="#cb26-1010" aria-hidden="true" tabindex="-1"></a>in_50_grouped <span class="op">=</span> model_result.groupby(<span class="st">'in_50'</span>).count()[<span class="st">'date'</span>].reset_index()</span>
<span id="cb26-1011"><a href="#cb26-1011" aria-hidden="true" tabindex="-1"></a>in_50_grouped[<span class="st">'pct'</span>] <span class="op">=</span> in_50_grouped[<span class="st">'date'</span>]<span class="op">/</span><span class="bu">sum</span>(in_50_grouped[<span class="st">'date'</span>])</span>
<span id="cb26-1012"><a href="#cb26-1012" aria-hidden="true" tabindex="-1"></a>in_50_grouped_div <span class="op">=</span> model_result.groupby([<span class="st">'in_50'</span>, <span class="st">'division'</span>]).count()[<span class="st">'date'</span>].reset_index()</span>
<span id="cb26-1013"><a href="#cb26-1013" aria-hidden="true" tabindex="-1"></a>in_50_grouped_div[<span class="st">'pct'</span>] <span class="op">=</span> in_50_grouped_div[<span class="st">'date'</span>]<span class="op">/</span><span class="bu">sum</span>(in_50_grouped_div[<span class="st">'date'</span>])</span>
<span id="cb26-1014"><a href="#cb26-1014" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-1015"><a href="#cb26-1015" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-1016"><a href="#cb26-1016" aria-hidden="true" tabindex="-1"></a>model_result[<span class="st">'in_500'</span>] <span class="op">=</span> in_500</span>
<span id="cb26-1017"><a href="#cb26-1017" aria-hidden="true" tabindex="-1"></a>in_500_grouped <span class="op">=</span> model_result.groupby(<span class="st">'in_500'</span>).count()[<span class="st">'date'</span>].reset_index()</span>
<span id="cb26-1018"><a href="#cb26-1018" aria-hidden="true" tabindex="-1"></a>in_500_grouped[<span class="st">'pct'</span>] <span class="op">=</span> in_500_grouped[<span class="st">'date'</span>]<span class="op">/</span><span class="bu">sum</span>(in_500_grouped[<span class="st">'date'</span>])</span>
<span id="cb26-1019"><a href="#cb26-1019" aria-hidden="true" tabindex="-1"></a>in_500_grouped_div <span class="op">=</span> model_result.groupby([<span class="st">'in_500'</span>, <span class="st">'division'</span>]).count()[<span class="st">'date'</span>].reset_index()</span>
<span id="cb26-1020"><a href="#cb26-1020" aria-hidden="true" tabindex="-1"></a>in_500_grouped_div[<span class="st">'pct'</span>] <span class="op">=</span> in_500_grouped_div[<span class="st">'date'</span>]<span class="op">/</span><span class="bu">sum</span>(in_500_grouped_div[<span class="st">'date'</span>])</span>
<span id="cb26-1021"><a href="#cb26-1021" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-1022"><a href="#cb26-1022" aria-hidden="true" tabindex="-1"></a>model_result[<span class="st">'in_750'</span>] <span class="op">=</span> in_750</span>
<span id="cb26-1023"><a href="#cb26-1023" aria-hidden="true" tabindex="-1"></a>in_750_grouped <span class="op">=</span> model_result.groupby(<span class="st">'in_750'</span>).count()[<span class="st">'date'</span>].reset_index()</span>
<span id="cb26-1024"><a href="#cb26-1024" aria-hidden="true" tabindex="-1"></a>in_750_grouped[<span class="st">'pct'</span>] <span class="op">=</span> in_750_grouped[<span class="st">'date'</span>]<span class="op">/</span><span class="bu">sum</span>(in_750_grouped[<span class="st">'date'</span>])</span>
<span id="cb26-1025"><a href="#cb26-1025" aria-hidden="true" tabindex="-1"></a>in_750_grouped_div <span class="op">=</span> model_result.groupby([<span class="st">'in_750'</span>, <span class="st">'division'</span>]).count()[<span class="st">'date'</span>].reset_index()</span>
<span id="cb26-1026"><a href="#cb26-1026" aria-hidden="true" tabindex="-1"></a>in_750_grouped_div[<span class="st">'pct'</span>] <span class="op">=</span> in_750_grouped_div[<span class="st">'date'</span>]<span class="op">/</span><span class="bu">sum</span>(in_750_grouped_div[<span class="st">'date'</span>])</span>
<span id="cb26-1027"><a href="#cb26-1027" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-1028"><a href="#cb26-1028" aria-hidden="true" tabindex="-1"></a>model_result[<span class="st">'in_1000'</span>] <span class="op">=</span> in_1000</span>
<span id="cb26-1029"><a href="#cb26-1029" aria-hidden="true" tabindex="-1"></a>in_1000_grouped <span class="op">=</span> model_result.groupby(<span class="st">'in_1000'</span>).count()[<span class="st">'date'</span>].reset_index()</span>
<span id="cb26-1030"><a href="#cb26-1030" aria-hidden="true" tabindex="-1"></a>in_1000_grouped[<span class="st">'pct'</span>] <span class="op">=</span> in_1000_grouped[<span class="st">'date'</span>]<span class="op">/</span><span class="bu">sum</span>(in_1000_grouped[<span class="st">'date'</span>])</span>
<span id="cb26-1031"><a href="#cb26-1031" aria-hidden="true" tabindex="-1"></a>in_1000_grouped_div <span class="op">=</span> model_result.groupby([<span class="st">'in_1000'</span>, <span class="st">'division'</span>]).count()[<span class="st">'date'</span>].reset_index()</span>
<span id="cb26-1032"><a href="#cb26-1032" aria-hidden="true" tabindex="-1"></a>in_1000_grouped_div[<span class="st">'pct'</span>] <span class="op">=</span> in_1000_grouped_div[<span class="st">'date'</span>]<span class="op">/</span><span class="bu">sum</span>(in_1000_grouped_div[<span class="st">'date'</span>])</span>
<span id="cb26-1033"><a href="#cb26-1033" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-1034"><a href="#cb26-1034" aria-hidden="true" tabindex="-1"></a>model_result[<span class="st">'in_1500'</span>] <span class="op">=</span> in_1500</span>
<span id="cb26-1035"><a href="#cb26-1035" aria-hidden="true" tabindex="-1"></a>in_1500_grouped <span class="op">=</span> model_result.groupby(<span class="st">'in_1500'</span>).count()[<span class="st">'date'</span>].reset_index()</span>
<span id="cb26-1036"><a href="#cb26-1036" aria-hidden="true" tabindex="-1"></a>in_1500_grouped[<span class="st">'pct'</span>] <span class="op">=</span> in_1500_grouped[<span class="st">'date'</span>]<span class="op">/</span><span class="bu">sum</span>(in_1500_grouped[<span class="st">'date'</span>])</span>
<span id="cb26-1037"><a href="#cb26-1037" aria-hidden="true" tabindex="-1"></a>in_1500_grouped_div <span class="op">=</span> model_result.groupby([<span class="st">'in_1500'</span>, <span class="st">'division'</span>]).count()[<span class="st">'date'</span>].reset_index()</span>
<span id="cb26-1038"><a href="#cb26-1038" aria-hidden="true" tabindex="-1"></a>in_1500_grouped_div[<span class="st">'pct'</span>] <span class="op">=</span> in_1500_grouped_div[<span class="st">'date'</span>]<span class="op">/</span><span class="bu">sum</span>(in_1500_grouped_div[<span class="st">'date'</span>])</span>
<span id="cb26-1039"><a href="#cb26-1039" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-1040"><a href="#cb26-1040" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-1041"><a href="#cb26-1041" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> go.Figure()</span>
<span id="cb26-1042"><a href="#cb26-1042" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-1043"><a href="#cb26-1043" aria-hidden="true" tabindex="-1"></a>fig.add_trace(</span>
<span id="cb26-1044"><a href="#cb26-1044" aria-hidden="true" tabindex="-1"></a>    go.Pie(labels <span class="op">=</span> in_50_grouped[<span class="st">'in_50'</span>], values<span class="op">=</span> in_50_grouped[<span class="st">'pct'</span>], name <span class="op">=</span> <span class="st">'50'</span>, sort <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb26-1045"><a href="#cb26-1045" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb26-1046"><a href="#cb26-1046" aria-hidden="true" tabindex="-1"></a>fig.add_trace(</span>
<span id="cb26-1047"><a href="#cb26-1047" aria-hidden="true" tabindex="-1"></a>    go.Pie(labels <span class="op">=</span> in_500_grouped[<span class="st">'in_500'</span>], values <span class="op">=</span> in_500_grouped[<span class="st">'pct'</span>], name <span class="op">=</span> <span class="st">"500"</span>, sort <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb26-1048"><a href="#cb26-1048" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb26-1049"><a href="#cb26-1049" aria-hidden="true" tabindex="-1"></a>fig.add_trace(</span>
<span id="cb26-1050"><a href="#cb26-1050" aria-hidden="true" tabindex="-1"></a>    go.Pie(labels<span class="op">=</span> in_750_grouped[<span class="st">'in_750'</span>], values<span class="op">=</span> in_750_grouped[<span class="st">'pct'</span>], name <span class="op">=</span> <span class="st">'750'</span>, sort <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb26-1051"><a href="#cb26-1051" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb26-1052"><a href="#cb26-1052" aria-hidden="true" tabindex="-1"></a>fig.add_trace(</span>
<span id="cb26-1053"><a href="#cb26-1053" aria-hidden="true" tabindex="-1"></a>    go.Pie(labels <span class="op">=</span> in_1000_grouped[<span class="st">'in_1000'</span>], values <span class="op">=</span> in_1000_grouped[<span class="st">'pct'</span>], name <span class="op">=</span> <span class="st">'1000'</span>, sort <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb26-1054"><a href="#cb26-1054" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb26-1055"><a href="#cb26-1055" aria-hidden="true" tabindex="-1"></a>fig.add_trace(</span>
<span id="cb26-1056"><a href="#cb26-1056" aria-hidden="true" tabindex="-1"></a>    go.Pie(labels <span class="op">=</span> in_1500_grouped[<span class="st">'in_1500'</span>], values <span class="op">=</span> in_1500_grouped[<span class="st">'pct'</span>], name<span class="op">=</span> <span class="st">'1500'</span>, sort <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb26-1057"><a href="#cb26-1057" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb26-1058"><a href="#cb26-1058" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-1059"><a href="#cb26-1059" aria-hidden="true" tabindex="-1"></a>fig.update_layout(</span>
<span id="cb26-1060"><a href="#cb26-1060" aria-hidden="true" tabindex="-1"></a>    updatemenus<span class="op">=</span>[</span>
<span id="cb26-1061"><a href="#cb26-1061" aria-hidden="true" tabindex="-1"></a>        <span class="bu">dict</span>(</span>
<span id="cb26-1062"><a href="#cb26-1062" aria-hidden="true" tabindex="-1"></a>            active<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb26-1063"><a href="#cb26-1063" aria-hidden="true" tabindex="-1"></a>            buttons<span class="op">=</span><span class="bu">list</span>([</span>
<span id="cb26-1064"><a href="#cb26-1064" aria-hidden="true" tabindex="-1"></a>                <span class="bu">dict</span>(label<span class="op">=</span><span class="st">"50"</span>,</span>
<span id="cb26-1065"><a href="#cb26-1065" aria-hidden="true" tabindex="-1"></a>                     method<span class="op">=</span><span class="st">"update"</span>,</span>
<span id="cb26-1066"><a href="#cb26-1066" aria-hidden="true" tabindex="-1"></a>                     args<span class="op">=</span>[{<span class="st">"visible"</span>: [<span class="va">True</span>, <span class="va">False</span>, <span class="va">False</span>, <span class="va">False</span>, <span class="va">False</span>]},</span>
<span id="cb26-1067"><a href="#cb26-1067" aria-hidden="true" tabindex="-1"></a>                           {<span class="st">"title"</span>: <span class="st">"Prediction within 50 of Actual Attendance"</span>}]),</span>
<span id="cb26-1068"><a href="#cb26-1068" aria-hidden="true" tabindex="-1"></a>                <span class="bu">dict</span>(label<span class="op">=</span><span class="st">"500"</span>,</span>
<span id="cb26-1069"><a href="#cb26-1069" aria-hidden="true" tabindex="-1"></a>                     method<span class="op">=</span><span class="st">"update"</span>,</span>
<span id="cb26-1070"><a href="#cb26-1070" aria-hidden="true" tabindex="-1"></a>                     args<span class="op">=</span>[{<span class="st">"visible"</span>: [<span class="va">True</span>, <span class="va">True</span>, <span class="va">False</span>, <span class="va">False</span>, <span class="va">False</span>]},</span>
<span id="cb26-1071"><a href="#cb26-1071" aria-hidden="true" tabindex="-1"></a>                           {<span class="st">"title"</span>: <span class="st">"Prediction within 500 Actual Attendance"</span>}</span>
<span id="cb26-1072"><a href="#cb26-1072" aria-hidden="true" tabindex="-1"></a>                            ]),</span>
<span id="cb26-1073"><a href="#cb26-1073" aria-hidden="true" tabindex="-1"></a>                <span class="bu">dict</span>(label<span class="op">=</span><span class="st">"750"</span>,</span>
<span id="cb26-1074"><a href="#cb26-1074" aria-hidden="true" tabindex="-1"></a>                     method<span class="op">=</span><span class="st">"update"</span>,</span>
<span id="cb26-1075"><a href="#cb26-1075" aria-hidden="true" tabindex="-1"></a>                     args<span class="op">=</span>[{<span class="st">"visible"</span>: [<span class="va">False</span>, <span class="va">False</span>, <span class="va">True</span>, <span class="va">False</span>]},</span>
<span id="cb26-1076"><a href="#cb26-1076" aria-hidden="true" tabindex="-1"></a>                           {<span class="st">"title"</span>: <span class="st">"Prediction within 750 Actual Attendance"</span>}]),</span>
<span id="cb26-1077"><a href="#cb26-1077" aria-hidden="true" tabindex="-1"></a>                <span class="bu">dict</span>(label<span class="op">=</span><span class="st">"1000"</span>,</span>
<span id="cb26-1078"><a href="#cb26-1078" aria-hidden="true" tabindex="-1"></a>                     method<span class="op">=</span><span class="st">"update"</span>,</span>
<span id="cb26-1079"><a href="#cb26-1079" aria-hidden="true" tabindex="-1"></a>                     args<span class="op">=</span>[{<span class="st">"visible"</span>: [<span class="va">False</span>, <span class="va">False</span>, <span class="va">False</span>, <span class="va">True</span>,<span class="va">False</span>]},</span>
<span id="cb26-1080"><a href="#cb26-1080" aria-hidden="true" tabindex="-1"></a>                           {<span class="st">"title"</span>: <span class="st">"Prediction within 1000 Actual Attendance"</span>}]),</span>
<span id="cb26-1081"><a href="#cb26-1081" aria-hidden="true" tabindex="-1"></a>                <span class="bu">dict</span>(label<span class="op">=</span><span class="st">"1500"</span>,</span>
<span id="cb26-1082"><a href="#cb26-1082" aria-hidden="true" tabindex="-1"></a>                     method<span class="op">=</span><span class="st">"update"</span>,</span>
<span id="cb26-1083"><a href="#cb26-1083" aria-hidden="true" tabindex="-1"></a>                     args<span class="op">=</span>[{<span class="st">"visible"</span>: [<span class="va">False</span>, <span class="va">False</span>, <span class="va">False</span>, <span class="va">False</span>,<span class="va">True</span>]},</span>
<span id="cb26-1084"><a href="#cb26-1084" aria-hidden="true" tabindex="-1"></a>                           {<span class="st">"title"</span>: <span class="st">"Prediction within 1500 Actual Attendance"</span>}]), </span>
<span id="cb26-1085"><a href="#cb26-1085" aria-hidden="true" tabindex="-1"></a>            ]),</span>
<span id="cb26-1086"><a href="#cb26-1086" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb26-1087"><a href="#cb26-1087" aria-hidden="true" tabindex="-1"></a>    ])</span>
<span id="cb26-1088"><a href="#cb26-1088" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-1089"><a href="#cb26-1089" aria-hidden="true" tabindex="-1"></a>fig.update_layout(title_text<span class="op">=</span><span class="st">"Prediction within 50"</span>)</span>
<span id="cb26-1090"><a href="#cb26-1090" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-1091"><a href="#cb26-1091" aria-hidden="true" tabindex="-1"></a>fig.show()</span>
<span id="cb26-1092"><a href="#cb26-1092" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-1093"><a href="#cb26-1093" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>